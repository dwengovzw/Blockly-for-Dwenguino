!function(t){var e={};function i(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(o,s,function(e){return t[e]}.bind(null,s));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,o){"use strict";o.r(e);class s{constructor(){}validateSchool(t){return""!==t?null:new Error(MSG.validator.errSchool)}validateId(t){for(let e=0;e<4;e++)if(null==t[e])return new Error(MSG.validator.errId);return null}validateAgeGroup(t){return void 0!==t?null:new Error(MSG.validator.errAgeGroup)}validateGender(t){return void 0!==t?null:new Error(MSG.validator.errGender)}validateActivityId(t){return""!==t?null:new Error(MSG.validator.errActivityId)}hasErrors(t){for(var e=t.length,i=0;i<e;i++)if(null!=t[i])return!0;return!1}}class n{static getServerUrl(){return"http://localhost:12032"}}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class r{constructor(t){a(this,"username",null),a(this,"password",null),a(this,"currentlySelectedIcons",[null,null,null,null]),a(this,"SIZE",4),a(this,"icons",[{id:1,name:MSG.logging.person,html:'<span class="glyphicon icon-user"></span>'},{id:2,name:MSG.logging.dog,html:'<span class="glyphicon icon-dog"></span>'},{id:3,name:MSG.logging.car,html:'<span class="glyphicon icon-car"></span>'},{id:4,name:MSG.logging.camera,html:'<span class="glyphicon icon-camera"></span>'},{id:5,name:MSG.logging.heart,html:'<span class="glyphicon icon-heart"></span>'},{id:6,name:MSG.logging.plane,html:'<span class="glyphicon icon-plane"></span>'},{id:7,name:MSG.logging.house,html:'<span class="glyphicon icon-house"></span>'},{id:8,name:MSG.logging.umbrella,html:'<span class="glyphicon icon-umbrella"></span>'},{id:9,name:MSG.logging.star,html:'<span class="glyphicon icon-star"></span>'},{id:10,name:MSG.logging.money,html:'<span class="glyphicon icon-money"></span>'},{id:11,name:MSG.logging.gift,html:'<span class="glyphicon icon-gift"></span>'},{id:12,name:MSG.logging.keys,html:'<span class="glyphicon icon-keys"></span>'},{id:13,name:MSG.logging.music,html:'<span class="glyphicon icon-music"></span>'},{id:14,name:MSG.logging.snowflake,html:'<span class="glyphicon icon-snowflake"></span>'},{id:15,name:MSG.logging.fire,html:'<span class="glyphicon icon-fire"></span>'},{id:16,name:MSG.logging.envelope,html:'<span class="glyphicon icon-envelope"></span>'}]),a(this,"schools",null),a(this,"validator",null),a(this,"eventLogger",null),this.validator=new s,this.eventLogger=t}createInitialMenu(){this.createLoggingModalDialogWithoutFooter(MSG.logging.login),$("#loggingModalBody").append('<p id="loggingModalBody1"></p>'),$("#loggingModalBody").append('<div id="authentication_menu" class="tutorial_categories_wrapper"></div>'),$("#authentication_menu").append('<div id="authentication_new_user" class="tutorial_categories_item card"></div>'),$("#authentication_new_user").append('<div class="category_tag">'+MSG.logging.newuser+"</div>"),$("#authentication_new_user").append('<div id="new_user_img"></div>'),$("#authentication_menu").append('<div id="authentication_existing_user" class="tutorial_categories_item card"></div>'),$("#authentication_existing_user").append('<div class="category_tag">'+MSG.logging.login+"</div>"),$("#authentication_existing_user").append('<div id="school_user_img"></div>'),this.showDialog();var t=this;$("#authentication_new_user").click((function(){t.createUserMenu()})),$("#authentication_existing_user").click((function(){t.createLoginMenu()}))}createLoginMenu(){var t=this;this.createLoggingModalDialog(MSG.logging.login),$("#loggingModalBody").append('<div id="inputUsername" class="ui-widget row mb-4">'),$("#inputUsername").append('<label for="myusernametag" class="col-md-3">'+MSG.logging.username+"</label>"),$("#inputUsername").append('<input id="myusernametag" name="myusernametag" class="col-md-8" placeholder="Enter username">'),t.createIconModule(),$("#loggingModalBody").append('<button id="reset_modal_dialog_button" type="button" class="btn btn-default mt-4">'+MSG.logging.reset+"</button>"),$("#loggingModalFooter").append('<button id="submit_modal_dialog_button" type="button" class="btn btn-default">'+MSG.logging.ok+"</button>"),this.showDialog(),t.makeIconsResponsive(),$("#reset_modal_dialog_button").click((function(){t.resetSelectedIcons()})),$("#submit_modal_dialog_button").click((function(){t.login()}))}login(){var t=this,e=[];if(User.username=$("input[name=myusernametag]").val(),User.password=JSON.stringify(t.currentlySelectedIcons),e.push(t.validator.validateId(t.currentlySelectedIcons)),t.validator.hasErrors(e))t.showErrors(e);else{var i={userId:User.username,password:JSON.stringify(t.currentlySelectedIcons)};$.ajax({type:"POST",url:n.getServerUrl()+"/authentication/authenticate",data:i}).done((function(e){t.eventLogger.setUserId(e.id),t.resetSelectedIcons(),t.removeDialog()})).fail((function(t,e){console.warn("Failed to log in:",e),console.log(t)}))}}createUserMenu(){var t=this;t.createLoggingModalDialog(MSG.logging.newuser),$("#loggingModalBody").append('<div id="inputUsername" class="ui-widget row mb-4">'),$("#inputUsername").append('<label for="myusernametag" class="col-md-3">'+MSG.logging.username+"</label>"),$("#inputUsername").append('<input id="myusernametag" name="myusernametag" class="col-md-8" placeholder="'+MSG.logging.chooseUsername+'">'),t.createIconModule(),$("#loggingModalBody").append('<button id="reset_modal_dialog_button" type="button" class="btn btn-default mt-4">'+MSG.logging.reset+"</button>"),$("#loggingModalFooter").append('<button id="submit_modal_dialog_button" type="button" class="btn btn-default">'+MSG.logging.ok+"</button>"),t.showDialog(),t.makeIconsResponsive(),$("#reset_modal_dialog_button").click((function(){t.resetSelectedIcons()})),$("#submit_modal_dialog_button").click((function(){t.registerUser()}))}registerUser(){var t=this,e=[];if(User.username=$("input[name=myusernametag]").val(),User.password=JSON.stringify(t.currentlySelectedIcons),e.push(t.validator.validateId(t.currentlySelectedIcons)),t.validator.hasErrors(e))t.showErrors(e);else{var i={userId:User.username,password:JSON.stringify(t.currentlySelectedIcons)};$.ajax({type:"POST",url:n.getServerUrl()+"/authentication/new",data:i}).done((function(e){t.eventLogger.setUserId(t.username),t.resetSelectedIcons(),t.removeDialog(),t.showSettingsMenu()})).fail((function(t,e){console.log("Failed to register:",e)}))}}showSettingsMenu(){var t=this;$.ajax({type:"GET",url:n.getServerUrl()+"/schools/"}).done((function(e){t.schools=e,t.createLoggingModalDialog(MSG.logging.setup),$("#loggingModalBody").append('<div id="inputSchool" class="ui-widget row mb-4">'),$("#inputSchool").append('<label for="myschooltags" class="col-md-2">'+MSG.logging.school+"</label>"),$("#inputSchool").append('<input id="myschooltags" name="myschooltags" class="form-control col-md-8" placeholder="'+MSG.logging.selectSchool+'">'),$("#loggingModalBody").append('<div id="inputAge" class="ui-widget row mb-4"></div>'),$("#inputAge").append('<label for="birth" class="col-md-3">'+MSG.logging.birth+"</label>"),$("#inputAge").append('<input type="date" class="form-control col-md-7" id="birth">'),$("#loggingModalBody").append('<div id="inputGender" class="ui-widget row mb-4"></div>'),$("#inputGender").append('<label for="birth" class="col-md-3">'+MSG.logging.gender+"</label>"),$("#inputGender").append('<div id="genderOptions" class="col-md-7">'),$("#genderOptions").append('<label class="radio-inline"><input type="radio" name="genderRadio" value="f">'+MSG.logging.gender1+"</label>"),$("#genderOptions").append('<label class="radio-inline"><input type="radio" name="genderRadio" value="m">'+MSG.logging.gender2+"</label>"),$("#genderOptions").append('<label class="radio-inline"><input type="radio" name="genderRadio" value="x">'+MSG.logging.gender3+"</label>"),$("#genderOptions").append('<label class="radio-inline"><input type="radio" name="genderRadio" value="na">'+MSG.logging.gender4+"</label>");var o=new Date,s=("0"+o.getDate()).slice(-2),a=("0"+(o.getMonth()+1)).slice(-2),r=o.getFullYear()+"-"+a+"-"+s;$("#birth").val(r),$("#loggingModalFooter").append('<button id="submit_modal_dialog_button" type="button" class="btn btn-default">'+MSG.logging.ok+"</button>"),$("#loggingModal").modal("show"),t.schoolsAutocomplete=new autoComplete({selector:'input[name="myschooltags"]',minChars:2,source:function(t,o){t=t.toLowerCase();var s=e,n=[];for(i=0;i<s.length;i++)~s[i].naam.toLowerCase().indexOf(t)&&n.push(s[i].naam+", "+s[i].gemeente);o(n)}}),$("#submit_modal_dialog_button").click((function(){var e=[];let i=$("input[name=myschooltags]").val(),o=$("#birth").val(),s=$("input[name=genderRadio]:checked").val();if(e.push(t.validator.validateSchool(i)),e.push(t.validator.validateGender(s)),t.validator.hasErrors(e))t.showErrors(e);else{t.eventLogger.setSchool(i),t.eventLogger.setDateOfBirth(o),t.eventLogger.setGender(s);var a={userId:User.username,password:User.password,school:i,dateOfBirth:o,gender:s};$.ajax({type:"POST",url:n.getServerUrl()+"/authentication/updateUser",data:a}).done((function(e){t.removeDialog(),console.log("[act;"+(t.eventLogger.dateOfBirth||"")+";"+(t.eventLogger.userId||"")+";"+(t.eventLogger.school||"")+"]")})).fail((function(t,e){console.warn("Failed to log in:",e)}))}}))})).fail((function(t,e){console.warn("Failed to fetch schools:",e)}))}showDialog(){$("#loggingModal").modal("show")}removeDialog(){$("div").remove("#loggingModal"),$(".modal-backdrop").remove()}createLoggingModalDialog(t){this.removeDialog(),$("#db_body").append('<div id="loggingModal" class="modal fade" role="dialog"></div>'),$("#loggingModal").append('<div id="loggingModalDialog" class="modal-dialog"></div>'),$("#loggingModalDialog").append('<div id="loggingModalContent" class="modal-content"></div>'),$("#loggingModalContent").append('<div id="loggingModalHeader" class="modal-header"></div>'),$("#loggingModalContent").append('<div id="loggingModalBody" class="modal-body"></div>'),$("#loggingModalContent").append('<div id="loggingModalFooter" class="modal-footer"></div>'),$("#loggingModalHeader").append('<button type="button" class="close" data-dismiss="modal">&times;</button>'),$("#loggingModalHeader").append('<h4 class="modal-title">'+t+"</h4>")}createLoggingModalDialogWithoutFooter(t){this.removeDialog(),$("#db_body").append('<div id="loggingModal" class="modal fade" role="dialog"></div>'),$("#loggingModal").append('<div id="loggingModalDialog" class="modal-dialog"></div>'),$("#loggingModalDialog").append('<div id="loggingModalContent" class="modal-content"></div>'),$("#loggingModalContent").append('<div id="loggingModalHeader" class="modal-header"></div>'),$("#loggingModalContent").append('<div id="loggingModalBody" class="modal-body"></div>'),$("#loggingModalHeader").append('<button type="button" class="close" data-dismiss="modal">&times;</button>'),$("#loggingModalHeader").append('<h4 class="modal-title">'+t+"</h4>")}showErrors(t){$("div").remove("#loggingModalErrors"),$("#loggingModalBody").append('<div id="loggingModalErrors" class="mt-4"></div>');for(var e=t.length,i=0;i<e;i++)null!=t[i]&&$("#loggingModalErrors").append("<p>"+t[i].message+"</p>")}createIconModule(){$("#loggingModalBody").append('<div class="row"><div class="col-md-12 mt-4"><b>'+MSG.logging.choosePassword+"</b></div></div>"),$("#loggingModalBody").append('<div class="row"><div class="col-md-3 mt-4 mb-4">'+MSG.logging.currentlySelected+'</div><div class="col-md-8 mt-4 mb-4"><div id="currentlySelected" class="row"></div></div>'),$("#currentlySelected").append('<div id="currentlySelected0" class="col-2"></div>'),$("#currentlySelected").append('<div id="currentlySelected1" class="col-2"></div>'),$("#currentlySelected").append('<div id="currentlySelected2" class="col-2"></div>'),$("#currentlySelected").append('<div id="currentlySelected3" class="col-2"></div>'),this.createIconGrid()}makeIconsResponsive(){var t=this;for(let e=1;e<5;e++)for(let i=1;i<5;i++)$("#r"+e+"c"+i).click((function(){t.addIconToId(e,i)}))}createIconGrid(){$("#loggingModalBody").append('<div id="inputIcons"></div>'),$("#inputIcons").append('<div id="row1" class="ui-widget row ml-1"></div>'),$("#inputIcons").append('<div id="row2" class="ui-widget row ml-1"></div>'),$("#inputIcons").append('<div id="row3" class="ui-widget row ml-1"></div>'),$("#inputIcons").append('<div id="row4" class="ui-widget row ml-1"></div>');for(let i=1;i<5;i++)for(let o=1;o<5;o++){$("#row"+i).append('<div id="r'+i+"c"+o+'" class="col-md-2 authentication_item mr-1 mb-1"></div>');var t=4*(i-1)+o,e=this.icons[t-1];$("#r"+i+"c"+o).append('<div class="category_tag">'+e.name+"</div>"),$("#r"+i+"c"+o).append('<div id="school_user_img">'+e.html+"</div>")}}resetSelectedIcons(){for(let t=0;t<4;t++)this.currentlySelectedIcons[t]=null,$("#currentlySelected"+t).html("")}addIconToId(t,e){for(let i=0;i<4;i++)if(null==this.currentlySelectedIcons[i]){let o=4*(t-1)+e,s=this.icons[o-1];this.currentlySelectedIcons[i]=s.id,$("#currentlySelected"+i).html(s.name+"<p>"+s.html+"</p>");break}}}function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class d{constructor(){l(this,"sessionId",null),l(this,"tutorialId",null),l(this,"school",null),l(this,"userId",null),l(this,"dataOfBirth",""),l(this,"genderSetting",""),l(this,"tutialIdSetting",""),l(this,"computerId","-1"),l(this,"workshopId","-1"),l(this,"loggingModal",null),this.loggingModal=new r(this)}init(){var t={};$(document).keydown(e=>{t[e.which]=!0,t[69]&&t[83]&&t[84]&&this.loggingModal.createInitialMenu()}),$(document).keyup((function(e){delete t[e.which]})),this.sessionId=window.sessionStorage.loadOnceSessionId,delete window.sessionStorage.loadOnceSessionId,this.sessionId||$.ajax({type:"GET",url:n.getServerUrl()+"/logging/id"}).done(t=>{this.sessionId=t}).fail((function(t,e){console.warn("Failed to fetch sessionId:",e)}))}createEvent(t,e,i=0,o=-1){return{timestamp:$.now(),name:t,simulatorState:o,selectedDifficulty:i,activeTutorial:d.tutorialIdSetting,groupId:d.activityIdSetting,computerId:d.computerId,workshopId:d.workshopId,data:e}}recordEvent(t){var e={timestamp:$.now(),userId:d.userId,school:d.school,sessionId:d.sessionId,dateOfBirth:d.agegroupSetting,gender:d.genderSetting,event:t};console.log(t),void 0!==this.sessionId&&$.ajax({type:"POST",url:n.getServerUrl()+"/logging/event",data:e}).done((function(t){console.debug("Recording submitted",t)})).fail((function(t,e){console.warn("Failed to submit recording:",e)}))}setUserId(t){this.userId=t}setSchool(t){this.school=t}setDateOfBirth(t){this.dateOfBirth=t}setGender(t){this.genderSetting=t}}function c(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class g{static mapButtonIdToIndex(t){return g.map[t]}static mapIndexToButtonId(t){for(let e in g.map)if(g.map[e]===t)return e}static mapButtonPinNameToIndex(t){return g.pinMap[t]}static mapIndexToButtonPinName(t){for(let e in g.pinMap)if(g.pinMap[e]===t)return e}}function p(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}c(g,"map",{sim_button_N:0,sim_button_W:1,sim_button_C:2,sim_button_E:3,sim_button_S:4}),c(g,"pinMap",{SW_N:0,SW_W:1,SW_C:2,SW_E:3,SW_S:4});class h{constructor(){p(this,"pins",new Array(33)),p(this,"pinMapping",{}),p(this,"lcdContent",new Array(2));for(let t=0;t<24;++t)this.pinMapping[t+""]=t;for(let t=0;t<8;++t)this.pinMapping["A"+t]=24+t;this.pinMapping.SW_N=16,this.pinMapping.SW_E=17,this.pinMapping.SW_S=18,this.pinMapping.SW_W=19,this.pinMapping.SW_C=32,this.pinMapping.BUZZER=33,this.pinMapping.LCD_BACKLIGHT=20,this.pinMapping.DC_MOTOR_1=34,this.pinMapping.DC_MOTOR_2=35,this.pinMapping.SERVO_MOTOR_1=36,this.pinMapping.SERVO_MOTOR_2=37;for(let t=0;t<8;++t)this.pinMapping["LED"+t]=38+t;for(let t=33;t<45;t++)this.pinMapping[t+""]=t;this.pinMapping.LED13=13,this.lcdContent[0]=" ".repeat(16),this.lcdContent[1]=" ".repeat(16),this.resetBoard()}resetBoard(){this.lcdContent=new Array(2),this.lcdContent[0]=" ".repeat(16),this.lcdContent[1]=" ".repeat(16);for(let t=0;t<24;++t)this.pins[this.pinMapping[t+""]]=0;for(let t=0;t<8;++t)this.pins[this.pinMapping["A"+t]]=0;this.pins[this.pinMapping.LCD_BACKLIGHT]=0,this.pins[this.pinMapping.BUZZER]=0,this.pins[this.pinMapping.DC_MOTOR_1]=0,this.pins[this.pinMapping.DC_MOTOR_2]=0,this.pins[this.pinMapping.SERVO_MOTOR_1]=0,this.pins[this.pinMapping.SERVO_MOTOR_2]=0;for(let t=0;t<8;++t)this.pins[this.pinMapping.LED0+t]=0;this.pins[this.pinMapping.LED13]=0,this.pins[this.pinMapping.SW_N]=1,this.pins[this.pinMapping.SW_E]=1,this.pins[this.pinMapping.SW_S]=1,this.pins[this.pinMapping.SW_W]=1,this.pins[this.pinMapping.SW_C]=1}setTonePlaying(t){this.setTonePlayingOnPin(t,"BUZZER")}getTonePlaying(){return this.getTonePlayingOnPin("BUZZER")}setTonePlayingOnPin(t,e){this.pins[this.pinMapping[e]]=t}getTonePlayingOnPin(t){return this.pins[this.pinMapping[t]]}setLcdContent(t,e){let i=e;t<0||t>1||(e.length>16&&(i=e.substr(0,16)),this.lcdContent[t]=i)}getLcdContent(t){if(t<0||t>1)throw new Error("This is not a valid line number");return this.lcdContent[t]}setBacklight(t){if(1!=t&&0!=t)throw new Error("Invalid status");this.pins[this.pinMapping.LCD_BACKLIGHT]=t}getBackLightStatus(){return this.pins[this.pinMapping.LCD_BACKLIGHT]}setServoAngle(t,e){this.pins[this.pinMapping["SERVO_MOTOR_"+t]]=e,console.log("setServoAngle",this.pins[this.pinMapping["SERVO_MOTOR_"+t]])}getServoAngle(t){return this.pins[this.pinMapping["SERVO_MOTOR_"+t]]}setMotorSpeed(t,e){if(t>2||t<1)throw Error("No motor with this number");let i=e;e<-255&&(i=-255),e>255&&(motorspeed=255),this.pins[this.pinMapping["DC_MOTOR_"+t]]=e}getMotorSpeed(t){if(t>2||t<1)throw Error("No motor with this number");return this.pins[this.pinMapping["DC_MOTOR_"+t]]}setLedState(t,e){8==t?this.pins[this.pinMapping.LED13]=e:this.pins[this.pinMapping["LED"+t]]=e}getLedState(t){return 8==t?this.pins[this.pinMapping.LED13]:this.pins[this.pinMapping["LED"+t]]}setButtonState(t,e){let i=g.mapIndexToButtonPinName(t);this.pins[this.pinMapping[i]]=e}getButtonState(t){let e=g.mapIndexToButtonPinName(t);return this.pins[this.pinMapping[e]]}setSonarDistance(t,e,i){this.setIoPinState(t,i),this.setIoPinState(e,i)}getSonarDistance(t,e){return this.getIoPinState(e)}setIoPinState(t,e){let i=t+"";this.pins[this.pinMapping[i]]=e}getIoPinState(t){let e=t+"";return this.pins[this.pinMapping[e]]}setAnalogIoPinState(t,e){if(!t.startsWith("A"))throw new Error("Not a valid analog pin name!");this.setIoPinState(t,e)}getAnalogIoPinState(t){if(!t.startsWith("A"))throw new Error("Not a valid analog pin name!");return this.getIoPinState(t)}}var u={motorRadius:10,motorDistance:380,nrOfSteps:200};function m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class _{constructor(t){m(this,"boardState",null),m(this,"currentScenario",null),m(this,"stepmotorQueue",[]),m(this,"servoAngleQueue",[]),m(this,"colorQueue",[]),m(this,"stepperPins",[33,34]),m(this,"penPositionPins",[36,37]),m(this,"colorPin",35),m(this,"stylusPosPin",38),m(this,"drawingActive",!1),this.boardState=t}setCurrentScenario(t){this.currentScenario=t}clearLcd(){for(var t=0;t<2;t++)this.writeLcd(" ".repeat(16),t,1)}writeLcd(t,e,i){this.boardState.setBacklight(1);let o=this.boardState.getLcdContent(e).substr(0,i),s=0;o.length<i&&(s=i-o.length),t=o+" ".repeat(s)+t.substring(0,16-i),this.boardState.getLcdContent(e).substr(t.length+i,16),this.boardState.setLcdContent(e,t)}digitalWrite(t,e){var i=Number(t);i>=32&&i<=39||13===i?(i>=32&&i<=39&&(i-=32),"HIGH"===e||1==e?13===i?this.boardState.setLedState(8,1):this.boardState.setLedState(i,1):13===i?this.boardState.setLedState(8,0):this.boardState.setLedState(i,0)):this.boardState.setIoPinState(i,e)}analogWrite(t,e){this.boardState.setAnalogIoPinState(t,e)}digitalRead(t){if(t.startsWith("SW_")){let e=g.mapButtonPinNameToIndex(t);return this.boardState.getButtonState(e)}return(t=Number(t))>=32&&t<=39||13===t?(t>=32&&t<=39&&(t-=32),this.boardState.getButtonState(t)):1}analogRead(t){return this.boardState.getAnalogIoPinState(t)}setLeds(t){t=t.toString(2);for(var e=0;e<8;e++)this.digitalWrite(32+e,0);var i=8-t.length;i<0&&(i=0);for(e=0;e<Math.min(t.length,8);e++)this.digitalWrite(39-(i+e),t[e])}tone(t,e){"BUZZER"===t&&this.boardState.setTonePlaying(e)}noTone(t){"BUZZER"===t&&this.boardState.setTonePlaying(0)}servo(t,e){e>180&&(e=180),e<0&&(e=0);let i=t+35;e!==this.boardState.getServoAngle(t)&&(this.boardState.setServoAngle(t,e),this.boardState.setIoPinState(i,e))}servoWithPin(t,e){e!==this.boardState.getIoPinState(t)&&this.boardState.setIoPinState(t,e)}startDcMotor(t,e){e>255&&(e=255),e<-255&&(e=-255),e!==this.boardState.getMotorSpeed(t)&&this.boardState.setMotorSpeed(t,e)}sonar(t,e){return Math.round(this.boardState.getSonarDistance(t,e))}pir(t){return this.boardState.getIoPinState(t)}sleep(t){}stepperMotorStep(t,e){let i=e>0?1:-1;this.boardState.setIoPinState(t,this.boardState.getIoPinState(t)+i)}stepMotorSteps(t,e){for(let i=0;i<Math.abs(e);++i)this.stepperMotorStep(t,e)}stepMotorsTo(t){let e=[0,0];for(let i=0;i<e.length;++i)e[i]=this.boardState.getIoPinState(this.penPositionPins[i])+t[i];let i=this.coordinatesToSteps(e);for(let t=0;t<i.length;++t)this.boardState.setIoPinState(this.stepperPins[t],i[t])}coordinatesToSteps(t){let e=Math.sqrt(t[0]**2+t[1]**2),i=Math.sqrt(t[1]**2+(u.motorDistance-t[0])**2),o=2*Math.PI*u.motorRadius/u.nrOfSteps;return e/=o,i/=o,[e,i]}drawRobotCheckPosition(t){var e=DwenguinoSimulation.currentScenario;(t[0]<e.paper.position.x||t[0]>e.paper.position.x+e.paper.width||t[1]<e.paper.position.y||t[1]>e.paper.position.y+e.paper.height)&&(window.stepMotorError||(alert(MSG.bounds),DwenguinoSimulation.handleSimulationStop(),window.stepMotorError=!0))}drawRobotLine(t,e,i){i&&(t+=20,e+=40);let o=[0,0];for(let t=0;t<o.length;++t)o[t]=this.boardState.getIoPinState(this.penPositionPins[t]);var s=o;let n=Math.atan((e-s[1])/(t-s[0])),a=Math.sqrt((s[0]-t)**2+(s[1]-e)**2),r=Math.cos(n),l=Math.sin(n);this.update(a,r,l),this.drawingActive=!0}update(t,e,i){t>0?(this.stepMotorsTo([e,i]),this.currentScenario.updateScenario(this.boardState),setTimeout(()=>{this.update(t-1,e,i)},30)):this.drawingActive=!1}drawRobotLowerStylus(){this.boardState.setIoPinState(this.stylusPosPin,0)}drawRobotLiftStylus(){this.boardState.setIoPinState(this.stylusPosPin,90)}changeColor(t){this.boardState.setIoPinState(this.colorPin,t)}}function v(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function b(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class S extends class{constructor(){v(this,"board",null),v(this,"debugger",null),v(this,"simulationSandbox",null),v(this,"currentScenario",null),v(this,"speedDelay",16),v(this,"baseSpeedDelay",16),v(this,"isSimulationRunning",!1),v(this,"isSimulationPaused",!1),this.board=new h,this.simulationSandbox=new _(this.board),this.initDebuggerState()}initDebuggerState(){this.debugger={debuggerjs:null,code:"",blocks:{lastBlocks:[null,null],lastColours:[-1,-1],blockMapping:{}}}}setCurrentScenario(t){this.currentScenario=t,this.simulationSandbox.setCurrentScenario(this.currentScenario),this.resetDwenguino()}initScenario(){this.currentScenario.initSimulationState(this.board),this.currentScenario.initSimulationDisplay(""),this.currentScenario.updateScenario(this.board)}resetDwenguino(){this.debugger.debuggerjs=null,this.debugger.code="",this.debugger.blocks.blockMapping={},this.board.resetBoard(),this.initScenario()}createDebugger(t={}){return debugjs.createDebugger(t)}initDebugger(t){this.resetDwenguino(),this.debugger.code=t,this.debugger.debuggerjs=this.createDebugger({iframeParentElement:document.getElementById("debug"),sandbox:{DwenguinoSimulation:this.simulationSandbox}}),this.debugger.debuggerjs.machine.on("error",(function(t){console.log(t),console.error(t.message)}));this.debugger.debuggerjs.load(this.debugger.code,"DwenguinoSimulation"),this.debugger.debuggerjs.machine.step()}step(t=!1){if(!this.isSimulationPaused){var e=this.debugger.debuggerjs.machine.getCurrentLoc().start.line-1;this.debugger.debuggerjs.machine.step();var i=void 0===this.debugger.code.split("\n")[e]?"":this.debugger.code.split("\n")[e];if(this.currentScenario.updateScenario(this.board),i.trim().startsWith("DwenguinoSimulation.sleep")){var o=Number(this.debugger.code.split("\n")[e].replace(/\D+/g,""));this.delayStepsTaken=0,this.delayStepsToTake=Math.floor(o/this.baseSpeedDelay),this.delayRemainingAfterSteps=o%this.baseSpeedDelay,this.performDelayLoop(t)}else t?this.isSimulationPaused=!0:setTimeout(this.step.bind(this),this.speedDelay);this.checkForEnd()}}performDelayLoop(t){this.delayStepsTaken<this.delayStepsToTake?(this.currentScenario.updateScenario(this.board),this.delayStepsTaken++,setTimeout(()=>{this.performDelayLoop(t)},this.speedDelay)):t?this.isSimulationPaused=!0:setTimeout(()=>{this.step()},this.delayRemainingAfterSteps)}handleScope(){var t=this.debugger.debuggerjs.machine.getCurrentStackFrame().scope;for(var e in t){var i=t[e];this.debugger.debuggerjs.machine.$runner.gen.stackFrame.evalInScope(i.name)}}checkForEnd(){(this.isSimulationRunning||this.isSimulationPaused)&&this.debugger.debuggerjs.machine.halted&&(this.isSimulationRunning=!1,this.isSimulationPaused=!1)}}{constructor(t,e){super(),b(this,"logger",null),b(this,"workspace",null),b(this,"simulationViewContainerId","db_simulator_panes"),this.logger=t,this.workspace=e}resetDwenguino(){super.resetDwenguino(),-1!==this.debugger.blocks.lastColours[0]&&this.debugger.blocks.lastBlocks[0].setColour(this.debugger.blocks.lastColours[0]),this.debugger.blocks.lastColours=[-1,-1],this.debugger.blocks.lastBlocks=[null,null]}initScenario(){this.currentScenario.initSimulationState(this.board),this.currentScenario.initSimulationDisplay(this.simulationViewContainerId),this.currentScenario.updateScenario(this.board)}initDebugger(){let t=Blockly.JavaScript.workspaceToCode(this.workspace);super.initDebugger(t),this.mapBlocksToCode(),this.updateBlocklyColour()}step(t=!1){super.step(t),this.updateBlocklyColour()}mapBlocksToCode(){var t=this.workspace.getAllBlocks()[0],e=0,i=this.debugger.code.split("\n"),o=[];let s=()=>{if(i[e].trim()===Blockly.JavaScript.blockToCode(n).split("\n")[0]&&(i[e].trim().startsWith("for")||i[e].trim().startsWith("while")||i[e].trim().startsWith("if"))?(o.push(n),this.debugger.blocks.blockMapping[e]=n,n=n.getInputTargetBlock("DO")||n.getInputTargetBlock("DO0")):i[e].trim()===Blockly.JavaScript.blockToCode(n).split("\n")[0]&&(this.debugger.blocks.blockMapping[e]=n,n=n.getNextBlock()),null===n&&o.length>0){var t=o.pop();n=t.getNextBlock(),e++}e++};for(var n=t.getInputTargetBlock("SETUP");null!==n&&e<i.length;)s();for(;o.length>0;)o.pop(),e++;for(;e<i.length&&"while (true) {"!==i[e];)e++;for(e<i.length&&(this.debugger.blocks.blockMapping[e]=t,e++),n=t.getInputTargetBlock("LOOP");null!==n&&e<i.length;)s()}updateBlocklyColour(){var t=this.debugger.debuggerjs.machine.getCurrentLoc().start.line-1;""!==this.debugger.code&&void 0!==this.debugger.blocks.blockMapping[t]&&(null!==this.debugger.blocks.lastBlocks[0]&&this.debugger.blocks.lastBlocks[0].setColour(this.debugger.blocks.lastColours[0]),this.debugger.blocks.lastBlocks[0]=this.debugger.blocks.lastBlocks[1],this.debugger.blocks.lastColours[0]=this.debugger.blocks.lastColours[1],this.debugger.blocks.lastBlocks[1]=this.debugger.blocks.blockMapping[t],this.debugger.blocks.lastColours[1]=this.debugger.blocks.blockMapping[t].getColour(),null!==this.debugger.blocks.lastBlocks[0]&&this.debugger.blocks.lastBlocks[0].setColour(210))}}const f=Object.freeze({downloadClicked:"downloadClicked",blockyBlockCreate:"blocklyBlockCreate",blocklyBlockDelete:"blocklyBlockDelete",blocklyBlockMove:"blocklyBlockMove",blocklyVarCreate:"blocklyVarCreate",blocklyVarDelete:"blocklyVarDelete",blocklyVarRename:"blocklyVarRename",blocklyUI:"blocklyUI",blocklyChange:"blocklyChange",undo:"undo",uploadClicked:"uploadClicked",simButtonStateClicked:"simButtonStateClicked",runClicked:"runClicked",changedWorkspace:"changedWorkspace",downloadScenarioClicked:"downloadScenarioClicked",moveRobotComponent:"moveRobotComponent",addRobotComponent:"addRobotComponent",removeRobotComponent:"removeRobotComponent",addRobotComponent:"addRobotComponent",changedScenario:"changedScenario",simStart:"simStart",simResume:"simResume",simPause:"simPause",simStopButtonClicked:"simStopButtonClicked",simStep:"simStep",simStop:"simStop",setSpeed:"setSpeed",startTutorial:"startTutorial",endTutorial:"endTutorial",tutorialNextStep:"tutorialNextStep",tutorialPrevStep:"tutorialPrevStep"});function y(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class w{constructor(t,e,i){y(this,"simulationRunner",null),y(this,"scenarioView","spyrograph"),y(this,"scenarios",null),y(this,"logger",null),this.logger=t,this.scenarios=i,this.simulationRunner=new S(this.logger,e),this.simulationRunner.setCurrentScenario(this.scenarios[this.scenarioView]),this.initSimulationControlsUI(i)}initSimulationControlsUI(t){$("#db_simulator_menu").empty(),$("#db_infopane").prepend('<div id="db_simulator_menu"></div>'),$("#db_simulator_menu").append('<div id="sim_menu"></div>'),$("#sim_menu").append('<div id="sim_start" class="sim_item"></div>'),$("#sim_menu").append('<div id="sim_pause" class="sim_item_disabled"></div>'),$("#sim_menu").append('<div id="sim_stop" class="sim_item_disabled"></div>'),$("#sim_menu").append('<div id="sim_step" class="sim_item"></div>'),$("#sim_menu").append('<div id="sim_scenarioTag" ></div>'),$("#sim_menu").append('<div id="sim_scenarios" class="btn-group btn-group-toggle" data-toggle="buttons"></div>'),$.each(Object.keys(this.scenarios),(t,e)=>{let i='<label id="scenario_label_'+e+'" class="btn sim_scenario_btn"></label>',o='<input id="sim_scenario_'+e+'"type="radio" name="scenario_type" class="sim_scenario_radio" value="'+e+'" autocomplete="off"><img src="DwenguinoIDE/img/scenarios/scenario_'+e+'.png" class="scenario_image">';$("#sim_scenarios").append(i),$("#scenario_label_"+e).append(o),e==this.scenarioView&&($("#sim_scenario_"+e).attr("checked","checked"),$("#scenario_label_"+e).attr("class","btn sim_scenario_btn active"))}),this.translateSimulatorInterface(),$("#sim_speed").on("change",()=>{this.setSpeed()});let e=this;$("input[name=scenario_type]:radio").change((function(){console.log($(this).val()),e.scenarioView=$(this).val(),e.translateSimulatorInterface(),e.handleSimulationStop(),e.simulationRunner.setCurrentScenario(e.scenarios[e.scenarioView]),e.logger.recordEvent(e.logger.createEvent(f.changedScenario,this.scenarioView))})),$("#sim_start").click(()=>{this.setButtonsStart(),this.simulationRunner.isSimulationRunning||this.simulationRunner.isSimulationPaused?this.simulationRunner.isSimulationRunning||(this.logger.recordEvent(this.logger.createEvent(f.simResume,"")),this.simulationRunner.isSimulationPaused=!1,this.simulationRunner.isSimulationRunning=!0,this.resumeSimulation()):(this.simulationRunner.isSimulationRunning=!0,this.startSimulation(),this.logger.recordEvent(this.logger.createEvent(f.simStart,"")))}),$("#sim_pause").click(()=>{this.logger.recordEvent(this.logger.createEvent(f.simPause,"")),this.simulationRunner.isSimulationRunning=!1,this.simulationRunner.isSimulationPaused=!0,this.setButtonsPause()}),$("#sim_stop").click(()=>{this.logger.recordEvent(this.logger.createEvent(f.simStopButtonClicked,"")),this.handleSimulationStop()}),$("#sim_step").click(()=>{this.setButtonsStep(),this.logger.recordEvent(this.logger.createEvent(f.simStep,"")),this.simulationRunner.isSimulationPaused||this.simulationRunner.isSimulationRunning?this.simulationRunner.isSimulationRunning||(this.simulationRunner.isSimulationPaused=!1,this.simulationRunner.step(!0),this.isSimulationPaused=!0):(this.startStepSimulation(),this.simulationRunner.isSimulationPaused=!0)});var i=(t,e,i)=>{$.each(e,(function(t,e){let i=$(e.attr("href"));e.removeClass("active"),i.hide()})),$(t).addClass("active"),$(t.hash).show(),i.preventDefault()};$("a[href$='#db_code_pane']").click((function(t){i(this,[$("a[href$='#db_robot_pane']")],t)})),$("a[href$='#db_robot_pane']").click((function(t){i(this,[$("a[href$='#db_code_pane']")],t)})),$("a[href$='#db_robot_pane']").trigger("click")}translateSimulatorInterface(){document.getElementById("sim_start").innerHTML="<span class='glyphicon glyphicon-play' alt='"+MSG.simulator.start+"'></span>",document.getElementById("sim_stop").innerHTML="<span class='glyphicon glyphicon-stop' alt='"+MSG.simulator.stop+"'></span>",document.getElementById("sim_pause").innerHTML="<span class='glyphicon glyphicon-pause' alt='"+MSG.simulator.pause+"'></span>",document.getElementById("sim_step").innerHTML="<span class='glyphicon glyphicon-step-forward' alt='"+MSG.simulator.step+"'></span>",document.getElementById("sim_scenarioTag").textContent=MSG.simulator.scenario+":"}startSimulation(){this.startDebuggingView(),this.simulationRunner.initDebugger(),this.simulationRunner.step()}startStepSimulation(){this.startDebuggingView(),this.simulationRunner.initDebugger(),this.simulationRunner.step(!0)}stopSimulation(){this.stopDebuggingView(),this.simulationRunner.resetDwenguino()}resumeSimulation(){this.simulationRunner.step()}handleSimulationStop(){this.logger.recordEvent(this.logger.createEvent(f.simStop,"")),this.simulationRunner.isSimulationRunning=!1,this.simulationRunner.isSimulationPaused=!1,this.setButtonsStop(),this.stopSimulation()}setButtonsStart(){document.getElementById("sim_pause").className="sim_item",document.getElementById("sim_stop").className="sim_item",document.getElementById("sim_start").className="sim_item_disabled",document.getElementById("sim_step").className="sim_item_disabled"}setButtonsPause(){document.getElementById("sim_start").className="sim_item",document.getElementById("sim_step").className="sim_item",document.getElementById("sim_stop").className="sim_item",document.getElementById("sim_pause").className="sim_item_disabled"}setButtonsStop(){document.getElementById("sim_start").className="sim_item",document.getElementById("sim_step").className="sim_item",document.getElementById("sim_stop").className="sim_item_disabled",document.getElementById("sim_pause").className="sim_item_disabled"}setButtonsStep(){document.getElementById("sim_start").className="sim_item",document.getElementById("sim_step").className="sim_item",document.getElementById("sim_stop").className="sim_item",document.getElementById("sim_pause").className="sim_item_disabled"}startDebuggingView(){0!==document.getElementsByClassName("alertDebug").length&&document.getElementsByClassName("alertDebug")[0].remove();var t='<div class ="alertDebug">'+MSG.simulator.alertDebug+"</div>";$("#db_body").append(t),document.getElementsByClassName("alertDebug")[0].style.width=document.getElementById("blocklyDiv").style.width,document.getElementById("blocklyDiv").style.opacity="0.5"}stopDebuggingView(){document.getElementById("blocklyDiv").style.opacity="1",document.getElementById("blocklyDiv").style.pointerEvents="auto",0!==document.getElementsByClassName("alertDebug").length&&document.getElementsByClassName("alertDebug")[0].remove()}setSpeed(){var t=document.getElementById("sim_speed"),e=t.options[t.selectedIndex].value;switch(this.logger.recordEvent(this.logger.createEvent(f.setSpeed,e)),e){case"veryslow":this.simulationRunner.speedDelay=600;break;case"slow":this.simulationRunner.speedDelay=300;break;case"medium":this.simulationRunner.speedDelay=150;break;case"fast":this.simulationRunner.speedDelay=75;break;case"veryfast":this.simulationRunner.speedDelay=32;break;case"realtime":this.simulationRunner.speedDelay=16}}}class I{constructor(){}render(t){this.clearCanvases(),this.drawLcd(t),this.drawLeds(t),this.drawServos(t),this.drawPirs(t),this.drawSonars(t),this.drawSoundSensors(t),this.drawLightSensors(t)}drawLcd(t){for(var e=0;e<t.length;e++)if(t[e].getType()==F.LCD){for(var i=0;i<2;++i)$("#sim_lcd_row"+i).text(t[e].getState()[i]),null!==document.getElementById("sim_lcd_row"+i)&&(document.getElementById("sim_lcd_row"+i).innerHTML=document.getElementById("sim_lcd_row"+i).innerHTML.replace(/ /g,"&nbsp;"));var o=document.getElementById("sim_lcds");null!==o&&(o.style.display="none",o.offsetHeight,o.style.display="block")}}initializeCanvas(t,e){let i=e.getCanvasId(),o=document.getElementById(i);null!==o&&(this.configureCanvasDimensions(o),this.render(t))}clearCanvases(){for(var t=document.getElementsByClassName("sim_canvas"),e=0;e<t.length;e++){if(t.item(e).getContext)t.item(e).getContext("2d").clearRect(0,0,t.item(e).width,t.item(e).height)}}clearCanvas(t){var e=document.getElementById(t);e.getContext&&e.getContext("2d").clearRect(0,0,e.width,e.height)}drawLeds(t){for(var e=0;e<t.length;e++)if(t[e].getType()==F.LED){let i=document.getElementById(t[e].getCanvasId());this.drawLed(t[e],i)}}drawLed(t,e){if(e.getContext){var i=e.getContext("2d");i.beginPath(),i.arc(e.width/2,e.height/2,t.getRadius(),0,2*Math.PI),1===t.getState()?i.fillStyle=t.getOnColor():i.fillStyle=t.getOffColor(),i.fill(),i.fillStyle=t.getBorderColor(),i.stroke()}else console.log(e,"This canvas has no context")}drawServos(t){for(var e=0;e<t.length;e++)if(t[e].getType()==F.SERVO){let i=document.getElementById(t[e].getCanvasId());this.clearCanvas(t[e].getCanvasId()),this.drawServo(t[e],i)}}drawServo(t,e){if(e.getContext){var i=this;t.getServoBackground().onload=function(){var o=e.getContext("2d");switch(t.getCostume()){case"plain":i.drawServoBackground(o,t),i.drawRotatedServohead(o,t)}},t.getImage(0).onload=function(){var o=e.getContext("2d");switch(o.fillStyle=t.getBackgroundColor(),t.getCostume()){case"plain":i.drawRotatedServohead(o,t);break;case"eye":i.drawEye(o,t,e);break;case"righthand":o.fillRect(t.getX()+100,t.getY()+30,t.getWidth()-100,t.getHeight()-60),i.drawRightHand(o,t);break;case"lefthand":o.fillRect(t.getX()+10,t.getY()+30,t.getWidth()-28,t.getHeight()-60),i.drawLeftHand(o,t)}};var o=e.getContext("2d");switch(o.fillStyle=t.getBackgroundColor(),t.getCostume()){case"plain":i.drawServoBackground(o,t),i.drawRotatedServohead(o,t);break;case"eye":i.drawEye(o,t,e);break;case"righthand":o.fillRect(t.getX()+100,t.getY()+30,t.getWidth()-100,t.getHeight()-60),i.drawRightHand(o,t);break;case"lefthand":o.fillRect(t.getX()+10,t.getY()+30,t.getWidth()-28,t.getHeight()-60),i.drawLeftHand(o,t)}}else console.log(e,"This canvas has no context")}drawPirs(t){for(var e=0;e<t.length;e++)if(t[e].getType()==F.PIR){let i=document.getElementById(t[e].getCanvasId());this.drawPir(t[e],i)}}drawPir(t,e){if(e.getContext){t.getImage().onload=function(){e.getContext("2d").drawImage(t.getImage(),0,0,t.getWidth(),t.getHeight())},e.getContext("2d").drawImage(t.getImage(),0,0,t.getWidth(),t.getHeight())}else console.log(e,"This canvas has no context")}drawSonars(t){for(var e=0;e<t.length;e++)if(t[e].getType()==F.SONAR){let i=document.getElementById(t[e].getCanvasId());this.drawSonar(t[e],i)}}drawSonar(t,e){if(e.getContext){t.getImage().onload=function(){e.getContext("2d").drawImage(t.getImage(),0,0,t.getWidth(),t.getHeight())},e.getContext("2d").drawImage(t.getImage(),0,0,t.getWidth(),t.getHeight())}else console.log(e,"This canvas has no context")}drawServoBackground(t,e){t.translate(0,e.getY()),t.drawImage(e.getServoBackground(),0,0,e.getWidth(),e.getHeight()),t.translate(0,-e.getY())}drawRotatedServohead(t,e){var i=this.getDirection(e.getPrevAngle(),e.getAngle());let o=e.getAngle()-e.getPrevAngle();if(0!=o)if(o>5||o<-5){let o=e.getPrevAngle()+5*i;e.setPrevAngle(o),t.translate(e.getX()+e.getWidth()/2,e.getY()+e.getHeight()/2),t.rotate(e.getPrevAngle()*Math.PI/180),t.drawImage(e.getImage(0),-e.getWidth()/2,-e.getHeight()/2,e.getWidth(),e.getHeight()),t.rotate(-e.getPrevAngle()*Math.PI/180),t.translate(-e.getX()-e.getWidth()/2,-e.getY()-e.getHeight()/2)}else{let i=e.getPrevAngle()+o;e.setPrevAngle(i),t.translate(e.getX()+e.getWidth()/2,e.getY()+e.getHeight()/2),t.rotate(e.getAngle()*Math.PI/180),t.drawImage(e.getImage(0),-e.getWidth()/2,-e.getHeight()/2,e.getWidth(),e.getHeight()),t.rotate(-e.getAngle()*Math.PI/180),t.translate(-e.getX()-e.getWidth()/2,-e.getY()-e.getHeight()/2)}else t.translate(e.getX()+e.getWidth()/2,e.getY()+e.getHeight()/2),t.rotate(e.getAngle()*Math.PI/180),t.drawImage(e.getImage(0),-e.getWidth()/2,-e.getHeight()/2,e.getWidth(),e.getHeight()),t.rotate(-e.getAngle()*Math.PI/180),t.translate(-e.getX()-e.getWidth()/2,-e.getY()-e.getHeight()/2)}drawEye(t,e,i){this.renderEyeBall(t,e,i),this.renderIris(t,e,i)}renderEyeBall(t,e,i){let o=e.getImage(0);t.drawImage(o,0,0,100,100)}renderIris(t,e,i){let o=e.getImage(1);o.src="./DwenguinoIDE/img/socialrobot/eye1_forground.svg";var s=this.getDirection(e.getPrevAngle(),e.getAngle());let n=e.getAngle()-e.getPrevAngle();if(0!=n){var a=e.getPrevAngle()/120*(i.width-60)+5;if(n>5||n<-5){let n=e.getPrevAngle()+5*s;e.setPrevAngle(n),e.getPrevAngle()>=0&e.getPrevAngle()<=120?t.drawImage(o,a,i.height/2-30,60,60):e.getPrevAngle()<=130&&(a=i.width-60+5,t.drawImage(o,a,i.height/2-30,60,60))}else{let s=e.getPrevAngle()+n;e.setPrevAngle(s),e.getPrevAngle()>=0&e.getPrevAngle()<=120?t.drawImage(o,a,i.height/2-30,60,60):e.getPrevAngle()<=130&&(a=i.width-60+5,t.drawImage(o,a,i.height/2-30,60,60))}}else{a=e.getAngle()/120*(i.width-60)+5;e.getAngle()>=0&e.getAngle()<=120?t.drawImage(o,a,i.height/2-30,60,60):e.getAngle()<=130&&(a=i.width-60+5,t.drawImage(o,a,i.height/2-30,60,60))}}drawRightHand(t,e){var i=e.getAngle()-e.getPrevAngle();i>0?this.drawDown(t,e):i<0?this.drawUp(t,e):(t.translate(e.getX()+e.getWidth()/2+50,e.getY()+e.getHeight()/2),t.rotate(-e.getAngle()*Math.PI/180),t.drawImage(e.getImage(0),-e.getWidth()/2,-e.getHeight()/2,e.getWidth(),e.getHeight()),t.rotate(e.getAngle()*Math.PI/180),t.translate(-e.getX()-e.getWidth()/2-50,-e.getY()-e.getHeight()/2))}drawDown(t,e){var i=e.getAngle()-e.getPrevAngle();if(i>=5){let i=e.getPrevAngle()+5;e.setPrevAngle(i),t.translate(e.getX()+e.getWidth()/2+50,e.getY()+e.getHeight()/2),t.rotate(-e.getPrevAngle()*Math.PI/180),t.drawImage(e.getImage(0),-e.getWidth()/2,-e.getHeight()/2,e.getWidth(),e.getHeight()),t.rotate(e.getPrevAngle()*Math.PI/180),t.translate(-e.getX()-e.getWidth()/2-50,-e.getY()-e.getHeight()/2)}else{let o=e.getPrevAngle()+i;e.setPrevAngle(o),t.translate(e.getX()+e.getWidth()/2+50,e.getY()+e.getHeight()/2),t.rotate(-e.getAngle()*Math.PI/180),t.drawImage(e.getImage(0),-e.getWidth()/2,-e.getHeight()/2,e.getWidth(),e.getHeight()),t.rotate(e.getAngle()*Math.PI/180),t.translate(-e.getX()-e.getWidth()/2-50,-e.getY()-e.getHeight()/2)}}drawUp(t,e){var i=e.getPrevAngle()-e.getAngle();if(i>=5){let i=e.getPrevAngle()-5;e.setPrevAngle(i),t.translate(e.getX()+e.getWidth()/2+50,e.getY()+e.getHeight()/2),t.rotate(-e.getPrevAngle()*Math.PI/180),t.drawImage(e.getImage(0),-e.getWidth()/2,-e.getHeight()/2,e.getWidth(),e.getHeight()),t.rotate(e.getPrevAngle()*Math.PI/180),t.translate(-e.getX()-e.getWidth()/2-50,-e.getY()-e.getHeight()/2)}else{let o=e.getPrevAngle()-i;e.setPrevAngle(o),t.translate(e.getX()+e.getWidth()/2+50,e.getY()+e.getHeight()/2),t.rotate(-e.getAngle()*Math.PI/180),t.drawImage(e.getImage(0),-e.getWidth()/2,-e.getHeight()/2,e.getWidth(),e.getHeight()),t.rotate(e.getAngle()*Math.PI/180),t.translate(-e.getX()-e.getWidth()/2-50,-e.getY()-e.getHeight()/2)}}drawLeftHand(t,e){var i=this.getDirection(e.getPrevAngle(),e.getAngle());let o=e.getAngle()-e.getPrevAngle();if(0!=o)if(o>5||o<-5){let o=e.getPrevAngle()+5*i;e.setPrevAngle(o),t.translate(e.getX()+e.getWidth()/2,e.getY()+e.getHeight()/2),t.rotate(-e.getPrevAngle()*Math.PI/180),t.drawImage(e.getImage(0),-e.getWidth()/2,-e.getHeight()/2,e.getWidth(),e.getHeight()),t.rotate(e.getPrevAngle()*Math.PI/180),t.translate(-e.getX()-e.getWidth()/2,-e.getY()-e.getHeight()/2)}else{let i=e.getPrevAngle()+o;e.setPrevAngle(i),t.translate(e.getX()+e.getWidth()/2,e.getY()+e.getHeight()/2),t.rotate(-e.getAngle()*Math.PI/180),t.drawImage(e.getImage(0),-e.getWidth()/2,-e.getHeight()/2,e.getWidth(),e.getHeight()),t.rotate(e.getAngle()*Math.PI/180),t.translate(-e.getX()-e.getWidth()/2,-e.getY()-e.getHeight()/2)}else t.translate(e.getX()+e.getWidth()/2,e.getY()+e.getHeight()/2),t.rotate(-e.getAngle()*Math.PI/180),t.drawImage(e.getImage(0),-e.getWidth()/2,-e.getHeight()/2,e.getWidth(),e.getHeight()),t.rotate(e.getAngle()*Math.PI/180),t.translate(-e.getX()-e.getWidth()/2,-e.getY()-e.getHeight()/2)}drawSoundSensors(t){for(var e=0;e<t.length;e++)if(t[e].getType()==F.SOUND){let i=document.getElementById(t[e].getCanvasId());this.drawSoundSensor(t[e],i)}}drawSoundSensor(t,e){if(e.getContext){t.getImage().onload=function(){e.getContext("2d").drawImage(t.getImage(),0,0,t.getWidth(),t.getHeight())},e.getContext("2d").drawImage(t.getImage(),0,0,t.getWidth(),t.getHeight())}else console.log(e,"This canvas has no context")}drawLightSensors(t){for(var e=0;e<t.length;e++)if(t[e].getType()==F.LIGHT){let i=document.getElementById(t[e].getCanvasId());this.drawLightSensor(t[e],i)}}drawLightSensor(t,e){if(e.getContext){t.getImage().onload=function(){e.getContext("2d").drawImage(t.getImage(),0,0,t.getWidth(),t.getHeight())},e.getContext("2d").drawImage(t.getImage(),0,0,t.getWidth(),t.getHeight())}else console.log(e,"This canvas has no context")}configureCanvasDimensions(t){var e=window.devicePixelRatio||1,i=t.getBoundingClientRect();(t.width=i.width*e,t.height=i.height*e,t.getContext)&&t.getContext("2d").scale(e,e)}getDirection(t,e){return e-t>0?1:-1}}class C{constructor(t,e){if(this._eventBus=t,this._htmlClasses=e,void 0===this.toString)throw new Error("You have to implement the method toString");if(void 0===this.toggleVisibility)throw new Error("You have to implement the method toggleVisibility");if(void 0===this.reset)throw new Error("You have to implement the method reset");if(void 0===this.insertHtml)throw new Error("You have to implement the method insertHtml to add the component to the simulation container");if(void 0===this.removeHtml)throw new Error("You have to implement the method removeHtml to remove the component from the simulation container");if(void 0===this.toXml)throw new Error("You have to implement the method toXml to save the robot component to an XML file")}setHtmlClasses(t){this._htmlClasses=t}getHtmlClasses(){return this._htmlClasses}}const M={SAVE:"save",INITIALIZECANVAS:"initializecanvas",CLEARCANVAS:"clearcanvas"};Object.freeze(M);class P{constructor(t){this.name=t,this.callbacks=[]}registerCallback(t){this.callbacks.push(t)}}const O={PLAIN:"plain",EYE:"eye",MOUTH:"mouth",RIGHTHAND:"righthand",LEFTHAND:"lefthand"};Object.freeze(O);class E extends C{constructor(t,e,i,o,s,n,a,r,l,d,c,g,p){switch(super(t,p),this._id=e,this._type=F.SERVO,this._width=l,this._height=d,this._x=a,this._y=r,this._offset={left:c,top:g},this._angle=s,this._prevAngle=0,this._image=[new Image,new Image],this._backgroundImage=new Image,this._backgroundImageRotated=new Image,this._backgroundImage.src="./DwenguinoIDE/img/socialrobot/servo_background.png",this._backgroundImageRotated.src="./DwenguinoIDE/img/socialrobot/servo_background_rotated.png",o){case O.PLAIN:this._image[0].src="./DwenguinoIDE/img/socialrobot/servo_head.png";break;case O.EYE:this._image[0].src="./DwenguinoIDE/img/socialrobot/eye1_background.svg",this._image[1].src="./DwenguinoIDE/img/socialrobot/eye1_forground.svg";break;case O.RIGHTHAND:this._image[0].src="./DwenguinoIDE/img/socialrobot/righthand.png";break;case O.LEFTHAND:this._image[0].src="./DwenguinoIDE/img/socialrobot/lefthand.png"}this._backgroundColor="#206499",this._pin=i,this._costume=o,this._canvasId="sim_servo_canvas"+this._id,this.insertHtml(),this.toggleVisibility(n)}toString(){let t="";return t=t.concat(this.getType()," "),t=t.concat(this.getId()," "),t=t.concat("Angle ",this.getAngle()," "),t=t.concat("Costume ",this.getCostume()," "),t=t.concat("Pin ",this.getPin()," "),t=t.concat("CanvasId ",this.getCanvasId()," "),t}insertHtml(){$("#sim_container").append("<div id='sim_"+this.getType()+this.getId()+"' class='sim_element sim_element_"+this.getType()+" draggable'><div><span class='grippy'></span>"+MSG.simulator[this.getType()]+" "+this.getId()+"</div></div>"),$("#sim_"+this.getType()+this.getId()).css("top",this.getOffset().top+"px"),$("#sim_"+this.getType()+this.getId()).css("left",this.getOffset().left+"px"),$("#sim_"+this.getType()+this.getId()).append("<canvas id='"+this.getCanvasId()+"' class='"+this.getHtmlClasses()+"'></canvas>"),document.getElementById("sim_"+this.getType()+this.getId()).addEventListener("dblclick",()=>{this.createComponentOptionsModalDialog(MSG.servoOptions),this.showDialog()})}removeHtml(){$("#sim_"+this.getType()+this.getId()).remove()}toggleVisibility(t){t?$("#sim_servo"+this.getId()).css("visibility","visible"):$("#sim_servo"+this.getId()).css("visibility","hidden")}toXml(){let t="";t=t.concat("<Item "),t=t.concat(" Type='",this.getType(),"'"),t=t.concat(" Id='",this.getId(),"'"),t=t.concat(" Width='",this.getWidth(),"'"),t=t.concat(" Height='",this.getHeight(),"'");let e="#sim_"+this.getType()+this.getId();return t=$(e).attr("data-x")?t.concat(" OffsetLeft='",parseFloat(this.getOffset().left)+parseFloat($(e).attr("data-x")),"'"):t.concat(" OffsetLeft='",parseFloat(this.getOffset().left),"'"),t=$(e).attr("data-y")?t.concat(" OffsetTop='",parseFloat(this.getOffset().top)+parseFloat($(e).attr("data-y")),"'"):t.concat(" OffsetTop='",parseFloat(this.getOffset().top),"'"),t=t.concat(" Angle='",this.getAngle(),"'"),t=t.concat(" PrevAngle='",this.getPrevAngle(),"'"),t=t.concat(" Pin='",parseInt(this.getPin()),"'"),t=t.concat(" Costume='",this.getCostume(),"'"),t=t.concat(" Classes='",this.getHtmlClasses(),"'"),t=t.concat("></Item>"),t}reset(){this.setX(0),this.setY(30),this.setAngle(0),this.setPrevAngle(0)}showDialog(){$("#componentOptionsModal").modal("show")}removeDialog(){$("div").remove("#componentOptionsModal"),$(".modal-backdrop").remove()}createComponentOptionsModalDialog(t){this.removeDialog(),$("#db_body").append('<div id="componentOptionsModal" class="modal fade" role="dialog"></div>'),$("#componentOptionsModal").append('<div id="componentOptionsModalDialog" class="modal-dialog"></div>'),$("#componentOptionsModalDialog").append('<div id="componentOptionsModalContent" class="modal-content"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalHeader" class="modal-header"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalBody" class="modal-body container"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalFooter" class="modal-footer"></div>'),$("#componentOptionsModalHeader").append('<button type="button" class="close" data-dismiss="modal">&times;</button>'),$("#componentOptionsModalHeader").append('<h4 class="modal-title">'+t+"</h4>"),this.createPinOptionsInModalDialog(),this.createCostumeOptionsDialog()}createPinOptionsInModalDialog(){$("#componentOptionsModalBody").append('<div id="componentOptionsPin" class="ui-widget row mb-4">'),$("#componentOptionsPin").append('<div class="col-md-2">Pin</div>'),$("#componentOptionsPin").append('<div id="pin" class="col-md-10"></div>');let t=this.getAllPossibleServoPins();for(let e=0;e<t.length;e++){$("#pin").append('<button type="button" id=pin'+t[e]+" name="+t[e]+' class="col-md-1 ml-2 mb-2 pinButton option_button_enabled">'+t[e]+"</button>"),this.getPin()==t[e]&&$("#pin"+t[e]).addClass("option_button_selected");let i=document.getElementById("pin"+t[e]);i.addEventListener("click",()=>{let t=i.name;this.setPin(t),$(".pinButton").removeClass("option_button_selected"),i.classList.add("option_button_selected"),this._eventBus.dispatchEvent(M.SAVE)})}1==this.getId()?($(".pinButton").prop("disabled",!0),$(".pinButton").addClass("option_button_disabled"),$("#pin36.pinButton").prop("disabled",!1),$("#pin36.pinButton").removeClass("option_button_disabled"),$("#pin36.pinButton").addClass("option_button_selected")):2==this.getId()?($(".pinButton").prop("disabled",!0),$(".pinButton").addClass("option_button_disabled"),$("#pin37.pinButton").prop("disabled",!1),$("#pin37.pinButton").removeClass("option_button_disabled"),$("#pin37.pinButton").addClass("option_button_selected")):($(".pinButton").removeClass("option_button_disabled"),$("#pin36.pinButton").prop("disabled",!0),$("#pin37.pinButton").prop("disabled",!0),$("#pin36.pinButton").addClass("option_button_disabled"),$("#pin37.pinButton").addClass("option_button_disabled"))}getAllPossibleServoPins(){return[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,36,37]}createCostumeOptionsDialog(){$("#componentOptionsModalBody").append('<div id="componentOptionsCostume" class="ui-widget row mb-4">'),$("#componentOptionsCostume").append('<div class="col-md-2">'+MSG.servoCostume+"</div>"),$("#componentOptionsCostume").append('<div id="costume" class="col-md-10"></div>');let t={plain:"./DwenguinoIDE/img/socialrobot/servo.png",eye:"./DwenguinoIDE/img/socialrobot/eye.png",mouth:"./DwenguinoIDE/img/socialrobot/mouth.png",righthand:"./DwenguinoIDE/img/socialrobot/righthand_icon.png",lefthand:"./DwenguinoIDE/img/socialrobot/lefthand_icon.png"};for(const[e,i]of Object.entries(O)){console.log(i),$("#costume").append('<div id="costume_inner" class="row"></div>'),$("#costume_inner").append("<div id=costume"+i+" name="+i+' class="col-lg-3 col-md-2 col-sm-3 col-xs-4 ml-2 mb-2 costumeButton"></div>'),$("#costume"+i).append('<img src="'+t[i]+'" class="img-responsive">');let e=document.getElementById("costume"+i);e.addEventListener("click",()=>{this._eventBus.dispatchEvent(M.CLEARCANVAS,this.getCanvasId());let t=e.getAttribute("name");switch(t){case O.PLAIN:this.setHtmlClasses("sim_canvas servo_canvas"),this.setCostume(t),this.setWidth(100),this.setHeight(50);break;case O.EYE:this.setHtmlClasses("servo_canvas"),this.setCostume(t),this.setWidth(35),this.setHeight(35);break;case O.RIGHTHAND:case O.LEFTHAND:this.setHtmlClasses("servo_canvas hand_canvas"),this.setCostume(t),this.setWidth(64),this.setHeight(149)}document.getElementById(this.getCanvasId()).className="",document.getElementById(this.getCanvasId()).className=this.getHtmlClasses(),this._eventBus.dispatchEvent(M.INITIALIZECANVAS,this),this._eventBus.dispatchEvent(M.SAVE)})}}getId(){return this._id}getType(){return this._type}setWidth(t){this._width=t}getWidth(){return this._width}setHeight(t){this._height=t}getHeight(t){return this._height}setX(t){this._x=t}getX(){return this._x}setY(t){this._y=t}getY(){return this._y}setOffset(t){this._offset=t}getOffset(){return this._offset}setAngle(t){this._angle=t}getAngle(){return this._angle}setPrevAngle(t){this._prevAngle=t}getPrevAngle(){return this._prevAngle}setImage(t,e){this._image[t].src=e}getImage(t){return this._image[t]}setBackgroundColor(t){this._backgroundColor=t}getBackgroundColor(){return this._backgroundColor}setPin(t){this._pin=t}getPin(){return this._pin}setCostume(t){switch(this._costume=t,t){case O.PLAIN:this._image[0].src="./DwenguinoIDE/img/socialrobot/servo_head.png";break;case O.EYE:this._image[0].src="./DwenguinoIDE/img/socialrobot/eye1_background.svg",this._image[1].src="./DwenguinoIDE/img/socialrobot/eye1_forground.svg";break;case O.RIGHTHAND:this._image[0].src="./DwenguinoIDE/img/socialrobot/righthand.png";break;case O.LEFTHAND:this._image[0].src="./DwenguinoIDE/img/socialrobot/lefthand.png"}}getServoBackground(){return this._backgroundImage}getServoBackgroundRotated(){return this._backgroundImageRotated}getCostume(){return this._costume}getCanvasId(){return this._canvasId}}const k={red:"red",yellow:"yellow",blue:"blue",green:"#72f542"};Object.freeze(k);class A extends C{constructor(t,e,i,o,s,n,a,r,l,d,c,g,p,h){super(t,h),this._id=e,this._type=F.LED,this._radius=n,this._x=a,this._y=r,this._offset={left:l,top:d},this._onColor=c,this._offColor=g,this._borderColor=p,this._pin=i,this._state=o,this._canvasId="sim_led_canvas"+this._id,this.insertHtml(),this.toggleVisibility(s)}toString(){return"led"}insertHtml(){$("#sim_container").append("<div id='sim_"+this.getType()+this.getId()+"' class='sim_element sim_element_"+this.getType()+" draggable'><div><span class='grippy'></span>"+MSG.simulator[this.getType()]+" "+this.getId()+"</div></div>"),$("#sim_"+this.getType()+this.getId()).css("top",this.getOffset().top+"px"),$("#sim_"+this.getType()+this.getId()).css("left",this.getOffset().left+"px"),$("#sim_"+this.getType()+this.getId()).append("<canvas id='"+this.getCanvasId()+"' class='"+this.getHtmlClasses()+"'></canvas>"),document.getElementById("sim_"+this.getType()+this.getId()).addEventListener("dblclick",()=>{this.createComponentOptionsModalDialog(MSG.ledOptions),this.showDialog()})}removeHtml(){$("#sim_"+this.toString()+this.getId()).remove()}toXml(){let t="";t=t.concat("<Item "),t=t.concat(" Type='",this.getType(),"'"),t=t.concat(" Id='",this.getId(),"'"),t=t.concat(" Radius='",this.getRadius(),"'");let e="#sim_"+this.getType()+this.getId();return t=$(e).attr("data-x")?t.concat(" OffsetLeft='",parseFloat(this.getOffset().left)+parseFloat($(e).attr("data-x")),"'"):t.concat(" OffsetLeft='",parseFloat(this.getOffset().left),"'"),t=$(e).attr("data-y")?t.concat(" OffsetTop='",parseFloat(this.getOffset().top)+parseFloat($(e).attr("data-y")),"'"):t.concat(" OffsetTop='",parseFloat(this.getOffset().top),"'"),t=t.concat(" OnColor='",this.getOnColor(),"'"),t=t.concat(" OffColor='",this.getOffColor(),"'"),t=t.concat(" BorderColor='",this.getBorderColor(),"'"),t=t.concat(" Pin='",this.getPin(),"'"),t=t.concat(" Classes='",this.getHtmlClasses(),"'"),t=t.concat("></Item>"),t}reset(){this.setX(0),this.setY(0),this.setState(0)}toggleVisibility(t){t?$("#sim_led"+this.getId()).css("visibility","visible"):$("#sim_led"+this.getId()).css("visibility","hidden")}showDialog(){$("#componentOptionsModal").modal("show")}removeDialog(){$("div").remove("#componentOptionsModal"),$(".modal-backdrop").remove()}createComponentOptionsModalDialog(t){this.removeDialog(),$("#db_body").append('<div id="componentOptionsModal" class="modal fade" role="dialog"></div>'),$("#componentOptionsModal").append('<div id="componentOptionsModalDialog" class="modal-dialog"></div>'),$("#componentOptionsModalDialog").append('<div id="componentOptionsModalContent" class="modal-content"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalHeader" class="modal-header"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalBody" class="modal-body container"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalFooter" class="modal-footer"></div>'),$("#componentOptionsModalHeader").append('<button type="button" class="close" data-dismiss="modal">&times;</button>'),$("#componentOptionsModalHeader").append('<h4 class="modal-title">'+t+"</h4>"),this.createPinOptionsInModalDialog(),this.createColorOptionsDialog()}createPinOptionsInModalDialog(){$("#componentOptionsModalBody").append('<div id="componentOptionsPin" class="ui-widget row mb-4">'),$("#componentOptionsPin").append('<div class="col-md-2">Pin</div>'),$("#componentOptionsPin").append('<div id="pin" class="col-md-10"></div>');let t=this.getAllPossiblePins();for(let e=0;e<t.length;e++){$("#pin").append('<button type="button" id=pin'+t[e]+" name="+t[e]+' class="col-md-1 ml-2 mb-2 pinButton option_button_enabled">'+t[e]+"</button>"),this.getPin()==t[e]&&$("#pin"+t[e]).addClass("option_button_selected");let i=document.getElementById("pin"+t[e]);i.addEventListener("click",()=>{let t=i.name;this.setPin(t),$(".pinButton").removeClass("option_button_selected"),i.classList.add("option_button_selected"),this._eventBus.dispatchEvent(M.SAVE)})}}getAllPossiblePins(){return[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]}createColorOptionsDialog(){$("#componentOptionsModalBody").append('<div id="componentOptionsColor" class="ui-widget row mb-4">'),$("#componentOptionsColor").append('<div class="col-md-2">Color</div>'),$("#componentOptionsColor").append('<div id="color" class="col-md-10"></div>');for(const[t,e]of Object.entries(k)){console.log(e),$("#color").append('<button type="button" id=color'+e+" name="+t+' class="col-md-1 ml-2 mb-2 colorButton"></buttons>');let i=document.getElementById("color"+e);i.classList.add(t),this.getOnColor()==t&&i.classList.add("colorButton_selected"),i.addEventListener("click",()=>{this._eventBus.dispatchEvent(M.CLEARCANVAS,this.getCanvasId());let t=i.getAttribute("name");this.setOnColor(t),$(".colorButton").removeClass("colorButton_selected"),i.classList.add("colorButton_selected"),this._eventBus.dispatchEvent(M.INITIALIZECANVAS,this),this._eventBus.dispatchEvent(M.SAVE)})}}getId(){return this._id}getType(){return this._type}setRadius(t){this._radius=t}getRadius(){return this._radius}setX(t){this._x=t}getX(){return this._x}setY(t){this._y=t}getY(){return this._y}setOffset(t){this._offset=t}getOffset(){return this._offset}setOnColor(t){this._onColor=t}getOnColor(){return this._onColor}setOffColor(t){this._offColor=t}getOffColor(){return this._offColor}setBorderColor(t){this._borderColor=t}getBorderColor(){return this._borderColor}setPin(t){this._pin=t}getPin(){return this._pin}setState(t){this._state=t}getState(){return this._state}getCanvasId(){return this._canvasId}}class D extends C{constructor(t,e,i=!0,o=5,s=5,n=""){super(t,n),this._id=e,this._type=F.LCD,this._offset={left:o,top:s},this._state=new Array(2),this.insertHtml(),this.toggleVisibility(i)}toString(){return"lcd"}insertHtml(){$("#sim_container").append("<div id='sim_lcd"+this.getId()+"' class='sim_element sim_element_lcd draggable'><div><span class='grippy'></span>Lcd</div></div>"),$("#sim_lcd"+this.getId()).css("top",this.getOffset().top+"px"),$("#sim_lcd"+this.getId()).css("left",this.getOffset().left+"px"),$("#sim_lcd"+this.getId()).append("<div id='sim_element_lcd_img'></div>"),$("#sim_element_lcd_img").append('<div class="lcd" id="sim_lcd_row0"></div>'),$("#sim_element_lcd_img").append('<div class="lcd" id="sim_lcd_row1"></div>')}removeHtml(){$("#sim_lcd"+this.getId()).remove()}toXml(){let t="";t=t.concat("<Item "),t=t.concat(" Type='",this.getType(),"'"),t=t.concat(" Id='",this.getId(),"'");let e="#sim_"+this.getType()+this.getId();return t=$(e).attr("data-x")?t.concat(" OffsetLeft='",parseFloat(this.getOffset().left)+parseFloat($(e).attr("data-x")),"'"):t.concat(" OffsetLeft='",parseFloat(this.getOffset().left),"'"),t=$(e).attr("data-y")?t.concat(" OffsetTop='",parseFloat(this.getOffset().top)+parseFloat($(e).attr("data-y")),"'"):t.concat(" OffsetTop='",parseFloat(this.getOffset().top),"'"),t=t.concat(" Classes='",this.getHtmlClasses(),"'"),t=t.concat("></Item>"),t}reset(){}toggleVisibility(t){t?$("#sim_lcd"+this.getId()).css("visibility","visible"):$("#sim_lcd"+this.getId()).css("visibility","hidden")}getId(){return this._id}getType(){return this._type}setOffset(t){this._offset=t}getOffset(){return this._offset}setState(t,e){this._state[0]=t,this._state[1]=e}getState(){return this._state}}class T{constructor(t,e,i,o,s,n="",a="",r="",l=""){this._id=t,this._parentId=e,this._minValue=i,this._maxValue=o,this._initialValue=s,this._label=n,this._valuePrefix=a,this._valueSuffix=r,this._sliderId="slider_"+this._id,this._sliderLabelId="slider_"+this._id+"_label",this._sliderValueId="slider_"+this._id+"_value",this._sliderRangeId="slider_"+this._id+"_range",this._classes=l,this.insert()}toString(){return"sonar"}insert(){document.getElementById(this.getSliderRangeId())?console.log("already exists"):(""!=this.getLabel()&&this.insertLabel(),$("#"+this.getParentId()).append('<div id="'+this.getSliderValueId()+'" class="">'+this.getValuePrefix()+this.getInitialValue()+this.getValueSuffix()+"</div>"),$("#"+this.getParentId()).append('<div id="'+this.getSliderId()+'" class="slidecontainer '+this.getClasses()+'"></div>'),$("#"+this.getSliderId()).append('<input id="'+this.getSliderRangeId()+'" type="range" min="'+this.getMinValue()+'" max="'+this.getMaxValue()+'" value="'+this.getInitialValue()+'" class="slider"></input>'))}insertLabel(){let t='<div id="'+this.getSliderLabelId()+'" class="slider_label">'+this.getLabel()+"</div>";$("#"+this.getParentId()).append(t)}updateValueLabel(t){document.getElementById(this.getSliderValueId()).innerHTML=this.getValuePrefix()+t+this.getValueSuffix()}remove(){$("#"+this.getSliderLabelId()).remove(),$("#"+this.getSliderValueId()).remove(),$("#"+this.getSliderId()).remove()}getParentId(){return this._parentId}getSliderElement(){return document.getElementById(this.getSliderRangeId())}getInitialValue(){return this._initialValue}getMinValue(){return this._minValue}getMaxValue(){return this._maxValue}getLabel(){return this._label}getValuePrefix(){return this._valuePrefix}getValueSuffix(){return this._valueSuffix}getSliderId(){return this._sliderId}getSliderLabelId(){return this._sliderLabelId}getSliderValueId(){return this._sliderValueId}getSliderRangeId(){return this._sliderRangeId}getClasses(){return this._classes}}class B extends C{constructor(t,e,i=0,o=0,s=100,n=!0,a=100,r=58,l=5,d=5,c="sim_canvas sonar_canvas"){super(t,c),this._id=e,this._type=F.SONAR,this._width=a,this._height=r,this._offset={left:l,top:d},this._image=new Image,this._image.src="./DwenguinoIDE/img/board/sonar.png",this._echoPin=i,this._triggerPin=o,this._state=s,this._stateUpdated=!1,this._canvasId="sim_sonar_canvas"+this._id,this.insertHtml(),this.toggleVisibility(n)}toString(){return"sonar"}insertHtml(){$("#sim_container").append("<div id='sim_"+this.getType()+this.getId()+"' class='sim_element sim_element_"+this.getType()+" draggable'><div><span class='grippy'></span>"+MSG.simulator[this.getType()]+" "+this.getId()+"</div></div>"),$("#sim_"+this.getType()+this.getId()).css("top",this.getOffset().top+"px"),$("#sim_"+this.getType()+this.getId()).css("left",this.getOffset().left+"px"),$("#sim_"+this.getType()+this.getId()).append("<canvas id='"+this.getCanvasId()+"' class='"+this.getHtmlClasses()+"'></canvas>");let t=MSG.sonarSliderLabel+" "+this.getId();this._slider=new T(this.getId(),"sensor_options",0,200,100,t,""," cm","sonar_slider");var e=this;this._slider.getSliderElement().oninput=function(){let t=e.getId();e.changeSonarDistance(this.value,t),e._slider.updateValueLabel(this.value)},document.getElementById("sim_"+this.getType()+this.getId()).addEventListener("dblclick",()=>{this.createComponentOptionsModalDialog(MSG.sonarOptions),this.showDialog()})}changeSonarDistance(t){this.setState(t),this._stateUpdated=!0,this._eventBus.dispatchEvent(M.SAVE)}removeHtml(){$("#sim_"+this.getType()+this.getId()).remove(),$("#"+this.getSliderLabelId()).remove(),$("#"+this.getSliderValueId()).remove(),$("#"+this.getSliderId()).remove()}toXml(){let t="";t=t.concat("<Item "),t=t.concat(" Type='",this.getType(),"'"),t=t.concat(" Id='",this.getId(),"'"),t=t.concat(" Width='",this.getWidth(),"'"),t=t.concat(" Height='",this.getHeight(),"'");let e="#sim_"+this.getType()+this.getId();return t=$(e).attr("data-x")?t.concat(" OffsetLeft='",parseFloat(this.getOffset().left)+parseFloat($(e).attr("data-x")),"'"):t.concat(" OffsetLeft='",parseFloat(this.getOffset().left),"'"),t=$(e).attr("data-y")?t.concat(" OffsetTop='",parseFloat(this.getOffset().top)+parseFloat($(e).attr("data-y")),"'"):t.concat(" OffsetTop='",parseFloat(this.getOffset().top),"'"),t=t.concat(" EchoPin='",this.getEchoPin(),"'"),t=t.concat(" TriggerPin='",this.getTriggerPin(),"'"),t=t.concat(" State='",this.getState(),"'"),t=t.concat(" Classes='",this.getHtmlClasses(),"'"),t=t.concat("></Item>"),t}reset(){}toggleVisibility(t){t?$("#sim_sonar"+this.getId()).css("visibility","visible"):$("#sim_sonar"+this.getId()).css("visibility","hidden")}showDialog(){$("#componentOptionsModal").modal("show")}removeDialog(){$("div").remove("#componentOptionsModal"),$(".modal-backdrop").remove()}createComponentOptionsModalDialog(t){this.removeDialog(),$("#db_body").append('<div id="componentOptionsModal" class="modal fade" role="dialog"></div>'),$("#componentOptionsModal").append('<div id="componentOptionsModalDialog" class="modal-dialog"></div>'),$("#componentOptionsModalDialog").append('<div id="componentOptionsModalContent" class="modal-content"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalHeader" class="modal-header"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalBody" class="modal-body container"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalFooter" class="modal-footer"></div>'),$("#componentOptionsModalHeader").append('<button type="button" class="close" data-dismiss="modal">&times;</button>'),$("#componentOptionsModalHeader").append('<h4 class="modal-title">'+t+"</h4>"),this.createPinOptionsInModalDialog()}createPinOptionsInModalDialog(){$("#componentOptionsModalBody").append('<div id="componentOptionsTriggerPin" class="ui-widget row mb-4"></div>'),$("#componentOptionsTriggerPin").append('<div class="col-md-2">Trigger pin</div>'),$("#componentOptionsTriggerPin").append('<div id="triggerPin" class="col-md-10"></div>'),$("#componentOptionsModalBody").append('<div id="componentOptionsEchoPin" class="ui-widget row mb-4"></div>'),$("#componentOptionsEchoPin").append('<div class="col-md-2">Echo pin</div>'),$("#componentOptionsEchoPin").append('<div id="echoPin" class="col-md-10"></div>');let t=this.getAllPossiblePins();for(let e=0;e<t.length;e++)$("#triggerPin").append('<button type="button" id=triggerPin'+t[e]+" name="+t[e]+' class="col-md-1 ml-2 mb-2 triggerPinButton pinButton option_button_enabled">'+t[e]+"</button>"),$("#echoPin").append('<button type="button" id=echoPin'+t[e]+" name="+t[e]+' class="col-md-1 ml-2 mb-2 echoPinButton pinButton option_button_enabled">'+t[e]+"</button>");for(let e=0;e<t.length;e++){this.getTriggerPin()==t[e]&&($("#triggerPin"+t[e]).addClass("option_button_selected"),$("#echoPin"+t[e]).addClass("option_button_disabled"),$("#echoPin"+t[e]).prop("disabled",!0)),this.getEchoPin()==t[e]&&($("#echoPin"+t[e]).addClass("option_button_selected"),$("#triggerPin"+t[e]).addClass("option_button_disabled"),$("#triggerPin"+t[e]).prop("disabled",!0));let i=document.getElementById("triggerPin"+t[e]),o=document.getElementById("echoPin"+t[e]);i.addEventListener("click",()=>{let t=i.name;this.setTriggerPin(t),$(".triggerPinButton").removeClass("option_button_selected"),i.classList.add("option_button_selected"),this._eventBus.dispatchEvent(M.SAVE),$(".echoPinButton").removeClass("option_button_disabled"),$(".echoPinButton").prop("disabled",!1),$("#echoPin"+t).addClass("option_button_disabled"),$("#echoPin"+t).prop("disabled",!0)}),o.addEventListener("click",()=>{let t=o.name;this.setEchoPin(t),$(".echoPinButton").removeClass("option_button_selected"),o.classList.add("option_button_selected"),this._eventBus.dispatchEvent(M.SAVE),$(".triggerPinButton").removeClass("option_button_disabled"),$(".triggerPinButton").prop("disabled",!1),$("#triggerPin"+t).addClass("option_button_disabled"),$("#triggerPin"+t).prop("disabled",!0)})}}getAllPossiblePins(){return[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]}getId(){return this._id}getType(){return this._type}setWidth(t){this._width=t}getWidth(){return this._width}setHeight(t){this._height=t}getHeight(){return this._height}setOffset(t){this._offset=t}getOffset(){return this._offset}setImage(t){this._image.src=t}getImage(){return this._image}setEchoPin(t){this._echoPin=t}getEchoPin(){return this._echoPin}setTriggerPin(t){this._triggerPin=t}getTriggerPin(){return this._triggerPin}setState(t){this._state=t}getState(){return this._state}isStateUpdated(){return this._stateUpdated}getCanvasId(){return this._canvasId}getSliderId(){return this._sliderId}getSliderLabelId(){return this._sliderLabelId}getSliderValueId(){return this._sliderValueId}getSliderRangeId(){return this._sliderRangeId}}const R={SERVO:"servo",LED:"led",PIR:"pir",SONAR:"sonar",LCD:"lcd",SOUND:"sound",LIGHT:"light",BUZZER:"buzzer"};Object.freeze(R);class x{constructor(){if(void 0===this.toString)throw new Error("You have to implement the method toString");if(void 0===this.getType)throw new Error("You have to implement the method getType")}}class L extends x{constructor(){super()}toString(){return"sound"}static getType(){return R.SOUND}static getDescription(){return""}static getInputPins(){return[]}static getOutputPins(){return[]}}class H{constructor(t,e,i="",o=""){this._id=t,this._parentId=e,this._label=i,this._buttonLabelId="button_"+this._id+"_label",this._buttonId="button_"+this._id+"_button",this._labelClasses=o,this._activeClasses="dwenguino_button dwenguino_button_pushed",this._inactiveClasses="dwenguino_button",this.insert()}toString(){return"sonar"}insert(){document.getElementById(this.getButtonId())?console.log("A button with id ",this.getButtonId()," already exists."):(""!=this.getLabel()&&$("#"+this.getParentId()).append('<div id="'+this.getButtonLabelId()+'" class="'+this.getLabelClasses()+'">'+this.getLabel()+"</div>"),$("#"+this.getParentId()).append('<div id="'+this.getButtonId()+'" class="'+this.getInactiveClasses()+'"></div>'))}update(){this.isInactive()?this.getButtonElement().className=this.getActiveClasses():this.getButtonElement().className=this.getInactiveClasses()}remove(){$("#"+this.getButtonLabelId()).remove(),$("#"+this.getButtonId()).remove()}getParentId(){return this._parentId}getButtonElement(){return document.getElementById(this.getButtonId())}getLabel(){return this._label}getButtonLabelId(){return this._buttonLabelId}getButtonId(){return this._buttonId}getLabelClasses(){return this._labelClasses}getInactiveClasses(){return this._inactiveClasses}getActiveClasses(){return this._activeClasses}isInactive(){return this.getButtonElement().className===this.getInactiveClasses()}isActive(){return this.getButtonElement().className===this.getActiveClasses()}}class N extends C{constructor(t,e,i,o,s,n,a,r,l,d){super(t,d),this._id=e,this._type=F.PIR,this._width=n,this._height=a,this._offset={left:r,top:l},this._image=new Image,this._image.src="./DwenguinoIDE/img/socialrobot/pir_off.png",this._pin=i,this._state=o,this._stateUpdated=!1,this._canvasId="sim_pir_canvas"+this._id,this.insertHtml(),this.toggleVisibility(s)}toString(){return"pir"}insertHtml(){$("#sim_container").append("<div id='sim_"+this.getType()+this.getId()+"' class='sim_element sim_element_"+this.getType()+" draggable'><div><span class='grippy'></span>"+MSG.simulator[this.getType()]+" "+this.getId()+"</div></div>"),$("#sim_"+this.getType()+this.getId()).css("top",this.getOffset().top+"px"),$("#sim_"+this.getType()+this.getId()).css("left",this.getOffset().left+"px"),$("#sim_"+this.getType()+this.getId()).append("<canvas id='"+this.getCanvasId()+"' class='"+this.getHtmlClasses()+"'></canvas>");let t=MSG.pirButtonLabel+" "+this.getId(),e=""+this.getType()+this.getId();this._button=new H(e,"sensor_options",t);var i=this;this._button.getButtonElement().onclick=function(){i._button.update(),i._button.isActive()?(i.setImage("./DwenguinoIDE/img/socialrobot/pir_on.png"),i.setState(1),i._stateUpdated=!0,i._eventBus.dispatchEvent(M.SAVE)):(i.setImage("./DwenguinoIDE/img/socialrobot/pir_off.png"),i.setState(0),i._stateUpdated=!0,i._eventBus.dispatchEvent(M.SAVE))},document.getElementById("sim_"+this.getType()+this.getId()).addEventListener("dblclick",()=>{this.createComponentOptionsModalDialog(MSG.pirOptions),this.showDialog()})}removeHtml(){$("#sim_pir"+this.getId()).remove();let t="#button"+this.getId()+"_label",e="#pir_button"+this.getId();$(t).remove(),$(e).remove()}toggleVisibility(t){t?$("#sim_pir"+this.getId()).css("visibility","visible"):$("#sim_pir"+this.getId()).css("visibility","hidden")}toXml(){let t="";t=t.concat("<Item "),t=t.concat(" Type='",this.getType(),"'"),t=t.concat(" Id='",this.getId(),"'"),t=t.concat(" Width='",this.getWidth(),"'"),t=t.concat(" Height='",this.getHeight(),"'");let e="#sim_"+this.getType()+this.getId();return t=$(e).attr("data-x")?t.concat(" OffsetLeft='",parseFloat(this.getOffset().left)+parseFloat($(e).attr("data-x")),"'"):t.concat(" OffsetLeft='",parseFloat(this.getOffset().left),"'"),t=$(e).attr("data-y")?t.concat(" OffsetTop='",parseFloat(this.getOffset().top)+parseFloat($(e).attr("data-y")),"'"):t.concat(" OffsetTop='",parseFloat(this.getOffset().top),"'"),t=t.concat(" Pin='",this.getPin(),"'"),t=t.concat(" State='",this.getState(),"'"),t=t.concat(" Classes='",this.getHtmlClasses(),"'"),t=t.concat("></Item>"),t}reset(){this.setState(0),this._stateUpdated=!1}showDialog(){$("#componentOptionsModal").modal("show")}removeDialog(){$("div").remove("#componentOptionsModal"),$(".modal-backdrop").remove()}createComponentOptionsModalDialog(t){this.removeDialog(),$("#db_body").append('<div id="componentOptionsModal" class="modal fade" role="dialog"></div>'),$("#componentOptionsModal").append('<div id="componentOptionsModalDialog" class="modal-dialog"></div>'),$("#componentOptionsModalDialog").append('<div id="componentOptionsModalContent" class="modal-content"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalHeader" class="modal-header"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalBody" class="modal-body container"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalFooter" class="modal-footer"></div>'),$("#componentOptionsModalHeader").append('<button type="button" class="close" data-dismiss="modal">&times;</button>'),$("#componentOptionsModalHeader").append('<h4 class="modal-title">'+t+"</h4>"),this.createPinOptionsInModalDialog()}createPinOptionsInModalDialog(){$("#componentOptionsModalBody").append('<div id="componentOptionsPin" class="ui-widget row mb-4">'),$("#componentOptionsPin").append('<div class="col-md-2">Pin</div>'),$("#componentOptionsPin").append('<div id="pin" class="col-md-10"></div>');let t=this.getAllPossiblePins();for(let e=0;e<t.length;e++){$("#pin").append('<button type="button" id=pin'+t[e]+" name="+t[e]+' class="col-md-1 ml-2 mb-2 pinButton option_button_enabled">'+t[e]+"</button>"),this.getPin()==t[e]&&$("#pin"+t[e]).addClass("option_button_selected");let i=document.getElementById("pin"+t[e]);i.addEventListener("click",()=>{let t=i.name;this.setPin(t),$(".pinButton").removeClass("option_button_selected"),i.classList.add("option_button_selected"),this._eventBus.dispatchEvent(M.SAVE)})}}getAllPossiblePins(){return[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]}getId(){return this._id}getType(){return this._type}setWidth(t){this._width=t}getWidth(){return this._width}setHeight(t){this._height=t}getHeight(){return this._height}setOffset(t){this._offset=t}getOffset(){return this._offset}setImage(t){this._image.src=t}getImage(){return this._image}setPin(t){this._pin=t}getPin(){return this._pin}setState(t){this._state=t}getState(){return this._state}isStateUpdated(){return this._stateUpdated}getCanvasId(){return this._canvasId}}class G extends C{constructor(t,e,i,o,s,n,a,r,l,d){super(t,d),this._id=e,this._type=F.SOUND,this._width=n,this._height=a,this._offset={left:r,top:l},this._image=new Image,this._image.src="./DwenguinoIDE/img/socialrobot/sound_sensor.png",this._pin=i,this._state=o,this._stateUpdated=!1,this._canvasId="sim_sound_canvas"+this._id,this.insertHtml(),this.toggleVisibility(s)}toString(){return"sound sensor"}insertHtml(){$("#sim_container").append("<div id='sim_"+this.getType()+this.getId()+"' class='sim_element sim_element_"+this.getType()+" draggable'><div><span class='grippy'></span>"+MSG.simulator[this.getType()]+" "+this.getId()+"</div></div>"),$("#sim_"+this.getType()+this.getId()).css("top",this.getOffset().top+"px"),$("#sim_"+this.getType()+this.getId()).css("left",this.getOffset().left+"px"),$("#sim_"+this.getType()+this.getId()).append("<canvas id='"+this.getCanvasId()+"' class='"+this.getHtmlClasses()+"'></canvas>");let t=this.getType()+"_button"+this.getId()+"_label",e=this.getType()+"_button"+this.getId();document.getElementById(e)||($("#sensor_options").append("<div id='"+t+"' class='sensor_options_label' alt='Load'>"+MSG.soundButtonLabel+" "+this.getId()+"</div>"),$("#sensor_options").append("<div id='"+e+"' class='sound_button' alt='Load'></div>"),this.addSoundSensorEventHandler(e)),document.getElementById("sim_"+this.getType()+this.getId()).addEventListener("dblclick",()=>{this.createComponentOptionsModalDialog(MSG.soundOptions),this.showDialog()})}addSoundSensorEventHandler(t){var e=this;$("#"+t).on("click",(function(){"sound_button"===document.getElementById(t).className?(document.getElementById(t).className="sound_button sound_button_pushed",e.setImage("./DwenguinoIDE/img/socialrobot/sound_sensor.png"),e.setState(1),e._stateUpdated=!0,e._eventBus.dispatchEvent(M.SAVE)):(document.getElementById(t).className="sound_button",e.setImage("./DwenguinoIDE/img/socialrobot/sound_sensor.png"),e.setState(0),e._stateUpdated=!0,e._eventBus.dispatchEvent(M.SAVE))}))}removeHtml(){$("#sim_sound"+this.getId()).remove();let t="#"+this.getType()+"_button"+this.getId()+"_label",e="#"+this.getType()+"_button"+this.getId();$(t).remove(),$(e).remove()}toggleVisibility(t){t?$("#sim_sound"+this.getId()).css("visibility","visible"):$("#sim_sound"+this.getId()).css("visibility","hidden")}toXml(){let t="";t=t.concat("<Item "),t=t.concat(" Type='",this.getType(),"'"),t=t.concat(" Id='",this.getId(),"'"),t=t.concat(" Width='",this.getWidth(),"'"),t=t.concat(" Height='",this.getHeight(),"'");let e="#sim_"+this.getType()+this.getId();return t=$(e).attr("data-x")?t.concat(" OffsetLeft='",parseFloat(this.getOffset().left)+parseFloat($(e).attr("data-x")),"'"):t.concat(" OffsetLeft='",parseFloat(this.getOffset().left),"'"),t=$(e).attr("data-y")?t.concat(" OffsetTop='",parseFloat(this.getOffset().top)+parseFloat($(e).attr("data-y")),"'"):t.concat(" OffsetTop='",parseFloat(this.getOffset().top),"'"),t=t.concat(" Pin='",this.getPin(),"'"),t=t.concat(" State='",this.getState(),"'"),t=t.concat(" Classes='",this.getHtmlClasses(),"'"),t=t.concat("></Item>"),t}reset(){this.setState(0),this._stateUpdated=!1}showDialog(){$("#componentOptionsModal").modal("show")}removeDialog(){$("div").remove("#componentOptionsModal"),$(".modal-backdrop").remove()}createComponentOptionsModalDialog(t){this.removeDialog(),$("#db_body").append('<div id="componentOptionsModal" class="modal fade" role="dialog"></div>'),$("#componentOptionsModal").append('<div id="componentOptionsModalDialog" class="modal-dialog"></div>'),$("#componentOptionsModalDialog").append('<div id="componentOptionsModalContent" class="modal-content"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalHeader" class="modal-header"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalBody" class="modal-body container"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalFooter" class="modal-footer"></div>'),$("#componentOptionsModalHeader").append('<button type="button" class="close" data-dismiss="modal">&times;</button>'),$("#componentOptionsModalHeader").append('<h4 class="modal-title">'+t+"</h4>"),this.createPinOptionsInModalDialog()}createPinOptionsInModalDialog(){$("#componentOptionsModalBody").append('<div id="componentOptionsPin" class="ui-widget row mb-4">'),$("#componentOptionsPin").append('<div class="col-md-2">Pin</div>'),$("#componentOptionsPin").append('<div id="pin" class="col-md-10"></div>');let t=this.getAllPossiblePins();for(let e=0;e<t.length;e++){$("#pin").append('<button type="button" id=pin'+t[e]+" name="+t[e]+' class="col-md-1 ml-2 mb-2 pinButton option_button_enabled">'+t[e]+"</button>"),this.getPin()==t[e]&&$("#pin"+t[e]).addClass("option_button_selected");let i=document.getElementById("pin"+t[e]);i.addEventListener("click",()=>{let t=i.name;this.setPin(t),$(".pinButton").removeClass("option_button_selected"),i.classList.add("option_button_selected"),this._eventBus.dispatchEvent(M.SAVE)})}}getAllPossiblePins(){return[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]}getId(){return this._id}getType(){return this._type}setWidth(t){this._width=t}getWidth(){return this._width}setHeight(t){this._height=t}getHeight(){return this._height}setOffset(t){this._offset=t}getOffset(){return this._offset}setImage(t){this._image.src=t}getImage(){return this._image}setPin(t){this._pin=t}getPin(){return this._pin}setState(t){this._state=t}getState(){return this._state}isStateUpdated(){return this._stateUpdated}getCanvasId(){return this._canvasId}}class W extends C{constructor(t,e,i,o,s,n,a,r,l,d){super(t,d),this._id=e,this._type=F.LIGHT,this._width=n,this._height=a,this._offset={left:r,top:l},this._image=new Image,this._image.src="./DwenguinoIDE/img/socialrobot/light_sensor.png",this._pin=i,this._state=o,this._stateUpdated=!1,this._canvasId="sim_light_canvas"+this._id,this.insertHtml(),this.toggleVisibility(s)}toString(){return"light sensor"}insertHtml(){$("#sim_container").append("<div id='sim_"+this.getType()+this.getId()+"' class='sim_element sim_element_"+this.getType()+" draggable'><div><span class='grippy'></span>"+MSG.simulator[this.getType()]+" "+this.getId()+"</div></div>"),$("#sim_"+this.getType()+this.getId()).css("top",this.getOffset().top+"px"),$("#sim_"+this.getType()+this.getId()).css("left",this.getOffset().left+"px"),$("#sim_"+this.getType()+this.getId()).append("<canvas id='"+this.getCanvasId()+"' class='"+this.getHtmlClasses()+"'></canvas>");let t=this.getType()+"_button"+this.getId()+"_label",e=this.getType()+"_button"+this.getId();document.getElementById(e)||($("#sensor_options").append("<div id='"+t+"' class='sensor_options_label' alt='Load'>"+MSG.lightButtonLabel+" "+this.getId()+"</div>"),$("#sensor_options").append("<div id='"+e+"' class='light_button' alt='Load'></div>"),this.addLightSensorEventHandler(e)),document.getElementById("sim_"+this.getType()+this.getId()).addEventListener("dblclick",()=>{this.createComponentOptionsModalDialog(MSG.lightOptions),this.showDialog()})}addLightSensorEventHandler(t){var e=this;$("#"+t).on("click",(function(){"light_button"===document.getElementById(t).className?(document.getElementById(t).className="light_button light_button_pushed",e.setImage("./DwenguinoIDE/img/socialrobot/light_sensor.png"),e.setState(1),e._stateUpdated=!0,e._eventBus.dispatchEvent(M.SAVE)):(document.getElementById(t).className="light_button",e.setImage("./DwenguinoIDE/img/socialrobot/light_sensor.png"),e.setState(0),e._stateUpdated=!0,e._eventBus.dispatchEvent(M.SAVE))}))}removeHtml(){$("#sim_light"+this.getId()).remove();let t="#"+this.getType()+"_button"+this.getId()+"_label",e="#"+this.getType()+"_button"+this.getId();$(t).remove(),$(e).remove()}toggleVisibility(t){t?$("#sim_light"+this.getId()).css("visibility","visible"):$("#sim_light"+this.getId()).css("visibility","hidden")}toXml(){let t="";t=t.concat("<Item "),t=t.concat(" Type='",this.getType(),"'"),t=t.concat(" Id='",this.getId(),"'"),t=t.concat(" Width='",this.getWidth(),"'"),t=t.concat(" Height='",this.getHeight(),"'");let e="#sim_"+this.getType()+this.getId();return t=$(e).attr("data-x")?t.concat(" OffsetLeft='",parseFloat(this.getOffset().left)+parseFloat($(e).attr("data-x")),"'"):t.concat(" OffsetLeft='",parseFloat(this.getOffset().left),"'"),t=$(e).attr("data-y")?t.concat(" OffsetTop='",parseFloat(this.getOffset().top)+parseFloat($(e).attr("data-y")),"'"):t.concat(" OffsetTop='",parseFloat(this.getOffset().top),"'"),t=t.concat(" Pin='",this.getPin(),"'"),t=t.concat(" State='",this.getState(),"'"),t=t.concat(" Classes='",this.getHtmlClasses(),"'"),t=t.concat("></Item>"),t}reset(){this.setState(0),this._stateUpdated=!1}showDialog(){$("#componentOptionsModal").modal("show")}removeDialog(){$("div").remove("#componentOptionsModal"),$(".modal-backdrop").remove()}createComponentOptionsModalDialog(t){this.removeDialog(),$("#db_body").append('<div id="componentOptionsModal" class="modal fade" role="dialog"></div>'),$("#componentOptionsModal").append('<div id="componentOptionsModalDialog" class="modal-dialog"></div>'),$("#componentOptionsModalDialog").append('<div id="componentOptionsModalContent" class="modal-content"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalHeader" class="modal-header"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalBody" class="modal-body container"></div>'),$("#componentOptionsModalContent").append('<div id="componentOptionsModalFooter" class="modal-footer"></div>'),$("#componentOptionsModalHeader").append('<button type="button" class="close" data-dismiss="modal">&times;</button>'),$("#componentOptionsModalHeader").append('<h4 class="modal-title">'+t+"</h4>"),this.createPinOptionsInModalDialog()}createPinOptionsInModalDialog(){$("#componentOptionsModalBody").append('<div id="componentOptionsPin" class="ui-widget row mb-4">'),$("#componentOptionsPin").append('<div class="col-md-2">Pin</div>'),$("#componentOptionsPin").append('<div id="pin" class="col-md-10"></div>');let t=this.getAllPossiblePins();for(let e=0;e<t.length;e++){$("#pin").append('<button type="button" id=pin'+t[e]+" name="+t[e]+' class="col-md-1 ml-2 mb-2 pinButton option_button_enabled">'+t[e]+"</button>"),this.getPin()==t[e]&&$("#pin"+t[e]).addClass("option_button_selected");let i=document.getElementById("pin"+t[e]);i.addEventListener("click",()=>{let t=i.name;this.setPin(t),$(".pinButton").removeClass("option_button_selected"),i.classList.add("option_button_selected"),this._eventBus.dispatchEvent(M.SAVE)})}}getAllPossiblePins(){return[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]}getId(){return this._id}getType(){return this._type}setWidth(t){this._width=t}getWidth(){return this._width}setHeight(t){this._height=t}getHeight(){return this._height}setOffset(t){this._offset=t}getOffset(){return this._offset}setImage(t){this._image.src=t}getImage(){return this._image}setPin(t){this._pin=t}getPin(){return this._pin}setState(t){this._state=t}getState(){return this._state}isStateUpdated(){return this._stateUpdated}getCanvasId(){return this._canvasId}}function V(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const F={SERVO:"servo",LED:"led",PIR:"pir",SONAR:"sonar",LCD:"lcd",SOUND:"sound",LIGHT:"light"};Object.freeze(F);class U{constructor(t,e,i){V(this,"logger",null),V(this,"inputState",{pir:0,buttons:[1,1,1,1,1],sonarDistance:-1}),this.logger=e,this._eventBus=i,this._robot=[],this._numberOfComponentsOfType={},this.scenarioUtils=t,this.renderer=new I;for(const[t,e]of Object.entries(F))this._numberOfComponentsOfType[e]=0}getRobot(){return this._robot}resetSocialRobot(){for(var t=0;t<this._robot.length;t++)this._robot[t].reset()}updateScenarioState(t){for(var e=0;e<this._robot.length;e++){let i=0;switch(this._robot[e].getType()){case F.SERVO:i=this._robot[e].getPin(),36===i?this._robot[e].getAngle()!=t.getServoAngle(1)&&(this._robot[e].setPrevAngle(this._robot[e].getAngle()),this._robot[e].setAngle(t.getServoAngle(1))):37===i?this._robot[e].getAngle()!=t.getServoAngle(2)&&(this._robot[e].setPrevAngle(this._robot[e].getAngle()),this._robot[e].setAngle(t.getServoAngle(2))):this._robot[e].getAngle()!=t.getIoPinState(i)&&(this._robot[e].setPrevAngle(this._robot[e].getAngle()),this._robot[e].setAngle(t.getIoPinState(i)));break;case F.LED:i=this._robot[e].getPin(),this._robot[e].setState(t.getIoPinState(i));break;case F.PIR:i=this._robot[e].getPin(),this._robot[e].isStateUpdated()&&(t.setIoPinState(i,this._robot[e].getState()),this._robot[e]._stateUpdated=!1);break;case F.SONAR:let o=this._robot[e].getEchoPin(),s=this._robot[e].getTriggerPin();this._robot[e].isStateUpdated()&&(t.setIoPinState(o,this._robot[e].getState()),t.setIoPinState(s,this._robot[e].getState()),this._robot[e]._stateUpdated=!1);break;case F.LCD:this._robot[e].setState(t.getLcdContent(0),t.getLcdContent(1));break;case F.SOUND:i=this._robot[e].getPin(),console.log(i),this._robot[e].isStateUpdated()&&(t.setIoPinState(i,this._robot[e].getState()),this._robot[e]._stateUpdated=!1,console.log(this._robot[e].getState()));break;case F.LIGHT:i=this._robot[e].getPin(),this._robot[e].isStateUpdated()&&(t.setIoPinState(i,this._robot[e].getState()),this._robot[e]._stateUpdated=!1)}}}getInputState(){return this.inputState}getRobotComponentWithTypeAndId(t,e){for(let i=0;i<this._robot.length;i++)if(this._robot[i].getType()==t&&this._robot[i].getId()==e)return this._robot[i]}removeRobotComponentWithTypeAndId(t,e){this.getRobotComponentWithTypeAndId(t,e).removeHtml();for(let i=0;i<this._robot.length;i++)this._robot[i].getType()==t&&this._robot[i].getId()==e&&(this._robot.splice(i,1),this.decrementNumberOf(t))}addRobotComponent(t){switch(t){case F.SERVO:this.addServo();break;case F.LED:this.addLed();break;case F.PIR:this.addPir();break;case F.SONAR:this.addSonar();break;case F.LCD:this.addLcd();break;case F.SOUND:this.addSoundSensor();break;case F.LIGHT:this.addLightSensor()}}removeRobotComponent(t){switch(t){case F.SERVO:this.removeServo();break;case F.LED:this.removeLed();break;case F.PIR:this.removePir();break;case F.SONAR:this.removeSonar();break;case F.LCD:this.removeLcd();break;case F.SOUND:this.removeSoundSensor();break;case F.LIGHT:this.removeLightSensor()}}addRobotComponentFromXml(t){switch(t.getAttribute("Type")){case F.SERVO:var e=parseFloat(t.getAttribute("Width")),i=parseFloat(t.getAttribute("Height")),o=parseFloat(t.getAttribute("OffsetLeft")),s=parseFloat(t.getAttribute("OffsetTop")),n=parseInt(t.getAttribute("Angle")),a=parseInt(t.getAttribute("Pin")),r=t.getAttribute("Costume"),l=t.getAttribute("Classes");this.addServo(a,r,n,!0,0,0,e,i,o,s,l);break;case F.LED:var d=parseFloat(t.getAttribute("Radius")),c=(o=parseFloat(t.getAttribute("OffsetLeft")),s=parseFloat(t.getAttribute("OffsetTop")),t.getAttribute("OnColor")),g=t.getAttribute("OffColor"),p=t.getAttribute("BorderColor");a=parseInt(t.getAttribute("Pin")),l=t.getAttribute("Classes");this.addLed(a,0,!0,d,0,0,o,s,c,g,p,l);break;case F.PIR:e=parseFloat(t.getAttribute("Width")),i=parseFloat(t.getAttribute("Height")),o=parseFloat(t.getAttribute("OffsetLeft")),s=parseFloat(t.getAttribute("OffsetTop")),a=parseInt(t.getAttribute("Pin"));var h=parseInt(t.getAttribute("State"));l=t.getAttribute("Classes");this.addPir(a,h,!0,e,i,o,s,l);break;case F.SONAR:e=parseFloat(t.getAttribute("Width")),i=parseFloat(t.getAttribute("Height")),o=parseFloat(t.getAttribute("OffsetLeft")),s=parseFloat(t.getAttribute("OffsetTop"));var u=parseInt(t.getAttribute("EchoPin")),m=parseInt(t.getAttribute("TriggerPin"));h=parseInt(t.getAttribute("State")),l=t.getAttribute("Classes");this.addSonar(u,m,h,!0,e,i,o,s,l);break;case F.LCD:o=parseFloat(t.getAttribute("OffsetLeft")),s=parseFloat(t.getAttribute("OffsetTop")),l=t.getAttribute("Classes");this.addLcd(!0,o,s,l);break;case F.SOUND:e=parseFloat(t.getAttribute("Width")),i=parseFloat(t.getAttribute("Height")),o=parseFloat(t.getAttribute("OffsetLeft")),s=parseFloat(t.getAttribute("OffsetTop")),a=parseInt(t.getAttribute("Pin")),h=parseInt(t.getAttribute("State")),l=t.getAttribute("Classes");this.addSoundSensor(a,h,!0,e,i,o,s,l);break;case F.LIGHT:e=parseFloat(t.getAttribute("Width")),i=parseFloat(t.getAttribute("Height")),o=parseFloat(t.getAttribute("OffsetLeft")),s=parseFloat(t.getAttribute("OffsetTop")),a=parseInt(t.getAttribute("Pin")),h=parseInt(t.getAttribute("State")),l=t.getAttribute("Classes");this.addLightSensor(a,h,!0,e,i,o,s,l)}}addServo(t=0,e=O.PLAIN,i=0,o=!0,s=0,n=0,a=100,r=50,l=5,d=5,c="sim_canvas servo_canvas"){this.logger.recordEvent(this.logger.createEvent(f.addRobotComponent,F.SERVO)),this.incrementNumberOf(F.SERVO);let g=this._numberOfComponentsOfType[F.SERVO];1==g?t=36:2==g&&(t=37);let p=new E(this._eventBus,g,t,e,i,o,s,n,a,r,l,d,c);this._robot.push(p),this.renderer.initializeCanvas(this._robot,p)}removeServo(){this.logger.recordEvent(this.logger.createEvent(f.removeRobotComponent,F.SERVO));let t=this._numberOfComponentsOfType[F.SERVO];this.removeRobotComponentWithTypeAndId(F.SERVO,t)}addLed(t=0,e=0,i=!0,o=10,s=0,n=0,a=5,r=5,l="yellow",d="gray",c="black",g="sim_canvas led_canvas"){this.logger.recordEvent(this.logger.createEvent(f.addRobotComponent,F.LED)),this.incrementNumberOf(F.LED);let p=this._numberOfComponentsOfType[F.LED],h=new A(this._eventBus,p,t,e,i,o,s,n,a,r,l,d,c,g);this._robot.push(h),this.renderer.initializeCanvas(this._robot,h)}removeLed(){this.logger.recordEvent(this.logger.createEvent(f.removeRobotComponent,F.LED));let t=this._numberOfComponentsOfType[F.LED];this.removeRobotComponentWithTypeAndId(F.LED,t)}addPir(t=0,e=0,i=!0,o=75,s=75,n=5,a=5,r="sim_canvas pir_canvas"){this.logger.recordEvent(this.logger.createEvent(f.addRobotComponent,F.PIR)),this.incrementNumberOf(F.PIR);let l=this._numberOfComponentsOfType[F.PIR],d=new N(this._eventBus,l,t,e,i,o,s,n,a,r);this._robot.push(d),this.renderer.initializeCanvas(this._robot,d)}removePir(){this.logger.recordEvent(this.logger.createEvent(f.removeRobotComponent,F.PIR));let t=this._numberOfComponentsOfType[F.PIR];this.removeRobotComponentWithTypeAndId(F.PIR,t)}addSonar(t=0,e=0,i=100,o=!0,s=100,n=58,a=5,r=5,l="sim_canvas sonar_canvas"){this.logger.recordEvent(this.logger.createEvent(f.addRobotComponent,F.SONAR)),this.incrementNumberOf(F.SONAR);let d=this._numberOfComponentsOfType[F.SONAR],c=new B(this._eventBus,d,t,e,i,o,s,n,a,r,l);this._robot.push(c),this.renderer.initializeCanvas(this._robot,c)}removeSonar(){this.logger.recordEvent(this.logger.createEvent(f.removeRobotComponent,F.SONAR));let t=this._numberOfComponentsOfType[F.SONAR];this.removeRobotComponentWithTypeAndId(F.SONAR,t)}addLcd(t=!0,e=5,i=5,o=""){this.logger.recordEvent(this.logger.createEvent(f.addRobotComponent,F.LCD)),this.incrementNumberOf(F.LCD);let s=this._numberOfComponentsOfType[F.LCD],n=new D(this._eventBus,s,t,e,i,o);this._robot.push(n)}removeLcd(){this.logger.recordEvent(this.logger.createEvent(f.removeRobotComponent,F.Lcd));let t=this._numberOfComponentsOfType[F.LCD];this.removeRobotComponentWithTypeAndId(F.LCD,t)}addSoundSensor(t=0,e=0,i=!0,o=100,s=42,n=5,a=5,r="sim_canvas sound_canvas"){this.logger.recordEvent(this.logger.createEvent(f.addRobotComponent,F.SOUND)),this.incrementNumberOf(F.SOUND);let l=this._numberOfComponentsOfType[F.SOUND],d=new G(this._eventBus,l,t,e,i,o,s,n,a,r);this._robot.push(d),this.renderer.initializeCanvas(this._robot,d)}removeSoundSensor(){this.logger.recordEvent(this.logger.createEvent(f.removeRobotComponent,F.SOUND));let t=this._numberOfComponentsOfType[F.SOUND];this.removeRobotComponentWithTypeAndId(F.SOUND,t)}addLightSensor(t=0,e=0,i=!0,o=100,s=45,n=5,a=5,r="sim_canvas light_canvas"){this.logger.recordEvent(this.logger.createEvent(f.addRobotComponent,F.LIGHT)),this.incrementNumberOf(F.LIGHT);let l=this._numberOfComponentsOfType[F.LIGHT],d=new W(this._eventBus,l,t,e,i,o,s,n,a,r);this._robot.push(d),this.renderer.initializeCanvas(this._robot,d)}removeLightSensor(){this.logger.recordEvent(this.logger.createEvent(f.removeRobotComponent,F.LIGHT));let t=this._numberOfComponentsOfType[F.LIGHT];this.removeRobotComponentWithTypeAndId(F.LIGHT,t)}incrementNumberOf(t){this._numberOfComponentsOfType[t]+=1}decrementNumberOf(t){this._numberOfComponentsOfType[t]-=1}}class X{constructor(){this.events={}}registerEvent(t){let e=new P(t);this.events[t]=e}dispatchEvent(t,e){this.events[t].callbacks.forEach(t=>{t(e)})}addEventListener(t,e){this.events[t].registerCallback(e)}}class Y{constructor(t){var e,i,o;o={},(i="socialRobotScenario")in(e=this)?Object.defineProperty(e,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[i]=o,this._eventBus=t,this._components=[{type:F.SERVO,maximumAmount:5},{type:F.LED,maximumAmount:3},{type:F.PIR,maximumAmount:2},{type:F.SONAR,maximumAmount:1},{type:F.LCD,maximumAmount:1},{type:F.SOUND,maximumAmount:2},{type:F.LIGHT,maximumAmount:2},{type:F.DECORATION,maximumAmount:10}]}setupEnvironment(t){this.socialRobotScenario=t,console.log("setupEnvironment"),this.initMenu(),this.translateRobotComponents()}initMenu(){$("#db_simulator_top_pane").append('<div id="robot_components_menu" class="scrolling-wrapper-flexbox"></div>'),$("#robot_components_menu").append('<div id="rc_servo" class="robot_components_item bg-c-4 card"></div>'),$("#rc_servo").append('<div id="rc_servo_tag" class="rc_tag"></div>'),$("#rc_servo").append('<div id="rc_servo_img"></div>'),$("#rc_servo").append('<div id="rc_servo_options"></div>'),$("#robot_components_menu").append('<div id="rc_led" class="robot_components_item bg-c-4 card"></div>'),$("#rc_led").append('<div id="rc_led_tag" class="rc_tag"></div>'),$("#rc_led").append('<div id="rc_led_img"></div>'),$("#rc_led").append('<div id="rc_led_options"></div>'),$("#robot_components_menu").append('<div id="rc_pir" class="robot_components_item bg-c-4 card"></div>'),$("#rc_pir").append('<div id="rc_pir_tag" class="rc_tag"></div>'),$("#rc_pir").append('<div id="rc_pir_img"></div>'),$("#rc_pir").append('<div id="rc_pir_value"></div>'),$("#rc_pir").append('<div id="rc_pir_options"></div>'),$("#robot_components_menu").append('<div id="rc_sonar" class="robot_components_item bg-c-4 card"></div>'),$("#rc_sonar").append('<div id="rc_sonar_tag" class="rc_tag"></div>'),$("#rc_sonar").append('<div id="rc_sonar_img"></div>'),$("#rc_sonar").append('<div id="rc_sonar_value"></div>'),$("#rc_sonar").append('<div id="rc_sonar_options"></div>'),$("#robot_components_menu").append('<div id="rc_lcd" class="robot_components_item bg-c-4 card"></div>'),$("#rc_lcd").append('<div id="rc_lcd_tag" class="rc_tag"></div>'),$("#rc_lcd").append('<div id="rc_lcd_img"></div>'),$("#rc_lcd").append('<div id="rc_lcd_options"></div>'),$("#robot_components_menu").append('<div id="rc_sound" class="robot_components_item bg-c-4 card"></div>'),$("#rc_sound").append('<div id="rc_sound_tag" class="rc_tag"></div>'),$("#rc_sound").append('<div id="rc_sound_img"></div>'),$("#rc_sound").append('<div id="rc_sound_options"></div>'),$("#robot_components_menu").append('<div id="rc_light" class="robot_components_item bg-c-4 card"></div>'),$("#rc_light").append('<div id="rc_light_tag" class="rc_tag"></div>'),$("#rc_light").append('<div id="rc_light_img"></div>'),$("#rc_light").append('<div id="rc_light_options"></div>'),$("#robot_components_menu").append('<div id="rc_decoration" class="robot_components_item bg-c-4 card"></div>'),$("#rc_decoration").append('<div id="rc_decoration_tag" class="rc_tag"></div>'),$("#rc_decoration").append('<div id="rc_decoration_img"></div>'),$("#rc_decoration").append('<div id="rc_decoration_options"></div>'),this.initButtons()}initButtons(){let t=this.generateButtonTemplate(F.SERVO);$("#rc_servo_options").append(t);let e=this.generateButtonTemplate(F.LED);$("#rc_led_options").append(e);let i=this.generateButtonTemplate(F.PIR);$("#rc_pir_options").append(i);let o=this.generateButtonTemplate(F.SONAR);$("#rc_sonar_options").append(o);let s=this.generateButtonTemplate(F.LCD);$("#rc_lcd_options").append(s);let n=this.generateButtonTemplate(F.SOUND);$("#rc_sound_options").append(n);let a=this.generateButtonTemplate(F.LIGHT);$("#rc_light_options").append(a);let r=this;$(".btn-number").click((function(t){t.preventDefault();let e=$(this).attr("data-field"),i=$(this).attr("data-type");var o=$("input[name='"+e+"']"),s=parseInt(o.val());isNaN(s)?o.val(0):"minus"==i?(s>o.attr("min")&&(o.val(s-1).change(),r.removeRobotComponent(t.target.id)),parseInt(o.val())==o.attr("min")&&$(this).attr("disabled",!0)):"plus"==i&&(s<o.attr("max")&&(o.val(s+1).change(),r.addRobotComponent(t.target.id)),parseInt(o.val())==o.attr("max")&&$(this).attr("disabled",!0))})),$(".input-number").focusin((function(){$(this).data("oldValue",$(this).val())})),$(".input-number").change((function(){let t=parseInt($(this).attr("min")),e=parseInt($(this).attr("max")),i=parseInt($(this).val()),o=$(this).attr("name");i>=t?$(".component_item_input[data-type='minus'][data-field='"+o+"']").removeAttr("disabled"):$(this).val($(this).data("oldValue")),i<=e?$(".component_item_input[data-type='plus'][data-field='"+o+"']").removeAttr("disabled"):$(this).val($(this).data("oldValue"))})),$(".input-number").keydown((function(t){-1!==$.inArray(t.keyCode,[46,8,9,27,13,190])||65==t.keyCode&&!0===t.ctrlKey||t.keyCode>=35&&t.keyCode<=39||(t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)&&t.preventDefault()}))}resetButtons(){for(const[t,e]of Object.entries(F)){$("input[name='"+e+"']").val(0).change()}}changeValue(t,e){var i=$("input[name='"+t+"']"),o=parseInt(i.val());i.val(o+e).change()}translateRobotComponents(){for(const[t,e]of Object.entries(F))document.getElementById("rc_"+e+"_tag").textContent=MSG.simulator[e]}generateButtonTemplate(t){let e="";return this._components.forEach((function(i){i.type==t&&(e='<fieldset><button type="button" id="rc_'+t+'_minus_button" class="component_item_input btn-number" disabled="disabled" data-type="minus" data-field="'+t+'"><span class="glyphicon glyphicon-minus" id="rc_'+t+'_minus_button"></span></button><input type="text" name="'+t+'" class="component_item_input input-number" size="2" value="0" min="0" max="'+i.maximumAmount+'"><button type="button" id="rc_'+t+'_plus_button" class="component_item_input btn-number" data-type="plus" data-field="'+t+'"><span class="glyphicon glyphicon-plus" id="rc_'+t+'_plus_button"></span></button></fieldset>')})),e}addRobotComponent(t){switch(t){case"rc_servo_plus_button":this.socialRobotScenario.addRobotComponent(F.SERVO);break;case"rc_led_plus_button":this.socialRobotScenario.addRobotComponent(F.LED);break;case"rc_pir_plus_button":this.socialRobotScenario.addRobotComponent(F.PIR);break;case"rc_sonar_plus_button":this.socialRobotScenario.addRobotComponent(F.SONAR);break;case"rc_decoration_plus_button":this.socialRobotScenario.addRobotComponent(F.DECORATION);break;case"rc_lcd_plus_button":this.socialRobotScenario.addRobotComponent(F.LCD);break;case"rc_sound_plus_button":this.socialRobotScenario.addRobotComponent(F.SOUND);break;case"rc_light_plus_button":this.socialRobotScenario.addRobotComponent(F.LIGHT)}this._eventBus.dispatchEvent(M.SAVE)}removeRobotComponent(t){switch(t){case"rc_servo_minus_button":this.socialRobotScenario.removeRobotComponent(F.SERVO);break;case"rc_led_minus_button":this.socialRobotScenario.removeRobotComponent(F.LED);break;case"rc_pir_minus_button":this.socialRobotScenario.removeRobotComponent(F.PIR);break;case"rc_sonar_minus_button":this.socialRobotScenario.removeRobotComponent(F.SONAR);break;case"rc_decoration_minus_button":this.socialRobotScenario.removeRobotComponent(F.DECORATION);break;case"rc_lcd_minus_button":this.socialRobotScenario.removeRobotComponent(F.LCD);break;case"rc_sound_minus_button":this.socialRobotScenario.removeRobotComponent(F.SOUND);break;case"rc_light_minus_button":this.socialRobotScenario.removeRobotComponent(F.LIGHT)}this._eventBus.dispatchEvent(M.SAVE)}}class j{constructor(t){var e,i,o;o=null,(i="logger")in(e=this)?Object.defineProperty(e,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[i]=o,this.logger=t,console.log("Constructor")}initSimulationState(t){console.log("initSimulationState")}initSimulationDisplay(t){$("#"+t).empty()}updateScenario(t){}updateScenarioState(t){}updateScenarioDisplay(t){}}class z{constructor(t,e){var i,o,s;s=null,(o="socialRobotScenario")in(i=this)?Object.defineProperty(i,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[o]=s,this.socialRobotScenario=t,this._eventBus=e,this.setupInteract(),window.dragMoveListener=this.dragMoveListener}setupInteract(){let t=this;interact(".draggable").draggable({inertia:!0,modifiers:[interact.modifiers.restrictRect({restriction:"parent",endOnly:!0})],autoScroll:!0,onmove:this.dragMoveListener,onend:function(e){var i=e.target.querySelector("p");i&&(i.textContent="moved a distance of "+Math.sqrt(Math.pow(e.pageX-e.x0,2)+Math.pow(e.pageY-e.y0,2)|0).toFixed(2)+"px"),t._eventBus.dispatchEvent(M.SAVE),t.socialRobotScenario.logger.recordEvent(t.socialRobotScenario.logger.createEvent(f.moveRobotComponent,e.target.id))}})}dragMoveListener(t){var e=t.target,i=(parseFloat(e.getAttribute("data-x"))||0)+t.dx,o=(parseFloat(e.getAttribute("data-y"))||0)+t.dy;e.style.webkitTransform=e.style.transform="translate("+i+"px, "+o+"px)",e.setAttribute("data-x",i),e.setAttribute("data-y",o)}fireCustomEvent(t,e,i){var o;i=i||{},document.createEvent?(o=document.createEvent("HTMLEvents")).initEvent(t,!0,!0):(o=document.createEventObject()).eventType=t,o.eventName=t,o=$.extend(o,i),document.createEvent?e.dispatchEvent(o):e.fireEvent("on"+o.eventType,o)}}class q{constructor(){}download(t,e){let i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),i.setAttribute("download",t),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}uploadXml(){return new Promise((t,e)=>{let i="";if(window.File&&window.FileReader&&window.FileList&&window.Blob){console.log("yay, files supported"),$("div").remove("#dropzoneModal"),$("#blocklyDiv").append('<div id="dropzoneModal" class="modal fade" role="dialog"></div>'),$("#dropzoneModal").append('<div id="modalDialog" class="modal-dialog"></div>'),$("#modalDialog").append('<div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Upload</h4></div>'),$("#modalDialog").append('<div class="modal-body">'+MSG.dropzone.dictSelectFile+'<input type="file" id="fileInput"><div id="filedrag">'+MSG.dropzone.dictDefaultMessage+'</div><pre id="fileDisplayArea"><pre></div>'),$("#modalDialog").append('<div class="modal-footer"><button id="submit_upload_modal_dialog_button" type="button" class="btn btn-default" data-dismiss="modal">Ok</button></div>'),$("#dropzoneModal").modal("show");var o=function(t){if(t.type.match(/text.*/)){var e=new FileReader;e.onload=function(o){n.innerText=t.name,i=e.result},e.readAsText(t)}else n.innerText="File not supported!"},s=document.getElementById("fileInput"),n=document.getElementById("fileDisplayArea");s.addEventListener("change",(function(t){var e=s.files[0];o(e)}));var a=function(t){t.stopPropagation(),t.preventDefault(),t.target.className="dragover"==t.type?"hover":""},r=document.getElementById("filedrag");r.addEventListener("dragover",a,!1),r.addEventListener("dragleave",a,!1),r.addEventListener("drop",(function(t){a(t);var e=(t.target.files||t.dataTransfer.files)[0];o(e)}),!1),r.style.display="block",$("#dropzoneModal").on("click",t=>{let i=$(t.target);console.log(i),(i.is("button.close")||i.is("div#dropzoneModal.modal.fade"))&&(console.log("closed"),e("Dialog closed without result"))}),$("#submit_upload_modal_dialog_button").click((function(){t(i)}))}else e("File IO libraries not supported")})}}class Z{constructor(t,e){var i,o,s;s=null,(o="ioController")in(i=this)?Object.defineProperty(i,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[o]=s,this.scenario=t,this._eventBus=e,this.ioController=new q}saveScenario(t){console.log("save scenario"),this.ioController.download("scenario.xml",t),this.scenario.logger.recordEvent(this.scenario.logger.createEvent(f.downloadScenarioClicked,""))}async loadScenario(){try{let t=await this.ioController.uploadXml();this.scenario.xmlToRobot(t),this._eventBus.dispatchEvent(M.SAVE)}catch(t){console.error(t)}}textToDom(t){var e=(new DOMParser).parseFromString(t,"text/xml");return e&&e.firstChild&&"xml"==e.firstChild.nodeName.toLowerCase()&&e.firstChild===e.lastChild||goog.asserts.fail("Blockly.Xml.textToDom did not obtain a valid XML tree."),e.firstChild}}function J(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class K extends j{constructor(t){super(t),J(this,"simulationComponentsMenu",null),J(this,"simulationRobotComponents",null),this._eventBus=new X,this._eventBus.registerEvent(M.SAVE),this._eventBus.addEventListener(M.SAVE,()=>{this.saveRobot()}),this.simulationRobotComponents=new z(this,this._eventBus),this.simulationComponentsMenu=new Y(this._eventBus)}initSimulationState(t){super.initSimulationState(t),this.renderer=new I,this.scenarioUtils=new Z(this,this._eventBus),this.robotComponentsFactory=new U(this.scenarioUtils,this.logger,this._eventBus),this._eventBus.registerEvent(M.CLEARCANVAS),this._eventBus.addEventListener(M.CLEARCANVAS,t=>{this.renderer.clearCanvas(t)}),this._eventBus.registerEvent(M.INITIALIZECANVAS),this._eventBus.addEventListener(M.INITIALIZECANVAS,t=>{this.renderer.initializeCanvas(this.robotComponentsFactory.getRobot(),t)})}initSimulationDisplay(t){super.initSimulationDisplay();var e=$("#"+t);e.empty();let i=$("<div>").attr("id","db_simulator_top_pane"),o=$("<div>").attr("id","db_simulator_bottom_pane");e.append(i).append(o),this.simulationComponentsMenu.setupEnvironment(this),this.initSimulation(t);var s=this;$("#sim_stop").click((function(){setTimeout(()=>{s.resetSocialRobot(),s.renderer.render(s.robotComponentsFactory.getRobot())},500)})),this.setBackground(),this.initScenarioOptions(),this.setSensorOptions(),this.loadRobot()}initScenarioOptions(){var t=this,e=$("<div>").attr("id","scenario_options");$("#sim_container").append(e),e.append("<div id='load_scenario' class='glyphicon glyphicon-cloud-upload' alt='Load'></div>"),e.append("<div id='save_scenario' class='glyphicon glyphicon-cloud-download' alt='Save'></div>"),e.append("<div id='switch_background' class='glyphicon glyphicon-refresh'></div>"),$("#load_scenario").click((function(){t.scenarioUtils.loadScenario()})),$("#save_scenario").click((function(){var e=t.loadToXml();t.scenarioUtils.saveScenario(e)})),document.getElementById("switch_background").addEventListener("click",()=>{this.switchBackground()})}initSimulation(t){console.log("init simulation display");let e=$("#"+t);$("#db_simulator_top_pane").css("height","25%"),$("#db_simulator_bottom_pane").css("height","75%");var i=$("<div>").attr("id","sim_container").attr("style","margin: auto"),o=this;new ResizeSensor(i,(function(){o.containerWidth=i.width(),o.containerHeight=i.height()})),e.append(i)}updateScenario(t){super.updateScenario(t),this.updateScenarioState(t),this.updateScenarioDisplay(t)}updateScenarioState(t){super.updateScenarioState(t),this.robotComponentsFactory.updateScenarioState(t)}updateScenarioDisplay(t){super.updateScenarioDisplay(t),this.renderer.render(this.robotComponentsFactory.getRobot())}setSensorOptions(){if(!document.getElementById("sensor_options")){var t=$("<div>").attr("id","sensor_options");$("#sim_container").append(t)}}setBackground(){console.log("set background"),$("#sim_container").append("<div id='sim_background' class='sim_element row'></div>"),$("#sim_background").append("<div id='sim_background_img' class='background1'></div>"),this._background=1;var t=$("#sensor_options").width(),e=($("#sim_background").width()-t-$("#sim_background_img").width())/2;$("#sim_background_img").css("top","0px"),$("#sim_background_img").css("margin-left",e+"px")}switchBackground(){this._background<3?this._background+=1:this._background=1,document.getElementById("sim_background_img").className="",document.getElementById("sim_background_img").className="background"+this._background,this._eventBus.dispatchEvent(M.SAVE)}backgroundToXml(){let t="";return t=t.concat("<Item "),t=t.concat(" Type='","background","'"),t=t.concat(" Class='",document.getElementById("sim_background_img").className,"'"),t=t.concat(" Id='",this._background,"'"),t=t.concat("></Item>"),t}resetSocialRobot(t){this.robotComponentsFactory.resetSocialRobot()}addRobotComponent(t){this.robotComponentsFactory.addRobotComponent(t)}removeRobotComponent(t){this.robotComponentsFactory.removeRobotComponent(t),this.renderer.render(this.robotComponentsFactory.getRobot())}setLedColor(t,e){let i=this.robotComponentsFactory.getRobotComponentWithTypeAndId(F.LED,t);void 0!==i&&i.setOnColor(e)}loadToXml(){if(window.localStorage){if(window.localStorage.getItem("socialRobotScenario"))return this.robotToXml()}}robotToXml(){let t='<xml xmlns="http://www.w3.org/1999/xhtml">';t=t.concat(this.backgroundToXml());let e=this.robotComponentsFactory.getRobot();for(var i=0;i<e.length;i++)t=t.concat(e[i].toXml());return t=t.concat("</xml>"),t}xmlToRobot(t){for(var e=this.scenarioUtils.textToDom(t),i=e.childNodes.length,o=0;o<i;o++){var s=e.childNodes[o];let t=s.getAttribute("Type");"background"!==t?(this.robotComponentsFactory.addRobotComponentFromXml(s),this.simulationComponentsMenu.changeValue(t,1)):(this._background=parseInt(s.getAttribute("Id")),document.getElementById("sim_background_img").className=s.getAttribute("Class"))}}saveRobot(t=!1,e=""){let i=t?"permanentDwenguinoSocialRobot"+e:"dwenguinoSocialRobot"+e;console.log("%c saving robot","color: green");let o=window.localStorage;if(o){let t=this.robotToXml();o.setItem(i,t)}}loadRobot(t=!1,e=""){let i=t?"permanentDwenguinoSocialRobot"+e:"dwenguinoSocialRobot"+e;console.log("%c loading robot","color: green");let o=window.localStorage;if(o){let t=o.getItem(i);t&&this.xmlToRobot(t)}}clearRobot(t=""){let e="dwenguinoSocialRobot"+t;console.log("%c clearing robot","color: green");let i=window.localStorage;i&&i.removeItem(e)}}function Q(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class tt extends j{constructor(t){super(t),Q(this,"inputsState",null),Q(this,"audiocontext",null),Q(this,"osc",null),Q(this,"audioStarted",!1),Q(this,"muted",!0),Q(this,"prevFreq",0),Q(this,"boardDisplayWidth","80%"),Q(this,"componentsTopOffset","0%"),Q(this,"rightSimComponentsPosition","auto"),Q(this,"sonarDistance",0),Q(this,"sonarInputChanged",!1),Q(this,"sonarFieldBeingEdited",!1),this.inputsState={buttons:[1,1,1,1,1],reset:1}}setBoardDisplayWidthWidth(t){this.boardDisplayWidth=t}setComponentsTopOffset(t){this.componentsTopOffset=t}setComponentsRightPosition(t){this.rightSimComponentsPosition=t}initAudioContext(){try{this.audiocontext=new AudioContext}catch(t){console.log("Web Audio API is not supported in this browser")}}initSimulationState(t){}initSimulationDisplay(t){$("#"+t).append('<div id="db_simulator_pane"></div>'),$("#db_simulator_pane").append('<div id="debug"></div>'),$("#db_simulator_pane").append('<div id="sim_components"></div>');let e=$("<div>").css({position:"absolute",display:"inline-block",width:this.boardDisplayWidth,"max-width":"30vw",right:0}),i=$("<div>").attr("id","dummy").css({"margin-top":"70%"}),o=$("<div>").attr("id","sim_board").css({position:"absolute",right:0,bottom:0,left:0});e.append(i),e.append(o),$("#db_simulator_pane").append(e),$("#db_simulator_pane").append('<span id="db_simulator_mute"></span>'),$("#db_simulator_mute").attr("class","glyphicon glyphicon-volume-off");let s=$('<div id="sim_sonar" class="sim_sonar"></div>'),n=$('<div id="sim_sonar_distance" class="sim_sonar_distance"></div>'),a=$('<div id="sim_sonar_input"></div>').text("Sonar "+MSG.simulator.distance+":"),r=$('<button id="set_sonar_value"></button>').text("OK");$("#sim_components").append(s),$("#sim_components").append(n),$("#sim_components").append(a),$("#sim_components").append(r),$("#sim_components").css({"margin-top":this.componentsTopOffset,right:this.rightSimComponentsPosition}),$("#sim_sonar_input").append('<input type="text" id="sonar_input" name="sim_sonar_input" onkeypress="return event.charCode >= 48 && event.charCode <= 57">&nbsp;cm'),$("#sonar_input").on("keyup",t=>{if("Enter"===t.key||13===t.keyCode){this.sonarInputChanged=!0;let t=$("#sonar_input").val();console.log(parseInt(t.trim())),this.sonarDistance=parseInt(t.trim())}}),$("#sonar_input").change(t=>{this.sonarInputChanged=!0;let e=$("#sonar_input").val();console.log(parseInt(e.trim())),this.sonarDistance=parseInt(e.trim())}),$("#set_sonar_value").click(t=>{let e=$("#sonar_input").val();console.log(parseInt(e.trim())),this.sonarDistance=parseInt(e.trim())}),$("#sonar_input").focus(()=>{console.log("focus gained"),this.sonarFieldBeingEdited=!0}),$("#sonar_input").focusout(()=>{console.log("focus lost"),this.sonarFieldBeingEdited=!1}),$("#sim_board").append('<div class="sim_light sim_light_off" id ="sim_light_13"></div>'),$("#sim_board").append('<div id="sim_lcds"></div>'),$("#sim_board").append('<div id="sim_lights"></div>'),$("#sim_board").append('<div id="sim_buttons"></div>'),$("#sim_board").append('<div id="sim_button_reset" class="sim_button"></div>'),$("#sim_lcds").append('<div class="sim_lcd" id="sim_lcd_row0"></div>'),$("#sim_lcds").append('<div class="sim_lcd" id="sim_lcd_row1"></div>'),$("#sim_lights").append('<div class="sim_light sim_light_off" id ="sim_light_7"></div>'),$("#sim_lights").append('<div class="sim_light sim_light_off" id ="sim_light_6"></div>'),$("#sim_lights").append('<div class="sim_light sim_light_off" id ="sim_light_5"></div>'),$("#sim_lights").append('<div class="sim_light sim_light_off" id ="sim_light_4"></div>'),$("#sim_lights").append('<div class="sim_light sim_light_off" id ="sim_light_3"></div>'),$("#sim_lights").append('<div class="sim_light sim_light_off" id ="sim_light_2"></div>'),$("#sim_lights").append('<div class="sim_light sim_light_off" id ="sim_light_1"></div>'),$("#sim_lights").append('<div class="sim_light sim_light_off" id ="sim_light_0"></div>'),$("#sim_buttons").append('<div id="sim_buttons_top"></div>'),$("#sim_buttons").append('<div id="sim_buttons_middle"></div>'),$("#sim_buttons").append('<div id="sim_buttons_bottom"></div>'),$("#sim_buttons_top").append('<div id="sim_button_N" class="sim_button"></div>'),$("#sim_buttons_middle").append('<div id="sim_button_W" class="sim_button"></div>'),$("#sim_buttons_middle").append('<div id="sim_button_C" class="sim_button"></div>'),$("#sim_buttons_middle").append('<div id="sim_button_E" class="sim_button"></div>'),$("#sim_buttons_bottom").append('<div id="sim_button_S" class="sim_button"></div>'),this.hideSonar();let l=this;$("#sim_button_N, #sim_button_E, #sim_button_C, #sim_button_S, #sim_button_W").on("mousedown",(function(){l.inputsState.buttons[g.mapButtonIdToIndex(this.id)]=0})),$("#sim_button_N, #sim_button_E, #sim_button_C, #sim_button_S, #sim_button_W").on("mouseup",(function(){l.inputsState.buttons[g.mapButtonIdToIndex(this.id)]=1})),$("#db_simulator_mute").on("click",()=>{null==this.audiocontext&&this.initAudioContext(),this.muted?(this.muted=!1,$("#db_simulator_mute").removeClass(),$("#db_simulator_mute").attr("class","glyphicon  glyphicon-volume-up")):(this.muted=!0,$("#db_simulator_mute").removeClass(),$("#db_simulator_mute").attr("class","glyphicon  glyphicon-volume-off"))})}showSonar(){$("#sim_sonar").show(),$("#sim_sonar_distance").show(),$("#sim_sonar_input").show()}hideSonar(){$("#sim_sonar").hide(),$("#sim_sonar_distance").hide(),$("#sim_sonar_input").hide()}updateScenarioState(t){for(let e=0;e<this.inputsState.buttons.length;++e)t.setButtonState(e,this.inputsState.buttons[e]);this.sonarInputChanged&&(t.setSonarDistance(11,12,this.sonarDistance),this.sonarInputChanged=!1),this.sonarDistance=t.getSonarDistance(11,12)}updateScenario(t){this.updateScenarioState(t),this.updateScenarioDisplay(t)}updateScenarioDisplay(t){var e=t.getSonarDistance(11,12);if(e<=-1)this.hideSonar();else{this.showSonar();var i=document.getElementById("sonar_input");void 0!==i&&null!=i?this.sonarFieldBeingEdited||(i.value=e):console.log("Sonar input element is undefined")}this.audiocontext&&(this.prevFreq!=t.getTonePlaying()&&0!=this.prevFreq&&0!=t.getTonePlaying&&(this.prevFreq=t.getTonePlaying(),this.osc.stop(this.audiocontext.currentTime),this.osc.disconnect(this.audiocontext.destination),this.osc=null,this.audioStarted=!1),0===t.getTonePlaying()||this.muted?this.audioStarted&&(console.log("stop"),this.audioStarted=!1,this.osc.stop(this.audiocontext.currentTime),this.osc.disconnect(this.audiocontext.destination),this.osc=null):0===t.getTonePlaying()||this.muted||this.audioStarted||(this.osc=this.audiocontext.createOscillator(),this.osc.frequency.value=t.getTonePlaying(),this.osc.start(this.audiocontext.currentTime),this.osc.connect(this.audiocontext.destination),console.log("start"),this.audioStarted=!0));for(let e=0;e<5;e++)0===t.getButtonState(e)?document.getElementById(g.mapIndexToButtonId(e)).className="sim_button sim_button_pushed":document.getElementById(g.mapIndexToButtonId(e)).className="sim_button";1==t.getBackLightStatus()?$("#sim_lcds").addClass("on"):$("#sim_lcds").removeClass("on");for(var o=0;o<2;++o)$("#sim_lcd_row"+o).text(t.getLcdContent(o)),null!==document.getElementById("sim_lcd_row"+o)&&(document.getElementById("sim_lcd_row"+o).innerHTML=document.getElementById("sim_lcd_row"+o).innerHTML.replace(/ /g,"&nbsp;"));var s=document.getElementById("sim_lcds");if(null!==s){s.style.display="none",s.offsetHeight,s.style.display="block";let t=$(".sim_lcd"),e=$("#sim_board").width()/16*1.25;t.css({"font-size":e})}for(var n=0;n<8;n++){let e="";e=0===t.getLedState(n)?"sim_light sim_light_off":"sim_light sim_light_on",document.getElementById("sim_light_"+n).className=e}0===t.getLedState(8)?document.getElementById("sim_light_13").className="sim_light sim_light_off":document.getElementById("sim_light_13").className="sim_light sim_light_on"}}class et extends j{constructor(t){var e,i,o;super(t),o=null,(i="dwenguinoBoardSimulation")in(e=this)?Object.defineProperty(e,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[i]=o,this.dwenguinoBoardSimulation=new tt(t),this.initSimulationState(null)}initSimulationState(t){super.initSimulationState(t),this.robot={image:{width:65,height:83},start:{x:100,y:100,angle:0},position:{x:100,y:100,angle:0},collision:[{type:"circle",radius:25}]},this.containerWidth=0,this.containerHeight=0}initSimulationDisplay(t){super.initSimulationDisplay(t);let e=$("#"+t),i=$("<div>").attr("id","db_simulator_top_pane"),o=$("<div>").attr("id","db_simulator_bottom_pane"),s=$("<div>").attr("id","db_simulator_tab_selection"),n=$("<ul>").attr("class","tabs");s.append(n),o.append(s);let a=$("<div>").attr("id","db_robot_pane"),r=$("<div>").attr("id","sim_container"),l=$("<div>").attr("id","sim_animation");r.append(l),a.append(r),o.append(a),e.append(i).append(o),this.dwenguinoBoardSimulation.initSimulationState(null),this.dwenguinoBoardSimulation.initSimulationDisplay("db_simulator_top_pane");var d=$("#db_robot_pane"),c=this;new ResizeSensor(r,(function(){console.log("myelement has been resized"),c.containerWidth=r.width(),c.containerHeight=r.height()}));var g=$("<div>").attr("id","sim_animation");r.append(g),d.append(r),$("#db_simulator_bottom_pane").css("display","flex").css("flex-direction","column"),$("#db_simulator_tab_selection").css("height","30px"),$("#db_robot_pane").css("flex: 1"),$("#sim_container").css("position","relative").css("width","80%").css("height","80%").css("box-sizing","border-box"),$("#sim_animation").css("width",this.robot.image.width+"px").css("height",this.robot.image.height+"px").css("maring-left","-25px").css("maring-right","-20px").css("position","absolute").css("background-image","url('DwenguinoIDE/img/board/robot.png')").css("background-size","100%").css("top",this.robot.position.y+"px").css("left",this.robot.position.x+"px")}updateScenario(t){super.updateScenario(t),this.updateScenarioState(t),this.updateScenarioDisplay(t),this.dwenguinoBoardSimulation.updateScenario(t)}updateScenarioState(t){super.updateScenarioState(t),this.containerWidth=$("#sim_container").width(),this.containerHeight=$("#sim_container").height();var e=t.getMotorSpeed(1),i=t.getMotorSpeed(2),o=this.robot.position.x,s=this.robot.position.y,n=this.robot.position.angle,a=(e+i)/100;e!==i&&(n+=(i-e)/30),o+=a*Math.cos(Math.PI/180*n),s+=a*Math.sin(Math.PI/180*n),o>this.containerWidth?o=0:o<0&&(o=this.containerWidth),s>this.containerHeight?s=0:s<0&&(s=this.containerHeight),this.robot.position={x:o,y:s,angle:n}}updateScenarioDisplay(t){super.updateScenarioDisplay(t);this.robot;var e=$("#sim_animation");this.containerWidth=$("#sim_container").width(),this.containerHeight=$("#sim_container").height(),e.css("top",this.robot.position.y+"px").css("left",this.robot.position.x+"px").css("transform","rotate("+this.robot.position.angle+"deg)")}}class it extends et{constructor(t){super(t),this.initSimulationState(null)}initSimulationState(t){super.initSimulationState(t)}initSimulationDisplay(t){super.initSimulationDisplay(t),$("#sim_container").css("border","solid").css("border-width","3px").css("border-color","black").css("max-width","80%").css("max-height","80%"),this.containerWidth=$("#sim_container").width(),this.containerHeight=$("#sim_container").height()}updateScenario(t){super.updateScenario(t)}updateScenarioState(t){super.updateScenarioState(t);var e=t.getMotorSpeed(1),i=t.getMotorSpeed(2),o=this.robot.position.x,s=this.robot.position.y,n=this.robot.position.angle,a=(e+i)/100;e!==i&&(n+=(i-e)/30%360),o+=a*Math.cos(Math.PI/180*n),s+=a*Math.sin(Math.PI/180*n),o>this.containerWidth-this.robot.image.width?o=this.containerWidth-this.robot.image.width:o<0&&(o=0),s>this.containerHeight-this.robot.image.height?s=this.containerHeight-this.robot.image.height:s<0&&(s=0);var r=s;n=(n%360+360)%360;var l=o+this.robot.image.width/2*Math.cos(Math.PI/180*n),d=r+this.robot.image.width/2*Math.sin(Math.PI/180*n),c=[[this.containerWidth,this.containerHeight],[0,this.containerHeight],[0,0],[this.containerWidth,0]],g=[0,0],p=[0,0];if(90==n)g=p=[l,this.containerHeight];else if(270==n)g=p=[l,0];else if(180==n)g=p=[0,d];else if(0==n)g=p=[this.containerWidth,d];else{Math.tan(n);var h=c[Math.floor(n/90)%4];g=[h[0],Math.tan(n*Math.PI/180)*(h[0]-l)+d],p=[(h[1]-d)/Math.tan(n*Math.PI/180)+l,h[1]]}var u=Math.min(this.calcDistanceBetweenPoints(g,[l,d]),this.calcDistanceBetweenPoints(p,[l,d]));return t.setSonarDistance(11,12,Math.abs(u-25)),console.log(t.getSonarDistance(11,12)),this.robot.position={x:o,y:s,angle:n},t}calcDistanceBetweenPoints(t,e){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}updateScenarioDisplay(t){super.updateScenarioDisplay(t)}}function ot(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class st{constructor(t,e){ot(this,"x",0),ot(this,"y",0),this.x=t,this.y=e}getEuclideanDistanceTo(t){return Math.sqrt((this.x-t.x)**2+(this.y-t.y)**2)}draw(t,e=5){t.beginPath(),t.arc(this.x,this.y,e,0,360),t.closePath(),t.stroke(),t.fill()}getX(){return this.x}setX(t){this.x=t}getY(){return this.y}setY(t){this.y=t}}function nt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class at{constructor(t,e){nt(this,"point1",null),nt(this,"point2",null),this.point1=t,this.point2=e}getSlope(){return(this.point2.getY()-this.point1.getY())/(this.point2.getX()-this.point1.getX())}getOffset(){return this.point1.getY()-this.getSlope()*this.point1.getX()}getPointsPerpendicular(t,e){let i=1/this.getSlope()*-1;return this.getPointAtDistanceFromPointWithSlope(t,e,i)}getPointAtDistanceFromPointWithSlope(t,e,i){let o=Math.atan(i),s=e*Math.cos(o),n=e*Math.sin(o);return[new st(t.getX()+s,t.getY()+n),new st(t.getX()-s,t.getY()-n)]}getPointsOnLineAtSetDistanceFromOtherPointOnLine(t,e){return this.getPointAtDistanceFromPointWithSlope(t,e,this.getSlope())}}class rt{drawRobotArm(t,e,i,o,s,n){this.drawConvexHull(t,e,i,s),this.drawArmHoles(t,e,i,o,n)}drawArmHoles(t,e,i,o,s){let n=e.getEuclideanDistanceTo(i)/o,a=new at(e,i).getSlope(),r=Math.atan(a);e.getX()>i.getX()&&(r+=Math.PI);let l=e;for(let e=0;e<o;++e){t.beginPath(),t.arc(l.getX(),l.getY(),s,0,360),t.closePath(),t.stroke();let e=n*Math.cos(r),i=n*Math.sin(r);l=new st(l.getX()+e,l.getY()+i)}}drawConvexHull(t,e,i,o){let s=new at(e,i),n=s.getPointsPerpendicular(e,o/2),a=s.getPointsPerpendicular(i,o/2),r=s.getPointsOnLineAtSetDistanceFromOtherPointOnLine(e,o/2),l=s.getPointsOnLineAtSetDistanceFromOtherPointOnLine(i,o/2),d=[];d.push(n[0]),d.push(a[0]);let c=null;c=this.checkIfInnerPointOfLineBetweenPoints(e,i,l[0])?l[1]:l[0];let g=new st(c.getX()+(a[0].getX()-i.getX()),c.getY()+(a[0].getY()-i.getY()));d.push(g),d.push(c),g=new st(c.getX()+(a[1].getX()-i.getX()),c.getY()+(a[1].getY()-i.getY())),d.push(g),d.push(a[1]),d.push(n[1]),c=this.checkIfInnerPointOfLineBetweenPoints(e,i,r[0])?r[1]:r[0],g=new st(c.getX()+(n[1].getX()-e.getX()),c.getY()+(n[1].getY()-e.getY())),d.push(g),d.push(c),g=new st(c.getX()+(n[0].getX()-e.getX()),c.getY()+(n[0].getY()-e.getY())),d.push(g),t.beginPath(),t.moveTo(d[0].getX(),d[0].getY()),t.lineTo(d[1].getX(),d[1].getY()),t.quadraticCurveTo(d[2].getX(),d[2].getY(),d[3].getX(),d[3].getY()),t.quadraticCurveTo(d[4].getX(),d[4].getY(),d[5].getX(),d[5].getY()),t.lineTo(d[6].getX(),d[6].getY()),t.quadraticCurveTo(d[7].getX(),d[7].getY(),d[8].getX(),d[8].getY()),t.quadraticCurveTo(d[9].getX(),d[9].getY(),d[0].getX(),d[0].getY()),t.closePath(),t.stroke()}drawBasePlate(t,e,i){this.drawConvexHull(t,e,i,80),t.fillStyle="#8bab42",t.font="40px Courier New",t.textAlign="center",t.textBaseline="middle",t.fillText("dwengo",e.getX()+(i.getX()-e.getX())/2,e.getY())}checkIfInnerPointOfLineBetweenPoints(t,e,i){return i.getEuclideanDistanceTo(t)+i.getEuclideanDistanceTo(e)<=t.getEuclideanDistanceTo(e)+.1}}function lt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class dt extends j{constructor(t){super(t),lt(this,"startScale",400),lt(this,"currentScale",400),lt(this,"currentColor","#4a9234"),lt(this,"representationScale",{motorAxes:[[30,30],[280,30]],motorAngles:[0,0],segmentLengths:[30,20,150,170,120,150,160,150,50],segmentCount:[3,2,15,17,12,15,14,16,5],segmentRanges:[[2,3],[2,3],[10,20],[10,20],[5,15],[5,15],[5,15],[5,15],[0,2]],segmentIncrement:10,armWidth:10,holeDiameter:2.5,hinges:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]]}),lt(this,"drawingScale",{motorAxes:[[0,0],[0,0]],segmentLengths:[0,0,0,0,0,0,0,0,0],hinges:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],armWidth:0,holeDiameter:10}),lt(this,"canvases",[]),lt(this,"contexts",[]),lt(this,"canvasNames",{SPYROGRAPH_CANVAS:0,SPYROGRAPH_DRAWING_CANVAS:1}),lt(this,"container",null),lt(this,"imageData",null),lt(this,"graphicsLib",null),lt(this,"dwenguinoBoardSimulation",null),lt(this,"scaleFactorForDisplay",.8),this.initSimulationState(null),this.graphicsLib=new rt,this.dwenguinoBoardSimulation=new tt(t),this.dwenguinoBoardSimulation.setBoardDisplayWidthWidth("100%")}initSimulationState(t){super.initSimulationState(t),this.representationScale.motorAngles=[0,0]}initSimulationDisplay(t){super.initSimulationDisplay(t),this.canvases=[],this.contexts=[],this.initDrawingEnvironment(t),this.loadPreviousImageIfExists(),this.createControlsMenu(),this.convertToDisplayAndRender(!1),this.container=$("#"+t);let e=$("<div>").attr("id","boardContainer").css({position:"absolute",width:"40%",right:"10px",top:"10px"});this.container.append(e),this.dwenguinoBoardSimulation.setBoardDisplayWidthWidth("100%"),this.dwenguinoBoardSimulation.setComponentsTopOffset("55%"),this.dwenguinoBoardSimulation.setComponentsRightPosition("55px"),this.dwenguinoBoardSimulation.initSimulationState(null),this.dwenguinoBoardSimulation.initSimulationDisplay("boardContainer"),new ResizeObserver(()=>{for(let t=0;t<this.canvases.length;++t)this.canvases[t].width=this.container.width(),this.canvases[t].height=this.container.height();this.loadPreviousImageIfExists(),this.convertToDisplayAndRender(!0)}).observe(document.querySelector("#"+t))}initDrawingEnvironment(t){this.container=$("#"+t),this.container.css({position:"relative"});let e=["spyrograph_canvas","spyrograph_drawing_canvas"];for(let t of e)this.setupCanvas(t,this.container)}loadPreviousImageIfExists(){null!=this.imageData&&this.contexts[this.canvasNames.SPYROGRAPH_DRAWING_CANVAS].putImageData(this.imageData,0,0)}setupCanvas(t,e){let i=$("<canvas>").attr("id",t).css({position:"absolute",left:"10px",top:0})[0],o=i.getContext("2d");i.width=e.width(),i.height=e.height(),this.canvases.push(i),this.contexts.push(o),this.container.append(i)}createControlsMenu(){let t=$("<span>").css({position:"absolute",right:0,bottom:0,width:"15%","text-align":"center","margin-right":"20px","margin-bottom":"20px"}),e=$("<input>").attr("type","color").attr("value",this.currentColor),i=this;e.on("change",(function(t){console.log($(this).val()),i.currentColor=$(this).val()})),t.append(e);let o=$("<button>").attr("value","Clear").html(MSG.clear).css({width:"90%","margin-top":"5px"});o.on("click",t=>{this.contexts[this.canvasNames.SPYROGRAPH_DRAWING_CANVAS].clearRect(0,0,this.canvases[this.canvasNames.SPYROGRAPH_DRAWING_CANVAS].width,this.canvases[this.canvasNames.SPYROGRAPH_DRAWING_CANVAS].height),this.imageData=null}),t.append(o);let s=$("<button>").attr("value","Save").html(MSG.save).css({width:"90%","margin-top":"5px"});s.on("click",t=>{var e=this.canvases[this.canvasNames.SPYROGRAPH_DRAWING_CANVAS].toDataURL("image/png"),i=document.createElement("a");i.download="tekening.png",i.href=e,i.click()}),t.append(s),this.container.append(t)}createSlidersForSegments(t){for(let e=0;e<this.representationScale.segmentLengths.length-1;++e){let i=$("<span>"),o=$("<span>").html("l"+e),s=$("<input>").attr("type","range").attr("min",this.representationScale.segmentRanges[e][0]).attr("max",this.representationScale.segmentRanges[e][1]).attr("value",this.representationScale.segmentCount[e]);s.css({"border-radius":"5px"});let n=this;s.on("change",(function(t){let i=parseInt($(this).val());console.log(i),n.representationScale.segmentCount[e]=i,n.representationScale.segmentLengths[e]=n.representationScale.segmentIncrement*i,n.calculateHingePoints(),n.convertToDisplayAndRender(!1)})),i.append(o),i.append(s),t.append(i)}}updateScenario(t){super.updateScenario(t),this.updateScenarioState(t),this.updateScenarioDisplay(t),this.dwenguinoBoardSimulation.updateScenario(t)}updateScenarioState(t){super.updateScenarioState(t),this.timestep++;for(let e=0;e<2;e++)this.representationScale.motorAngles[e]+=t.getMotorSpeed(e+1)/3825;this.calculateHingePoints()}calculateHingePoints(){for(let t=0;t<2;t++)this.representationScale.hinges[t]=[this.representationScale.motorAxes[t][0]+this.representationScale.segmentLengths[t]*Math.cos(this.representationScale.motorAngles[t]),this.representationScale.motorAxes[t][1]+this.representationScale.segmentLengths[t]*Math.sin(this.representationScale.motorAngles[t])];this.calulateFirstHingePoint(),this.calculateCentralHingePoints(),this.calculateFinalHingePoint()}calulateFirstHingePoint(){let t=this.representationScale.segmentLengths[2],e=this.representationScale.segmentLengths[3],i=this.representationScale.hinges[0][0],o=this.representationScale.hinges[0][1],s=this.representationScale.hinges[1][0],n=this.representationScale.hinges[1][1],a=this.calculateHingePoint(i,o,s,n,t,e);this.representationScale.hinges[2][0]=a[0],this.representationScale.hinges[2][1]=a[1]}calculateCentralHingePoints(){let t=this.representationScale.segmentLengths[3],e=this.representationScale.segmentLengths[4],i=this.representationScale.hinges[1][0],o=this.representationScale.hinges[1][1],s=this.representationScale.hinges[2][0],n=this.representationScale.hinges[2][1];this.representationScale.hinges[3][0]=i+(t+e)*(s-i)/t,this.representationScale.hinges[3][1]=o+(t+e)*(n-o)/t,t=this.representationScale.segmentLengths[2],e=this.representationScale.segmentLengths[5],i=this.representationScale.hinges[0][0],o=this.representationScale.hinges[0][1],s=this.representationScale.hinges[2][0],n=this.representationScale.hinges[2][1],this.representationScale.hinges[4][0]=i+(t+e)*(s-i)/t,this.representationScale.hinges[4][1]=o+(t+e)*(n-o)/t}calculateFinalHingePoint(){let t=this.representationScale.hinges[3][0],e=this.representationScale.hinges[3][1],i=this.representationScale.hinges[4][0],o=this.representationScale.hinges[4][1],s=this.representationScale.segmentLengths[6],n=this.representationScale.segmentLengths[7],a=this.calculateHingePoint(t,e,i,o,s,n);this.representationScale.hinges[5][0]=a[0],this.representationScale.hinges[5][1]=a[1]}calculateHingePoint(t,e,i,o,s,n){let a=n*n-s*s-i*i+t*t-o*o+e*e,r=2*(t-i),l=4*(o-e)*(o-e)/(r*r)+1,d=4*(o-e)*(o-e)+r*r,c=r*r,g=4*a*(o-e)/(r*r)-4*t*(o-e)/r-2*e,p=a*a/(r*r)-2*t*a/r+t*t+e*e-s*s,h=(-1*g+Math.sqrt(g*g-4*l*p))*c/(2*d),u=(-1*g-Math.sqrt(g*g-4*l*p))*c/(2*d);return h>u?[(2*h*(o-e)+a)/r,h]:[(2*u*(o-e)+a)/r,u]}updateScenarioDisplay(t){super.updateScenarioDisplay(t),this.convertToDisplayAndRender(!0)}convertToDisplayAndRender(t=!0){this.scaleRepresentationToDrawing(this.canvases[this.canvasNames.SPYROGRAPH_CANVAS].width),this.mirrorDisplayVertically(this.canvases[this.canvasNames.SPYROGRAPH_CANVAS].height),window.requestAnimationFrame(()=>{this.render(t)})}mirrorDisplayVertically(t){for(let e=0;e<this.drawingScale.motorAxes.length;++e)this.drawingScale.motorAxes[e][1]=-1*this.drawingScale.motorAxes[e][1]+t;for(let e=0;e<this.drawingScale.hinges.length;++e)this.drawingScale.hinges[e][1]=-1*this.drawingScale.hinges[e][1]+t}scaleRepresentationToDrawing(t){this.scaleSegementLengths(t),this.scaleHingePoints(t),this.scaleArmProperties(t)}scaleArmProperties(t){this.drawingScale.armWidth=this.representationScale.armWidth/this.startScale*t,this.drawingScale.holeDiameter=this.representationScale.holeDiameter/this.startScale*t}scaleHingePoints(t){let e=t*this.scaleFactorForDisplay;for(let t=0;t<this.representationScale.motorAxes.length;++t)for(let i=0;i<this.representationScale.motorAxes[t].length;++i)this.drawingScale.motorAxes[t][i]=this.representationScale.motorAxes[t][i]/this.startScale*e;for(let t=0;t<this.representationScale.hinges.length;++t)for(let i=0;i<this.representationScale.hinges[t].length;++i)this.drawingScale.hinges[t][i]=this.representationScale.hinges[t][i]/this.startScale*e}scaleSegementLengths(t){let e=t*this.scaleFactorForDisplay;for(let t=0;t<this.representationScale.motorAxes.length;t++)for(let i=0;i<this.representationScale.motorAxes[t].length;i++)this.drawingScale.motorAxes[t][i]=this.representationScale.motorAxes[t][i]/this.startScale*e;for(let t=0;t<this.representationScale.segmentLengths.length;t++)this.drawingScale.segmentLengths[t]=this.representationScale.segmentLengths[t]/this.startScale*e;this.currentScale=e}render(t=TextTrackCueList){let e=this.canvases[this.canvasNames.SPYROGRAPH_CANVAS].width,i=this.canvases[this.canvasNames.SPYROGRAPH_CANVAS].height;this.contexts[this.canvasNames.SPYROGRAPH_CANVAS].clearRect(0,0,e,i),this.contexts[this.canvasNames.SPYROGRAPH_CANVAS].fillStyle="#000000",this.graphicsLib.drawBasePlate(this.contexts[this.canvasNames.SPYROGRAPH_CANVAS],new st(this.drawingScale.motorAxes[0][0],this.drawingScale.motorAxes[0][1]),new st(this.drawingScale.motorAxes[1][0],this.drawingScale.motorAxes[1][1])),this.contexts[this.canvasNames.SPYROGRAPH_CANVAS].fillStyle="#FF0000";let o=this.drawingScale.hinges.concat(this.drawingScale.motorAxes);for(let t=0;t<o.length;t++)this.contexts[this.canvasNames.SPYROGRAPH_CANVAS].beginPath(),this.contexts[this.canvasNames.SPYROGRAPH_CANVAS].arc(o[t][0],o[t][1],3,0,360),this.contexts[this.canvasNames.SPYROGRAPH_CANVAS].closePath(),this.contexts[this.canvasNames.SPYROGRAPH_CANVAS].fill();this.graphicsLib.drawRobotArm(this.contexts[this.canvasNames.SPYROGRAPH_CANVAS],new st(this.drawingScale.motorAxes[0][0],this.drawingScale.motorAxes[0][1]),new st(this.drawingScale.hinges[0][0],this.drawingScale.hinges[0][1]),this.representationScale.segmentCount[0],this.drawingScale.armWidth,this.drawingScale.holeDiameter),this.graphicsLib.drawRobotArm(this.contexts[this.canvasNames.SPYROGRAPH_CANVAS],new st(this.drawingScale.motorAxes[1][0],this.drawingScale.motorAxes[1][1]),new st(this.drawingScale.hinges[1][0],this.drawingScale.hinges[1][1]),this.representationScale.segmentCount[1],this.drawingScale.armWidth,this.drawingScale.holeDiameter),this.graphicsLib.drawRobotArm(this.contexts[this.canvasNames.SPYROGRAPH_CANVAS],new st(this.drawingScale.hinges[0][0],this.drawingScale.hinges[0][1]),new st(this.drawingScale.hinges[4][0],this.drawingScale.hinges[4][1]),this.representationScale.segmentCount[2]+this.representationScale.segmentCount[5],this.drawingScale.armWidth,this.drawingScale.holeDiameter),this.graphicsLib.drawRobotArm(this.contexts[this.canvasNames.SPYROGRAPH_CANVAS],new st(this.drawingScale.hinges[1][0],this.drawingScale.hinges[1][1]),new st(this.drawingScale.hinges[3][0],this.drawingScale.hinges[3][1]),this.representationScale.segmentCount[3]+this.representationScale.segmentCount[4],this.drawingScale.armWidth,this.drawingScale.holeDiameter),this.graphicsLib.drawRobotArm(this.contexts[this.canvasNames.SPYROGRAPH_CANVAS],new st(this.drawingScale.hinges[3][0],this.drawingScale.hinges[3][1]),new st(this.drawingScale.hinges[5][0],this.drawingScale.hinges[5][1]),this.representationScale.segmentCount[6],this.drawingScale.armWidth,this.drawingScale.holeDiameter),this.graphicsLib.drawRobotArm(this.contexts[this.canvasNames.SPYROGRAPH_CANVAS],new st(this.drawingScale.hinges[4][0],this.drawingScale.hinges[4][1]),new st(this.drawingScale.hinges[5][0],this.drawingScale.hinges[5][1]),this.representationScale.segmentCount[7],this.drawingScale.armWidth,this.drawingScale.holeDiameter),t&&(this.contexts[this.canvasNames.SPYROGRAPH_DRAWING_CANVAS].fillStyle=this.currentColor,this.contexts[this.canvasNames.SPYROGRAPH_DRAWING_CANVAS].beginPath(),this.contexts[this.canvasNames.SPYROGRAPH_DRAWING_CANVAS].arc(this.drawingScale.hinges[5][0],this.drawingScale.hinges[5][1],1,0,360),this.contexts[this.canvasNames.SPYROGRAPH_DRAWING_CANVAS].closePath(),this.contexts[this.canvasNames.SPYROGRAPH_DRAWING_CANVAS].fill()),this.imageData=this.contexts[this.canvasNames.SPYROGRAPH_DRAWING_CANVAS].getImageData(0,0,this.container.width(),this.container.height())}}function ct(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class gt extends j{constructor(t){super(t),ct(this,"stepperMotorPins",[33,34]),ct(this,"penPositionPins",[36,37]),ct(this,"colorPin",35),ct(this,"dwenguinoBoardSimulation",null),ct(this,"previousProgramColor","#000"),ct(this,"motor",{image:{radius:u.motorRadius},position:{xL:20,xR:20+u.motorDistance,y:20},settings:{nrOfSteps:u.nrOfSteps,currentSteps:[0,0]}}),ct(this,"wireLengths",[300,200]),ct(this,"startWireLengths",this.wireLengths),ct(this,"stylus",{image:{radius:5},position:{x:80,y:80},prevPosition:{x:0,y:0},drawing:{radius:2,drawingColor:"#000",selectedColor:"#000",boardColor:"#000",liftStylus:!1}}),ct(this,"paper",{height:(this.motor.position.xR-this.motor.position.xL)/Math.sqrt(2),width:this.motor.position.xR-this.motor.position.xL,position:{x:this.motor.position.xL,y:40}}),ct(this,"containerWidth",0),ct(this,"containerHeight",0),this.dwenguinoBoardSimulation=new tt(t)}initSimulationState(t){super.initSimulationState(t),this.caclulateStylusPoint(),t&&(t.setIoPinState(this.stepperMotorPins[0],this.wireLengths[0]/(2*Math.PI*u.motorRadius/u.nrOfSteps)),t.setIoPinState(this.stepperMotorPins[1],this.wireLengths[1]/(2*Math.PI*u.motorRadius/u.nrOfSteps)),t.setIoPinState(this.penPositionPins[0],this.stylus.position.x-this.motor.position.xL),t.setIoPinState(this.penPositionPins[1],this.stylus.position.y-this.motor.position.y))}initSimulationDisplay(t){super.initSimulationDisplay(t),this.initSimulationState(null);let e=$("#"+t),i=$("<div>").attr("id","db_simulator_top_pane"),o=$("<div>").attr("id","db_simulator_bottom_pane");e.append(i).append(o),this.dwenguinoBoardSimulation.initSimulationState(null),this.dwenguinoBoardSimulation.initSimulationDisplay("db_simulator_top_pane"),o.append($("<canvas>").attr("id","sim_canvas").attr("class","canvas")),o.append($("<canvas>").attr("id","sim_canvas_drawing").attr("class","canvas")),o.append($("<canvas>").attr("id","sim_canvas_grid").attr("class","canvas")),o.append($("<div>").attr("id","sim_grid"));var s=$("<ul>").attr("id","sim_settings"),n=$("<li>").attr("class","sim_setting");$("<input />",{type:"checkbox",id:"cb_grid",value:"grid"}).prop("checked",!0).appendTo(n),$("<label />",{for:"cb_grid",id:"txt_grid",text:MSG.drawingrobotgrid}).appendTo(n),s.append(n);n=$("<li>").attr("class","sim_setting");$("#colorpicker");let a=$("<input />",{type:"color",id:"colorpicker",name:"colorpicker",value:this.stylus.drawing.drawingColor});a.appendTo(n),$("<label />",{for:"colorpicker",id:"txt_colorpicker",text:MSG.colorpicker}).appendTo(n),s.append(n);n=$("<li>").attr("class","sim_setting");$("<button />",{type:"button",id:"btn_saveImage",text:MSG.drawingrobotSaveImage}).appendTo(n),s.append(n),o.append(s);let r=this;a.on("change",(function(t){console.log($(this).val()),r.updateColor($(this).val())}));var l=$("#sim_canvas")[0],d=$("#sim_canvas_drawing")[0],c=$("#sim_canvas_grid")[0];$(".canvas").css("position","absolute").css("top","O").css("left","O"),$("#sim_settings").css("position","absolute").css("right","20px").css("top","0px").css("list-style","none"),$("#sim_grid").css("position","absolute").css("left",this.paper.position.x).css("top",this.paper.position.y).css("width",this.paper.width).css("height",this.paper.height),$(".sim_setting").css("vertical-align","middle"),this.containerWidth=o.width(),this.containerHeight=o.height(),l.width=this.containerWidth,l.height=this.containerHeight,d.width=this.containerWidth,d.height=this.containerHeight,c.width=this.containerWidth,c.height=this.containerHeight,this.drawGrid(),$("#cb_grid").click((function(){$("#svg_grid").toggle(this.checked),$("#sim_canvas_grid").toggle(this.checked)})),$("#btn_saveImage").click((function(){var t="image/png",e=$("#sim_canvas_drawing")[0].toDataURL(t),i=document.createElement("a");i.download=MSG.drawingrobotDrawing,i.href=e,i.dataset.downloadurl=[t,i.download,i.href].join(":"),document.body.appendChild(i),i.click(),document.body.removeChild(i)})),this.redraw()}updateScenario(t){super.updateScenarioState(t);this.updateScenarioState(t);this.updateScenarioDisplay(t)}updateScenarioState(t){super.updateScenarioState(t),this.updateServoAngle(t.getIoPinState(38)),this.previousProgramColor!=t.getIoPinState(this.colorPin)&&this.updateColor(t.getIoPinState(this.colorPin));var e=t.getIoPinState(this.stepperMotorPins[0]),i=t.getIoPinState(this.stepperMotorPins[1]);this.updateLengths([e,i]),this.caclulateStylusPoint(),t.setIoPinState(this.penPositionPins[0],this.stylus.position.x-this.motor.position.xL),t.setIoPinState(this.penPositionPins[1],this.stylus.position.y-this.motor.position.y)}updateLengths(t){let e=t.map((t,e)=>{let i=t*(2*Math.PI*this.motor.image.radius/this.motor.settings.nrOfSteps);return i>=0?i:0});this.wireLengths=e}calculateWireLengths(t){}caclulateStylusPoint(){let t=this.wireLengths[0],e=this.wireLengths[1],i=this.motor.position.xR-this.motor.position.xL,o=(t**2-e**2+i**2)/(2*i);t+e>=i&&(this.stylus.position.x=this.motor.position.xL+o,this.stylus.position.y=this.motor.position.y+Math.sqrt(t**2-o**2))}updateScenarioDisplay(t){super.updateScenarioDisplay(t),this.redraw()}redraw(){let t=$("#sim_canvas")[0],e=t.getContext("2d"),i=$("#sim_canvas_drawing")[0].getContext("2d");e.clearRect(0,0,t.width,t.height),e.beginPath(),e.strokeStyle="#848484",e.moveTo(this.motor.position.xL,this.motor.position.y),e.lineTo(this.stylus.position.x,this.stylus.position.y),e.moveTo(this.motor.position.xR,this.motor.position.y),e.lineTo(this.stylus.position.x,this.stylus.position.y),e.stroke(),e.beginPath(),e.globalAlpha=.5,e.fillStyle=this.stylus.drawing.drawingColor,e.arc(this.stylus.position.x,this.stylus.position.y,this.stylus.image.radius,0,2*Math.PI),e.fill(),e.beginPath(),e.fillStyle="#848484",e.arc(this.motor.position.xL,this.motor.position.y,this.motor.image.radius,0,2*Math.PI),e.fill(),e.beginPath(),e.fillStyle="#848484",e.arc(this.motor.position.xR,this.motor.position.y,this.motor.image.radius,0,2*Math.PI),e.fill(),this.stylus.drawing.liftStylus||(i.beginPath(),i.fillStyle=this.stylus.drawing.drawingColor,i.arc(this.stylus.position.x,this.stylus.position.y,this.stylus.drawing.radius,0,2*Math.PI),i.fill())}drawGrid(){let t=this.paper.position.x,e=this.paper.position.y,i=$("#sim_canvas_grid")[0].getContext("2d");i.font="10px Arial",i.fillText("0",t,e),i.fillText("100",t+100,e),i.fillText("200",t+200,e),i.fillText("300",t+300,e),i.fillText("300",t-15,e+100),i.fillText("200",t-15,e+200),i.fillText("100",t-15,e+300);$("#sim_grid").append('        <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" id="svg_grid">          <defs>            <pattern id="smallGrid" width="10" height="10" patternUnits="userSpaceOnUse">            <path d="M 10 0 L 0 0 0 10" fill="none" stroke="gray" stroke-width="0.5"/>            </pattern>            <pattern id="grid" width="100" height="100" patternUnits="userSpaceOnUse">              <rect width="100" height="100" fill="url(#smallGrid)"/>              <path d="M 100 0 L 0 0 0 100" fill="none" stroke="gray" stroke-width="1"/>            </pattern>          </defs>          <rect width="100%" height="100%" fill="url(#grid)" />        </svg>')}updateServoAngle(t){90===t&&(this.stylus.drawing.liftStylus=!0),0===t&&(this.stylus.drawing.liftStylus=!1)}checkServoAngle(t,e){return(90!==t||!e.stylus.drawing.liftStylus)&&!(0===t&&!e.stylus.drawing.liftStylus)}updateColor(t){0!=t&&(this.stylus.drawing.drawingColor=t)}}function pt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class ht{constructor(t,e){pt(this,"logger",null),pt(this,"workspace",null),pt(this,"scenarios",null),this.scenarios={spyrograph:new dt(t),moving:new et(t),wall:new it(t),socialrobot:new K(t),plotter:new gt(t)},this.logger=t,this.workspace=e,this.simControlsController=new w(this.logger,this.workspace,this.scenarios)}open(){}stop(){this.simControlsController.handleSimulationStop()}}class ut extends x{constructor(){super()}toString(){return"buzzer"}static getType(){return R.BUZZER}static getDescription(){return MSG.simulator.buzzerDescription}static getInputPins(){return[]}static getOutputPins(){return["frequency"]}}class mt extends x{constructor(){super()}toString(){return"lcd"}static getType(){return R.LCD}static getDescription(){return MSG.simulator.lcdDescription}static getInputPins(){return[]}static getOutputPins(){return[]}}class _t extends x{constructor(){super()}toString(){return"led"}static getType(){return R.LED}static getDescription(){return MSG.simulator.ledDescription}static getInputPins(){return[]}static getOutputPins(){return[]}}class vt extends x{constructor(){super()}toString(){return"light sensor"}static getType(){return R.LIGHT}static getDescription(){return""}static getInputPins(){return[]}static getOutputPins(){return[]}}class bt extends x{constructor(){super()}toString(){return"PIR sensor"}static getType(){return R.PIR}static getDescription(){return MSG.simulator.pirDescription}static getInputPins(){return[]}static getOutputPins(){return[]}}class St extends x{constructor(){super()}toString(){return"Servo"}static getType(){return R.SERVO}static getDescription(){return MSG.simulator.servoDescription}static getInputPins(){return[]}static getOutputPins(){return["angle"]}}class ft extends x{constructor(){super()}toString(){return"Sonar"}static getType(){return R.SONAR}static getDescription(){return""}static getInputPins(){return["trigger"]}static getOutputPins(){return["echo"]}}function yt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class wt{constructor(t){yt(this,"tutorialCategory",""),yt(this,"eventLogger",null),this.eventLogger=t,this.initTutorialMenu()}initTutorialMenu(){$("#db_tutorials").click(()=>{this.loadTutorialDialog(),this.addTutorialDialogEventHandlers(),this.showTutorialDialog()})}loadTutorialDialog(){$("#tutorialModal .modal-header").text(MSG.tutorialMenu.header),$("#tutorialModal .modal-body .message").empty(),$("#tutorialModal .modal-body .message").append('<div class="tutorial_label">'+MSG.tutorialMenu.chooseCategory+"</div>"),$("#tutorialModal .modal-body .message").append('<div id="tutorialModal_categories_menu" class="tutorial_categories_wrapper"></div>'),$("#tutorialModal_categories_menu").append('<div id="tutorial_category_dwenguino_components" class="tutorial_categories_item card"></div>'),$("#tutorial_category_dwenguino_components").append('<div class="category_tag">'+MSG.tutorialMenu.catDwenguinoComponents+"</div>"),$("#tutorial_category_dwenguino_compoentns").append('<div id="tutorial_categories_dwenguino_components_img"></div>'),$("#tutorialModal_categories_menu").append('<div id="tutorial_category_wegostem" class="tutorial_categories_item card"></div>'),$("#tutorial_category_wegostem").append('<div class="category_tag">'+MSG.tutorialMenu.catWeGoStem+"</div>"),$("#tutorial_category_wegostem").append('<div id="tutorial_categories_wegostem_img"></div>'),$("#tutorialModal_categories_menu").append('<div id="tutorial_category_dwenguino" class="tutorial_categories_item card"></div>'),$("#tutorial_category_dwenguino").append('<div class="category_tag">'+MSG.tutorialMenu.catDwenguino+"</div>"),$("#tutorial_category_dwenguino").append('<div id="tutorial_categories_dwenguino_img"></div>'),$("#tutorialModal_categories_menu").append('<div id="tutorial_category_riding_robot" class="tutorial_categories_item card"></div>'),$("#tutorial_category_riding_robot").append('<div class="category_tag">'+MSG.tutorialMenu.catRidingRobot+"</div>"),$("#tutorial_category_riding_robot").append('<div id="tutorial_categories_riding_robot_img"></div>'),$("#tutorialModal_categories_menu").append('<div id="tutorial_category_social_robot" class="tutorial_categories_item card"></div>'),$("#tutorial_category_social_robot").append('<div class="category_tag">'+MSG.tutorialMenu.catSocialRobot+"</div>"),$("#tutorial_category_social_robot").append('<div id="tutorial_categories_social_robot_img"></div>'),$("#tutorialModal .modal-footer").empty(),$("#tutorialModal .modal-footer").append('<button id="close_tutorial_dialog" type="button" class="btn btn-default" data-dismiss="modal">'+MSG.tutorialMenu.close+"</button>")}addTutorialDialogEventHandlers(){$("#tutorial_category_dwenguino_components").click(()=>{this.loadComponentsOverview()}),$("#tutorial_category_wegostem").click(()=>{this.loadTutorialsMenu("wegostem")}),$("#tutorial_category_dwenguino").click(()=>{this.loadTutorialsMenu("dwenguino")}),$("#tutorial_category_riding_robot").click(()=>{this.loadTutorialsMenu("ridingrobot")}),$("#tutorial_category_social_robot").click(()=>{this.loadTutorialsMenu("socialrobot")}),$(".close").click(()=>{this.hideTutorialDialog()})}showTutorialDialog(){$("#tutorialModal").modal("show")}hideTutorialDialog(){$("#tutorialModal").modal("hide")}loadTutorialsMenu(t){$("#tutorialModal .modal-header").text(MSG.tutorialMenu.header),$("#tutorialModal .modal-body .message").empty(),$("#tutorialModal .modal-body .message").append('<div class="tutorial_label">'+MSG.tutorialMenu.chooseTutoral+"</div>"),$("#tutorialModal .modal-body .message").append('<div id="tutorialModal_tutorials_menu"></div>'),$("#tutorialModal .modal-footer").empty(),$("#tutorialModal .modal-footer").append('<button id="previous_tutorial_dialog" type="button" class="btn btn-default">'+MSG.tutorialMenu.previous+"</button>"),$("#tutorialModal .modal-footer").append('<button id="close_tutorial_dialog" type="button" class="btn btn-default" data-dismiss="modal">'+MSG.tutorialMenu.close+"</button>"),$("#previous_tutorial_dialog").click(()=>{this.loadTutorialDialog(),this.addTutorialDialogEventHandlers()});var e={username:User.username,password:User.password,category:t};let i=this;$.ajax({type:"POST",url:n.getServerUrl()+"/tutorials/completedTutorials",data:e}).done((function(e){$.each(tutorials,(function(o,s){if(s.category==t){var n=!1;$.each(e,(function(t,e){s.id==e.tutorial_id&&(n=!0)})),i.addTutorial(s,n)}}))})).fail((function(e,o){console.warn("Failed to get completed tutorials:",o),$.each(tutorials,(function(e,o){if(o.category==t){i.addTutorial(o,!1)}}))}))}loadComponentsOverview(){$("#tutorialModal .modal-header").text(MSG.tutorialMenu.dwenguinoComponents),$("#tutorialModal .modal-body .message").empty(),$("#tutorialModal .modal-body .message").append('<div class="container"></div>'),$("#tutorialModal .modal-body .message .container").append('<div id="row1" class="row"></div>'),$("#row1").append("<h2>Sensors</h2>"),$("#tutorialModal .modal-body .message .container").append('<div id="tutorialModal_sensors_menu" class="components_overview row"></div>');let t=[ft,vt,L,bt];for(let e=0;e<t.length;e++)$("#tutorialModal_sensors_menu").append('<div id="tutorial_sensors_'+t[e].getType()+'" class="col-3 bg-c-4 card"></div>'),$("#tutorial_sensors_"+t[e].getType()).append('<div class="category_tag">'+MSG.simulator[t[e].getType()]+"</div>"),$("#tutorial_sensors_"+t[e].getType()).append('<div id="tutorial_categories_dwenguino_components_img"></div>'),$("#tutorial_sensors_"+t[e].getType()).append("<div>"+t[e].getDescription()+"</div>"),$("#tutorial_sensors_"+t[e].getType()).append('<div id="input_pins'+t[e].getType()+'">IN: </div>'),$("#tutorial_sensors_"+t[e].getType()).append('<div id="output_pins'+t[e].getType()+'">OUT: </div>'),$("#tutorial_sensors_"+t[e].getType()).append('<div id="circuit_pins'+t[e].getType()+'">CIRCUIT: </div>');$("#tutorialModal .modal-body .message .container").append('<div id="row2" class="row"></div>'),$("#row2").append("<h2>Actuators</h2>"),$("#tutorialModal .modal-body .message .container").append('<div id="row3" class="row"></div>'),$("#row3").append("<h3>Movement</h3>"),$("#tutorialModal .modal-body .message .container").append('<div id="tutorialModal_movement_menu" class="components_overview row"></div>');let e=[St];for(let t=0;t<e.length;t++)$("#tutorialModal_movement_menu").append('<div id="tutorial_movement_'+e[t].getType()+'" class="col-3 bg-c-11 card"></div>'),$("#tutorial_movement_"+e[t].getType()).append('<div class="category_tag">'+MSG.simulator[e[t].getType()]+"</div>"),$("#tutorial_movement_"+e[t].getType()).append('<div id="tutorial_categories_dwenguino_components_img"></div>'),$("#tutorial_movement_"+e[t].getType()).append("<div>"+e[t].getDescription()+"</div>"),$("#tutorial_movement_"+e[t].getType()).append('<div id="input_pins'+e[t].getType()+'">IN: </div>'),$("#tutorial_movement_"+e[t].getType()).append('<div id="output_pins'+e[t].getType()+'">OUT: </div>'),$("#tutorial_movement_"+e[t].getType()).append('<div id="circuit_pins'+e[t].getType()+'">CIRCUIT: </div>');$("#tutorialModal .modal-body .message .container").append('<div id="row4" class="row"></div>'),$("#row4").append("<h3>Display</h3>"),$("#tutorialModal .modal-body .message .container").append('<div id="tutorialModal_display_menu" class="components_overview row"></div>');let i=[mt,_t];for(let t=0;t<i.length;t++)$("#tutorialModal_display_menu").append('<div id="tutorial_display_'+i[t].getType()+'" class="col-3 bg-c-6 card"></div>'),$("#tutorial_display_"+i[t].getType()).append('<div class="category_tag">'+MSG.simulator[i[t].getType()]+"</div>"),$("#tutorial_display_"+i[t].getType()).append('<div id="tutorial_categories_dwenguino_components_img"></div>'),$("#tutorial_display_"+i[t].getType()).append("<div>"+i[t].getDescription()+"</div>"),$("#tutorial_display_"+i[t].getType()).append('<div id="input_pins'+i[t].getType()+'">IN: </div>'),$("#tutorial_display_"+i[t].getType()).append('<div id="output_pins'+i[t].getType()+'">OUT: </div>'),$("#tutorial_display_"+i[t].getType()).append('<div id="circuit_pins'+i[t].getType()+'">CIRCUIT: </div>');$("#tutorialModal .modal-body .message .container").append('<div id="row5" class="row"></div>'),$("#row5").append("<h3>Audio</h3>"),$("#tutorialModal .modal-body .message .container").append('<div id="tutorialModal_audio_menu" class="components_overview row"></div>');let o=[ut];for(let t=0;t<o.length;t++)$("#tutorialModal_audio_menu").append('<div id="tutorial_audio_'+o[t].getType()+'" class="col-3 bg-c-3 card"></div>'),$("#tutorial_audio_"+o[t].getType()).append('<div class="category_tag">'+MSG.simulator[o[t].getType()]+"</div>"),$("#tutorial_audio_"+o[t].getType()).append('<div id="tutorial_categories_dwenguino_components_img"></div>'),$("#tutorial_audio_"+o[t].getType()).append("<div>"+o[t].getDescription()+"</div>"),$("#tutorial_audio_"+o[t].getType()).append('<div id="input_pins'+o[t].getType()+'">IN: </div>'),$("#tutorial_audio_"+o[t].getType()).append('<div id="output_pins'+o[t].getType()+'">OUT: </div>'),$("#tutorial_audio_"+o[t].getType()).append('<div id="circuit_pins'+o[t].getType()+'">CIRCUIT: </div>');let s=t.concat(e).concat(i).concat(o);for(let t=0;t<s.length;t++){let e=s[t].getInputPins();for(let i=0;i<e.length;i++)$("#input_pins"+s[t].getType()).append('<span class="badge badge-pill">'+e[i]+"</span> ");let i=s[t].getOutputPins();for(let e=0;e<i.length;e++)$("#output_pins"+s[t].getType()).append('<span class="badge badge-pill">'+i[e]+"</span> ");$("#circuit_pins"+s[t].getType()).append('<span class="badge badge-pill">5V</span> '),$("#circuit_pins"+s[t].getType()).append('<span class="badge badge-pill">GND</span> ')}$("#tutorialModal .modal-footer").empty(),$("#tutorialModal .modal-footer").append('<button id="previous_tutorial_dialog" type="button" class="btn btn-default">'+MSG.tutorialMenu.previous+"</button>"),$("#tutorialModal .modal-footer").append('<button id="close_tutorial_dialog" type="button" class="btn btn-default" data-dismiss="modal">'+MSG.tutorialMenu.close+"</button>"),$("#previous_tutorial_dialog").click(()=>{this.loadTutorialDialog(),this.addTutorialDialogEventHandlers()})}addTutorial(t,e){var i=$("<div>").attr("class","tutorial_item row").attr("id",t.id).attr("role","presentation");$("#tutorialModal_tutorials_menu").append(i),i.click(()=>{this.eventLogger.tutorialId=t.id,this.tutorialCategory=t.category,this.eventLogger.tutorialIdSetting=t.id,t.initSteps(),hopscotch.configure({showPrevButton:"true"}),this.hideTutorialDialog(),hopscotch.startTour(t),this.eventLogger.recordEvent(this.eventLogger.createEvent(f.startTutorial,t.id))}),e?($("#"+t.id).append('<div class="glyphicon glyphicon-ok c-6 col-auto"></div>'),$("#"+t.id).append('<div class="col-auto">'+t.label+"</div>")):($("#"+t.id).append('<div class="glyphicon glyphicon-remove c-1 col-auto"></div>'),$("#"+t.id).append('<div class="col-auto">'+t.label+"</div>"))}endTutorial(){this.saveCompleteTutorial(this.tutorialId,this.tutorialCategory),this.eventLogger.tutorialId="",this.eventLogger.tutorialIdSetting="",this.tutorialCategory="",this.eventLogger.recordEvent(this.eventLogger.createEvent(f.endTutorial,"")),this.showTutorialDialog()}saveCompleteTutorial(t,e){console.log(t,e);var i={username:User.username,password:User.password,tutorialId:t,category:e};void 0!==this.eventLogger.sessionId&&$.ajax({type:"POST",url:n.getServerUrl()+"/tutorials/completeTutorial",data:i}).done((function(t){console.debug("Recording submitted",t)})).fail((function(t,e){console.warn("Failed to submit recording:",e)}))}}e.default=It;var It={simButtonStateClicked:!1,workspace:null,recording:"",difficultyLevel:1,simulatorState:"off",xmlLoadedFromFile:"",xmlFromScenario:"",logger:null,simulationEnvironment:null,tutorialMenu:null,fileIOController:null,initDwenguinoBlockly:function(t){this.workspace=t,this.setWorkspaceBlockFromXml('<xml id="startBlocks" style="display: none">'+document.getElementById("startBlocks").innerHTML+"</xml>"),this.fileIOController=new q,this.logger=new d,this.logger.init(),this.tutorialMenu=new wt(this.logger),this.simulationEnvironment=new ht(this.logger,this.workspace),It.recording=window.sessionStorage.loadOnceRecording||"",delete window.sessionStorage.loadOnceRecording,$("#db_menu_item_difficulty_slider").slider({value:0,min:0,max:2,step:1,slide:function(t,e){It.setDifficultyLevel(e.value),console.log(e.value),this.logger.createEvent(this.logger.createEvent("setDifficultyLevel",e.value))}}),$("#db_menu_item_difficulty_slider_input").val("$"+$("#db_menu_item_difficulty_slider").slider("value")),$("#db_blockly").resizable({handles:"e"}),$("#db_blockly").resize((function(){It.onresize(),Blockly.svgResize(It.workspace)})),$("#db_menu_item_simulator").click((function(){It.toggleSimulator()})),It.toggleSimulator(),$("#db_menu_item_run").click((function(){var t=Blockly.Arduino.workspaceToCode(It.workspace);It.runEventHandler(t)})),$("#db_menu_item_upload").click((function(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){console.log("yay, files supported"),$("div").remove("#dropzoneModal"),$("#blocklyDiv").append('<div id="dropzoneModal" class="modal fade" role="dialog"></div>'),$("#dropzoneModal").append('<div id="modalDialog" class="modal-dialog"></div>'),$("#modalDialog").append('<div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Upload</h4></div>'),$("#modalDialog").append('<div class="modal-body">'+MSG.dropzone.dictSelectFile+'<input type="file" id="fileInput"><div id="filedrag">'+MSG.dropzone.dictDefaultMessage+'</div><pre id="fileDisplayArea"><pre></div>'),$("#modalDialog").append('<div class="modal-footer"><button id="submit_upload_modal_dialog_button" type="button" class="btn btn-default" data-dismiss="modal">Ok</button></div>'),$("#dropzoneModal").modal("show");var t=function(t){if(t.type.match(/text.*/)){var e=new FileReader;e.onload=function(o){i.innerText=t.name,It.xmlLoadedFromFile=e.result},e.readAsText(t)}else i.innerText="File not supported!"},e=document.getElementById("fileInput"),i=document.getElementById("fileDisplayArea");e.addEventListener("change",(function(i){var o=e.files[0];t(o)}));var o=function(t){t.stopPropagation(),t.preventDefault(),t.target.className="dragover"==t.type?"hover":""},s=document.getElementById("filedrag");s.addEventListener("dragover",o,!1),s.addEventListener("dragleave",o,!1),s.addEventListener("drop",(function(e){o(e);var i=(e.target.files||e.dataTransfer.files)[0];t(i)}),!1),s.style.display="block",$("#submit_upload_modal_dialog_button").click((function(){It.restoreFromXml(Blockly.Xml.textToDom(It.xmlLoadedFromFile))}))}else alert("The File APIs are not fully supported in this browser.")})),$("#db_menu_item_download").click((function(){var t=Blockly.Xml.workspaceToDom(It.workspace),e=Blockly.Xml.domToText(t);console.log(e),localStorage.workspaceXml=e,It.download("blocks.xml",e),It.logger.recordEvent(this.logger.createEvent(f.downloadClicked,""))})),$("#db_menu_item_clear").click((function(){It.simulationEnvironment.stop();It.runEventHandler('#include <Wire.h>\n#include <Dwenguino.h>\n#include <LiquidCrystal.h>\n\nvoid setup(){\ninitDwenguino();\ndwenguinoLCD.setCursor(2,0);\ndwenguinoLCD.print(String("WeGoSTEM ;)"));\n}\n\nvoid loop(){}\n')})),$("#language1").click((function(){It.language="cpp",It.renderCode()})),$("#language2").click((function(){It.language="js",It.renderCode()})),$("#blocklyDiv").click((function(){It.simulationEnvironment.stop()})),It.workspace.addChangeListener((function(t){if(console.log("blockly event"),"create"==t.type){var e={xml:t.xml,ids:t.ids};e=JSON.stringify(e),It.logger.recordEvent(It.logger.createEvent(f.blocklyBlockCreate,e))}else if("delete"==t.type){e={oldXml:t.oldXml,ids:t.ids};e=JSON.stringify(e),It.logger.recordEvent(It.logger.createEvent(f.blocklyBlockDelete,e))}else if("move"==t.type){e={oldParentId:t.oldParentId,oldInputName:t.oldInputName,oldCoordinate:t.oldCoordinate,newParentId:t.newParentId,newInputName:t.newInputName,newCoordinate:t.newCoordinate};e=JSON.stringify(e),It.logger.recordEvent(It.logger.createEvent(f.blocklyBlockMove,e))}else if("createVar"==t.type){e={varType:t.varType,varName:t.varName,varId:t.varId};e=JSON.stringify(e),It.logger.recordEvent(It.logger.createEvent(f.blocklyVarCreate,e))}else if("deleteVar"==t.type){e={varType:t.varType,varName:t.varName,varId:t.varId};e=JSON.stringify(e),It.logger.recordEvent(It.logger.createEvent(f.blocklyVarDelete,e))}else if(t.type==Blockly.Events.VAR_RENAME){e={oldName:t.oldName,newName:t.newName,varId:t.varId};e=JSON.stringify(e),It.logger.recordEvent(It.logger.createEvent(f.blocklyVarRename,e))}else if(t.type==Blockly.Events.UI){e={element:t.element,oldValue:t.oldValue,newValue:t.newValue};e=JSON.stringify(e),It.logger.recordEvent(It.logger.createEvent(f.blocklyUI,e))}else if(t.type==Blockly.Events.CHANGE){e={element:t.element,name:t.name,oldValue:t.oldValue,newValue:t.newValue};e=JSON.stringify(e),It.logger.recordEvent(It.logger.createEvent(f.blocklyChange,e))}else if(t.type==Blockly.Events.UNDO){console.log(t);e={};It.logger.recordEvent(It.logger.createEvent(f.undo,e))}}))},restoreFromXml:function(t){It.workspace.clear(),Blockly.Xml.domToWorkspace(t,It.workspace);It.workspace.getAllBlocks().length;It.logger.recordEvent(It.logger.createEvent(f.uploadClicked,t))},download:function(t,e){var i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),i.setAttribute("download",t),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)},toggleSimulator:function(){var t=[];this.simButtonStateClicked?(t=["100%","off",!1],It.simulationEnvironment.stop()):(t=["50%","on",!0],It.simulationEnvironment.open()),$("#db_blockly").width(t[0]),this.simButtonStateClicked=t[2],It.simulatorState=t[1],It.logger.recordEvent(It.logger.createEvent(f.simButtonStateClicked,It.simulatorState)),It.onresize(),Blockly.svgResize(It.workspace)},runEventHandler:function(t){It.disableRunButton(),$.ajax({url:n.getServerUrl()+"/utilities/run",dataType:"json",type:"post",contentType:"application/x-www-form-urlencoded",data:{code:t},success:function(t,e,i){console.log("succes"),console.log(t),"error"===t.status&&It.showModalErrorDialog(t),It.resetRunButton()},error:function(t,e,i){console.log(i),It.resetRunButton()}}),console.log(t.replace(/\r?\n|\r/g,"\n")),It.logger.recordEvent(It.logger.createEvent(f.runClicked,""))},showModalErrorDialog:function(t){$("#errorModal .modal-header").html(MSG.runError),"Upload failed"===t.info?$("#errorModal .modal-body .message").html(MSG.uploadError):"Compilation failed"===t.info?$("#errorModal .modal-body .message").html(MSG.compileError):"Clean failed"===t.info?$("#errorModal .modal-body .message").html(MSG.cleanError):$("#errorModal .modal-body .message").html(MSG.uploadError),$("#errorModal .modal-body .console").hide(),$("#errorModal .modal-body .error_details").off("click"),$("#errorModal .modal-body .error_details").click((function(){console.log("toggle console"),$("#errorModal .modal-body .console").toggle()})),"SIGTERM"===t.message.signal?$("#errorModal .modal-body .console").html("Operation timed out"):$("#errorModal .modal-body .console").html(t.trace),$("#errorModal").modal("show")},disableRunButton:function(){$("#db_menu_item_run").off("click"),$("#db_menu_item_clear").off("click"),$("#db_menu_item_dwengo_robot_teacher_image").attr("src","DwenguinoIDE/img/gear_animation.gif"),$("#db_menu_item_dwengo_robot_teacher_image").css({padding:"10px 25px",maxHeight:"100%",float:"right"}),$("#db_menu_item_run").css({color:"gray"}),$("#db_menu_item_clear").css({color:"gray"})},resetRunButton:function(){$("#db_menu_item_run").click((function(){var t=Blockly.Arduino.workspaceToCode(It.workspace);It.runEventHandler(t)})),$("#db_menu_item_clear").click((function(){It.runEventHandler('#include <Wire.h>\n#include <Dwenguino.h>\n#include <LiquidCrystal.h>\n\nvoid setup(){\ninitDwenguino();\ndwenguinoLCD.setCursor(2,0);\ndwenguinoLCD.print(String("WeGoSTEM ;)"));\n}\n\nvoid loop(){}\n')})),$("#db_menu_item_run").css({color:"black"}),$("#db_menu_item_run").hover((function(){$(this).css({color:"#8bab42"})})),$("#db_menu_item_run").mouseleave((function(){$(this).css({color:"black"})})),$("#db_menu_item_clear").css({color:"black"}),$("#db_menu_item_clear").hover((function(){$(this).css({color:"#8bab42"})})),$("#db_menu_item_clear").mouseleave((function(){$(this).css({color:"black"})})),$("#db_menu_item_dwengo_robot_teacher_image").css({padding:"10px",maxHeight:"100%",float:"right"}),$("#db_menu_item_dwengo_robot_teacher_image").attr("src","DwenguinoIDE/img/dwengo_robot_plain.svg")},prevWorkspaceXml:"",takeSnapshotOfWorkspace:function(){console.log("taking snapshot");let t=Blockly.Xml.workspaceToDom(It.workspace),e=Blockly.Xml.domToText(t);if(e!=It.prevWorkspaceXml){let t={blocksXml:e,blocksJsCode:Blockly.JavaScript.workspaceToCode(It.workspace)},i=JSON.stringify(t);It.prevWorkspaceXml=e,It.logger.recordEvent(this.logger.createEvent(f.changedWorkspace,i))}},logCodeChange:function(t){It.takeSnapshotOfWorkspace()},previouslyRenderedCode:null,language:"cpp",renderCode:function(){document.getElementById("content_arduino");if(It.logCodeChange(),"cpp"===It.language)var t=Blockly.Arduino.workspaceToCode(It.workspace);else if("js"===It.language)t=Blockly.JavaScript.workspaceToCode(It.workspace);if(null===It.previouslyRenderedCode);else if(t!==It.previouslyRenderedCode){for(var e=JsDiff.diffWords(It.previouslyRenderedCode,t),i=[],o=0;o<e.length;o++)if(!e[o].removed){var s=e[o].value.replace(/</g,"&lt;").replace(/>/g,"&gt;");e[o].added?i.push('<span class="code_highlight_new">'+s+"</span>"):i.push(s)}document.getElementById("content_arduino").innerHTML=prettyPrintOne(i.join(""),"cpp",!1),It.previouslyRenderedCode=t}},setDifficultyLevel:function(t){It.difficultyLevel=t,$("#toolbox").load("./DwenguinoIDE/levels/lvl"+t+".xml",(function(){It.doTranslation(),It.workspace.updateToolbox(document.getElementById("toolbox"))}))},loadFileXmlIntoWorkspace:function(t){console.log("loading into workspace"),It.setWorkspaceBlockFromXml(t)},onresize:function(){var t=document.getElementById("db_blockly"),e=document.getElementById("blocklyDiv"),i=t,o=0,s=0;do{o+=i.offsetLeft,s+=i.offsetTop,i=i.offsetParent}while(i);e.style.left=o+"px",e.style.top=s+"px",e.style.width=t.offsetWidth+"px",e.style.height=t.offsetHeight+"px"},injectBlockly:function(){document.getElementById("db_blockly");var t=document.getElementById("blocklyDiv");let e=Blockly.inject(t,{toolbox:document.getElementById("toolbox"),media:"DwenguinoIDE/img/",zoom:{controls:!0,wheel:!0},undo:!0});window.addEventListener("resize",It.onresize,!1),It.onresize(),Blockly.svgResize(e),e.addChangeListener(It.renderCode);return e.registerButtonCallback("createVariableCallback",(function(t){console.log("Creating new variable")})),e.registerToolboxCategoryCallback("DWB_VARIABLES",(function(){var t=e.getAllVariables(),i=[];i.push('<block type="variables_declare_set_int"></block>'),i.push('<block type="variables_get_int"></block>'),i.push('<block type="variables_declare_set_string"></block>'),i.push('<block type="variables_get_string"></block>'),console.log(t);for(var o=0;o<t.length;o++){var s='<block type="variables_get'+("Number"==t[o].type?"_int":"String"==t[o].type?"_string":"")+'"><field name="VAR" id="';s=(s=(s=s+t[o].id_+'" variabletype="')+t[o].type+'">')+t[o].name+"</field></block>",console.log(s),i.push(s)}var n=[];for(o=0;o<i.length;o++)n.push(Blockly.Xml.textToDom(i[o]));return n})),e},changeLanguage:function(){if("undefined"!=typeof Blockly&&window.sessionStorage){var t=Blockly.Xml.workspaceToDom(It.workspace),e=Blockly.Xml.domToText(t);window.sessionStorage.loadOnceBlocks=e,window.sessionStorage.loadOnceRecording=It.recording,window.sessionStorage.loadOnceSessionId=It.sessionId}var i=document.getElementById("db_menu_item_language_selection"),o=encodeURIComponent(i.options[i.selectedIndex].value),s=window.location.search;s=s.length<=1?"?lang="+o:s.match(/[?&]lang=[^&]*/)?s.replace(/([?&]lang=)[^&]*/,"$1"+o):s.replace(/\?/,"?lang="+o+"&"),window.location=window.location.protocol+"//"+window.location.host+window.location.pathname+s},LANG:DwenguinoBlocklyLanguageSettings.getLang(),isRtl:function(){return!1},initLanguage:function(){var t=It.isRtl();document.dir=t?"rtl":"ltr",document.head.parentElement.setAttribute("lang",It.LANG);var e=[];for(var i in DwenguinoBlocklyLanguageSettings.LANGUAGE_NAME)e.push([DwenguinoBlocklyLanguageSettings.LANGUAGE_NAME[i],i]);e.sort((function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:0}));var o=document.getElementById("db_menu_item_language_selection");o.options.length=0;for(var s=0;s<e.length;s++){var n=e[s],a=(i=n[n.length-1],new Option(n[0],i));i===It.LANG&&(a.selected=!0),o.options.add(a)}o.addEventListener("change",It.changeLanguage,!0)},doTranslation:function(){document.title+=" "+MSG.title,document.getElementById("db_menu_item_upload").title=MSG.loadBlocksFileTooltip,document.getElementById("db_menu_item_download").title=MSG.saveBlocksFileTooltip,document.getElementById("db_menu_item_simulator").title=MSG.toggleSimulator;for(var t,e=["catLogic","catLoops","catMath","catText","catLists","catColour","catVariables","catFunctions","catBoardIO","catDwenguino","catSocialRobot","catArduino","catComments"],i=0;t=e[i];i++){var o=document.getElementById(t);o&&o.setAttribute("name",MSG[t])}var s,n=document.getElementsByClassName("textVar");for(i=0;s=n[i];i++)s.textContent=MSG.textVariable;var a,r=document.getElementsByClassName("listVar");for(i=0;a=r[i];i++)a.textContent=MSG.listVariable},loadBlocks:function(t){try{var e=window.sessionStorage.loadOnceBlocks}catch(t){e=null}if("BlocklyStorage"in window&&window.location.hash.length>1)BlocklyStorage.retrieveXml(window.location.hash.substring(1));else if(e){delete window.sessionStorage.loadOnceBlocks;var i=Blockly.Xml.textToDom(e);Blockly.Xml.domToWorkspace(i,It.workspace)}else if(t){i=Blockly.Xml.textToDom(t);Blockly.Xml.domToWorkspace(i,It.workspace),It.recording=""}else"BlocklyStorage"in window&&window.setTimeout(BlocklyStorage.restoreBlocks,0)},setWorkspaceBlockFromXml:function(t){It.workspace.clear();try{var e=Blockly.Xml.textToDom(t)}catch(t){return void console.log("invalid xml")}Blockly.Xml.domToWorkspace(e,It.workspace)},setupEnvironment:function(){It.initLanguage();let t=It.injectBlockly();It.initDwenguinoBlockly(t),It.doTranslation(),It.setDifficultyLevel(0),It.takeSnapshotOfWorkspace(),$(window).resize((function(){It.onresize(),Blockly.svgResize(It.workspace)}))},tearDownEnvironment:function(){}};$(document).ready((function(){It.setupEnvironment()}))}]);