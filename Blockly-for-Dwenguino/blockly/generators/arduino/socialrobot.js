/**
 * @fileoverview Generating Dwenguino blocks.
 * @author tom.neutens@UGent.be     (Tom Neutens)
 */
'use strict';

goog.provide('Blockly.Arduino.socialrobot');

goog.require('Blockly.Arduino');


// This is now integrated in the setup loop structure so children don't have to know about the initialisation step and can just start coding
Blockly.Arduino['initdwenguino'] = function (block) {

//    Blockly.Arduino.definitions_['define_wire_h'] = '#include <Wire.h>\n';
//    Blockly.Arduino.definitions_['define_dwenguino_h'] = '#include <Dwenguino.h>\n';
//    Blockly.Arduino.definitions_['define_lcd_h'] = '#include <LiquidCrystal.h>\n';

    //Blockly.Arduino.setups_['initDwenguino'] = 'initDwenguino();';
    //var code = 'initDwenguino();';
    return code;
};

Blockly.Arduino['socialrobot_servo'] = function (block) {
  let value_channel = Blockly.Arduino.valueToCode(block, 'channel', Blockly.Arduino.ORDER_ATOMIC);
  let value_pin = Blockly.Arduino.valueToCode(block, 'pin', Blockly.Arduino.ORDER_ATOMIC);
  let value_angle = Blockly.Arduino.valueToCode(block, 'angle', Blockly.Arduino.ORDER_ATOMIC);

  //define sonar settings
  Blockly.Arduino.definitions_['define_servo_h'] = "#include <Servo.h>\n" + "int servoPin" + value_channel + " = " + value_pin +"\n";
  Blockly.Arduino.definitions_['define_servo_' + value_channel] = "Servo servo" + value_channel + ";\n";

  Blockly.Arduino.setups_['define_dwenguino_servo' + value_channel] = 'servo' + value_channel + '.attach(servoPin' + value_channel + ');\n';

  // Assemble JavaScript into code variable.
  var code = 'servo' + value_channel + '.write(' + value_angle + ');\n';
  return code;
};

Blockly.Arduino['socialrobot_arms_down'] = function(block) {
  var value_servo_right_hand = Blockly.JavaScript.valueToCode(block, 'servo_right_hand1', Blockly.JavaScript.ORDER_ATOMIC);
  var value_servo_left_hand = Blockly.JavaScript.valueToCode(block, 'servo_left_hand1', Blockly.JavaScript.ORDER_ATOMIC);
  
  Blockly.Arduino.definitions_['define_servo_h'] = "#include <Servo.h>\n";
  Blockly.Arduino.definitions_['define_servo_' + value_servo_right_hand] = "Servo servo" + value_servo_right_hand + ";\n";
  Blockly.Arduino.definitions_['define_servo_' + value_servo_left_hand] = "Servo servo" + value_servo_left_hand + ";\n";

  Blockly.Arduino.setups_['define_dwenguino_servo' + value_servo_right_hand] = 'servo' + value_servo_right_hand + '.attach(SERVO_' + value_servo_right_hand + ');\n';
  Blockly.Arduino.setups_['define_dwenguino_servo' + value_servo_left_hand] = 'servo' + value_servo_left_hand + '.attach(SERVO_' + value_servo_left_hand + ');\n';

    // Assemble JavaScript into code variable.
    var code = 'servo' + value_servo_right_hand + '.write(' + '180' + ');\n'
    + 'servo' + value_servo_left_hand + '.write(' + '0' + ');\n';
    return code;

}

Blockly.Arduino['socialrobot_arms_up'] = function(block) {
  var value_servo_right_hand = Blockly.JavaScript.valueToCode(block, 'servo_right_hand2', Blockly.JavaScript.ORDER_ATOMIC);
  var value_servo_left_hand = Blockly.JavaScript.valueToCode(block, 'servo_left_hand2', Blockly.JavaScript.ORDER_ATOMIC);
  
  Blockly.Arduino.definitions_['define_servo_h'] = "#include <Servo.h>\n";
  Blockly.Arduino.definitions_['define_servo_' + value_servo_right_hand] = "Servo servo" + value_servo_right_hand + ";\n";
  Blockly.Arduino.definitions_['define_servo_' + value_servo_left_hand] = "Servo servo" + value_servo_left_hand + ";\n";

  Blockly.Arduino.setups_['define_dwenguino_servo' + value_servo_right_hand] = 'servo' + value_servo_right_hand + '.attach(SERVO_' + value_servo_right_hand + ');\n';
  Blockly.Arduino.setups_['define_dwenguino_servo' + value_servo_left_hand] = 'servo' + value_servo_left_hand + '.attach(SERVO_' + value_servo_left_hand + ');\n';

    // Assemble JavaScript into code variable.
    var code = 'servo' + value_servo_right_hand + '.write(' + '0' + ');\n'
    + 'servo' + value_servo_left_hand + '.write(' + '180' + ');\n';
    return code;

}

Blockly.Arduino['socialrobot_wave_arms'] = function(block) {
  var value_servo_right_hand = Blockly.JavaScript.valueToCode(block, 'servo_right_hand', Blockly.JavaScript.ORDER_ATOMIC);
  var value_servo_left_hand = Blockly.JavaScript.valueToCode(block, 'servo_left_hand', Blockly.JavaScript.ORDER_ATOMIC);
  
  Blockly.Arduino.definitions_['define_servo_h'] = "#include <Servo.h>\n";
  Blockly.Arduino.definitions_['define_servo_' + value_servo_right_hand] = "Servo servo" + value_servo_right_hand + ";\n";
  Blockly.Arduino.definitions_['define_servo_' + value_servo_left_hand] = "Servo servo" + value_servo_left_hand + ";\n";

  Blockly.Arduino.setups_['define_dwenguino_servo' + value_servo_right_hand] = 'servo' + value_servo_right_hand + '.attach(SERVO_' + value_servo_right_hand + ');\n';
  Blockly.Arduino.setups_['define_dwenguino_servo' + value_servo_left_hand] = 'servo' + value_servo_left_hand + '.attach(SERVO_' + value_servo_left_hand + ');\n';

  // Assemble JavaScript into code variable.
  var code = 'servo' + value_servo_right_hand + '.write(' + '0' + ');\n'
  + 'servo' + value_servo_left_hand + '.write(' + '180' + ');\n'
  + 'delay(' + '1000' + ');\n'
  + 'servo' + value_servo_right_hand + '.write(' + '180' + ');\n'
  + 'servo' + value_servo_left_hand + '.write(' + '0' + ');\n'
  + 'delay(' + '1000' + ');\n';
  console.log(code);
  return code;

}

Blockly.Arduino['socialrobot_eyes_left'] = function(block) {
  var value_servo_right_eye = Blockly.JavaScript.valueToCode(block, 'servo_right_eye', Blockly.JavaScript.ORDER_ATOMIC);
  var value_servo_left_eye = Blockly.JavaScript.valueToCode(block, 'servo_left_eye', Blockly.JavaScript.ORDER_ATOMIC);
  
  Blockly.Arduino.definitions_['define_servo_h'] = "#include <Servo.h>\n";
  Blockly.Arduino.definitions_['define_servo_' + value_servo_right_eye] = "Servo servo" + value_servo_right_eye + ";\n";
  Blockly.Arduino.definitions_['define_servo_' + value_servo_left_eye] = "Servo servo" + value_servo_left_eye + ";\n";

  Blockly.Arduino.setups_['define_dwenguino_servo' + value_servo_right_eye] = 'servo' + value_servo_right_eye + '.attach(SERVO_' + value_servo_right_eye + ');\n';
  Blockly.Arduino.setups_['define_dwenguino_servo' + value_servo_left_eye] = 'servo' + value_servo_left_eye + '.attach(SERVO_' + value_servo_left_eye + ');\n';

    // Assemble JavaScript into code variable.
    var code = 'servo' + value_servo_right_eye + '.write(' + '0' + ');\n'
    + 'servo' + value_servo_left_eye + '.write(' + '0' + ');\n';
    return code;
}

Blockly.Arduino['socialrobot_eyes_right'] = function(block) {
  var value_servo_right_eye = Blockly.JavaScript.valueToCode(block, 'servo_right_eye1', Blockly.JavaScript.ORDER_ATOMIC);
  var value_servo_left_eye = Blockly.JavaScript.valueToCode(block, 'servo_left_eye1', Blockly.JavaScript.ORDER_ATOMIC);
  
  Blockly.Arduino.definitions_['define_servo_h'] = "#include <Servo.h>\n";
  Blockly.Arduino.definitions_['define_servo_' + value_servo_right_eye] = "Servo servo" + value_servo_right_eye + ";\n";
  Blockly.Arduino.definitions_['define_servo_' + value_servo_left_eye] = "Servo servo" + value_servo_left_eye + ";\n";

  Blockly.Arduino.setups_['define_dwenguino_servo' + value_servo_right_eye] = 'servo' + value_servo_right_eye + '.attach(SERVO_' + value_servo_right_eye + ');\n';
  Blockly.Arduino.setups_['define_dwenguino_servo' + value_servo_left_eye] = 'servo' + value_servo_left_eye + '.attach(SERVO_' + value_servo_left_eye + ');\n';

    // Assemble JavaScript into code variable.
    var code = 'servo' + value_servo_right_eye + '.write(' + '120' + ');\n'
    + 'servo' + value_servo_left_eye + '.write(' + '120' + ');\n';
    return code;
}

Blockly.Arduino['socialrobot_set_pin'] = function(block){
  var pin_number = Blockly.Arduino.valueToCode(block, "PIN", Blockly.Arduino.ORDER_ATOMIC);
  var led_state = Blockly.Arduino.valueToCode(block, "PIN_STATE", Blockly.Arduino.ORDER_ATOMIC);

  var code = 'digitalWrite(' + pin_number + ', ' + led_state + ');\n'
  return code;
};

Blockly.Arduino['socialrobot_read_pin'] = function(block){
    var pin_number = Blockly.Arduino.valueToCode(block, "PIN", Blockly.Arduino.ORDER_ATOMIC);
    Blockly.Arduino.setups_['setup_input_' + pin_number] = 'pinMode(' + pin_number + ', INPUT);\n';

    var code = 'digitalRead(' + pin_number + ')';
    return [code, Blockly.Arduino.ORDER_ATOMIC];
};